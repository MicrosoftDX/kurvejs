!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Kurve=t():e.Kurve=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}n(r(1)),n(r(3))},function(e,t,r){"use strict";var n,o=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},i=r(2),s=r(3),a=r(4);!function(e){var t=function(){function e(){}return e.rootUrl="https://graph.microsoft.com/",e}(),r=function(){function e(){}return e.OpenId="openid",e.OfflineAccess="offline_access",e}();e.General=r;var n=function(){function e(){}return e.Read=t.rootUrl+"User.Read",e.ReadWrite=t.rootUrl+"User.ReadWrite",e.ReadBasicAll=t.rootUrl+"User.ReadBasic.All",e.ReadAll=t.rootUrl+"User.Read.All",e.ReadWriteAll=t.rootUrl+"User.ReadWrite.All",e}();e.User=n;var o=function(){function e(){}return e.Read=t.rootUrl+"Contacts.Read",e.ReadWrite=t.rootUrl+"Contacts.ReadWrite",e}();e.Contacts=o;var i=function(){function e(){}return e.ReadAll=t.rootUrl+"Directory.Read.All",e.ReadWriteAll=t.rootUrl+"Directory.ReadWrite.All",e.AccessAsUserAll=t.rootUrl+"Directory.AccessAsUser.All",e}();e.Directory=i;var s=function(){function e(){}return e.ReadAll=t.rootUrl+"Group.Read.All",e.ReadWriteAll=t.rootUrl+"Group.ReadWrite.All",e.AccessAsUserAll=t.rootUrl+"Directory.AccessAsUser.All",e}();e.Group=s;var a=function(){function e(){}return e.Read=t.rootUrl+"Mail.Read",e.ReadWrite=t.rootUrl+"Mail.ReadWrite",e.Send=t.rootUrl+"Mail.Send",e}();e.Mail=a;var c=function(){function e(){}return e.Read=t.rootUrl+"Calendars.Read",e.ReadWrite=t.rootUrl+"Calendars.ReadWrite",e}();e.Calendars=c;var u=function(){function e(){}return e.Read=t.rootUrl+"Files.Read",e.ReadAll=t.rootUrl+"Files.Read.All",e.ReadWrite=t.rootUrl+"Files.ReadWrite",e.ReadWriteAppFolder=t.rootUrl+"Files.ReadWrite.AppFolder",e.ReadWriteSelected=t.rootUrl+"Files.ReadWrite.Selected",e}();e.Files=u;var p=function(){function e(){}return e.ReadWrite=t.rootUrl+"Tasks.ReadWrite",e}();e.Tasks=p;var h=function(){function e(){}return e.Read=t.rootUrl+"People.Read",e.ReadWrite=t.rootUrl+"People.ReadWrite",e}();e.People=h;var l=function(){function e(){}return e.Create=t.rootUrl+"Notes.Create",e.ReadWriteCreatedByApp=t.rootUrl+"Notes.ReadWrite.CreatedByApp",e.Read=t.rootUrl+"Notes.Read",e.ReadAll=t.rootUrl+"Notes.Read.All",e.ReadWriteAll=t.rootUrl+"Notes.ReadWrite.All",e}();e.Notes=l}(n=t.Scopes||(t.Scopes={}));var c=function(){function e(e,t){this.graph=e,this._data=t}return Object.defineProperty(e.prototype,"data",{get:function(){return this._data},enumerable:!0,configurable:!0}),e}();t.DataModelWrapper=c;var u=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);t.DataModelListWrapper=u;var p=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);t.ProfilePhoto=p,function(e){e[e.events=0]="events",e[e.calendarView=1]="calendarView"}(t.EventsEndpoint||(t.EventsEndpoint={}));var h=t.EventsEndpoint,l=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.events=function(e,t){this.graph.eventsForUser(this._data.userPrincipalName,h.events,e,t)},t.prototype.eventsAsync=function(e){return this.graph.eventsForUserAsync(this._data.userPrincipalName,h.events,e)},t.prototype.memberOf=function(e,t,r){this.graph.memberOfForUser(this._data.userPrincipalName,e,r)},t.prototype.memberOfAsync=function(e){return this.graph.memberOfForUserAsync(this._data.userPrincipalName,e)},t.prototype.messages=function(e,t){this.graph.messagesForUser(this._data.userPrincipalName,e,t)},t.prototype.messagesAsync=function(e){return this.graph.messagesForUserAsync(this._data.userPrincipalName,e)},t.prototype.manager=function(e,t){this.graph.managerForUser(this._data.userPrincipalName,e,t)},t.prototype.managerAsync=function(e){return this.graph.managerForUserAsync(this._data.userPrincipalName,e)},t.prototype.profilePhoto=function(e,t){this.graph.profilePhotoForUser(this._data.userPrincipalName,e,t)},t.prototype.profilePhotoAsync=function(e){return this.graph.profilePhotoForUserAsync(this._data.userPrincipalName,e)},t.prototype.profilePhotoValue=function(e,t){this.graph.profilePhotoValueForUser(this._data.userPrincipalName,e,t)},t.prototype.profilePhotoValueAsync=function(e){return this.graph.profilePhotoValueForUserAsync(this._data.userPrincipalName,e)},t.prototype.calendarView=function(e,t){this.graph.eventsForUser(this._data.userPrincipalName,h.calendarView,e,t)},t.prototype.calendarViewAsync=function(e){return this.graph.eventsForUserAsync(this._data.userPrincipalName,h.calendarView,e)},t.prototype.mailFolders=function(e,t){this.graph.mailFoldersForUser(this._data.userPrincipalName,e,t)},t.prototype.mailFoldersAsync=function(e){return this.graph.mailFoldersForUserAsync(this._data.userPrincipalName,e)},t.prototype.message=function(e,t,r){this.graph.messageForUser(this._data.userPrincipalName,e,t,r)},t.prototype.messageAsync=function(e,t){return this.graph.messageForUserAsync(this._data.userPrincipalName,e,t)},t.prototype.event=function(e,t,r){this.graph.eventForUser(this._data.userPrincipalName,e,t,r)},t.prototype.eventAsync=function(e,t){return this.graph.eventForUserAsync(this._data.userPrincipalName,e,t)},t.prototype.messageAttachment=function(e,t,r,n){this.graph.messageAttachmentForUser(this._data.userPrincipalName,e,t,r,n)},t.prototype.messageAttachmentAsync=function(e,t,r){return this.graph.messageAttachmentForUserAsync(this._data.userPrincipalName,e,t,r)},t}(c);t.User=l;var d=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(u);t.Users=d;var f=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);t.Message=f;var v=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(u);t.Messages=v;var y=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);t.Event=y;var m=function(e){function t(t,r,n){e.call(this,t,n),this.graph=t,this.endpoint=r,this._data=n}return o(t,e),t}(u);t.Events=m;var g=function(){function e(){}return e}();t.Contact=g;var U=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);t.Group=U;var A=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(u);t.Groups=A;var w=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(c);t.MailFolder=w;var k=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(u);t.MailFolders=k,function(e){e[e.fileAttachment=0]="fileAttachment",e[e.itemAttachment=1]="itemAttachment",e[e.referenceAttachment=2]="referenceAttachment"}(t.AttachmentType||(t.AttachmentType={}));var R=t.AttachmentType,T=function(e){function t(){e.apply(this,arguments)}return o(t,e),t.prototype.getType=function(){switch(this._data["@odata.type"]){case"#microsoft.graph.fileAttachment":return R.fileAttachment;case"#microsoft.graph.itemAttachment":return R.itemAttachment;case"#microsoft.graph.referenceAttachment":return R.referenceAttachment}},t}(c);t.Attachment=T;var F=function(e){function t(){e.apply(this,arguments)}return o(t,e),t}(u);t.Attachments=F;var C=function(){function e(e){this.req=null,this.accessToken=null,this.KurveIdentity=null,this.defaultResourceID="https://graph.microsoft.com",this.baseUrl="https://graph.microsoft.com/v1.0/",e.defaultAccessToken?this.accessToken=e.defaultAccessToken:this.KurveIdentity=e.identity}return e.prototype.scopesForV2=function(e){return this.KurveIdentity?this.KurveIdentity.getCurrentOauthVersion()===s.OAuthVersion.v1?null:e:null},e.prototype.meAsync=function(e){var t=new i.Deferred;return this.me(function(e,r){return e?t.reject(e):t.resolve(r)},e),t.promise},e.prototype.me=function(e,t){var r=this;this.endpointGet((new a.Root).me).then(function(t){return e(null,new l(r,t))}).fail(function(t){return e(t)})},e.prototype.userAsync=function(e,t,r){void 0===r&&(r=!0);var n=new i.Deferred;return this.user(e,function(e,t){return e?n.reject(e):n.resolve(t)},t,r),n.promise},e.prototype.user=function(e,t,r,o){void 0===o&&(o=!0);var i=o?[n.User.ReadBasicAll]:[n.User.ReadAll],s=this.buildUsersUrl(e,r);this.getUser(s,t,this.scopesForV2(i))},e.prototype.usersAsync=function(e,t){void 0===t&&(t=!0);var r=new i.Deferred;return this.users(function(e,t){return e?r.reject(e):r.resolve(t)},e,t),r.promise},e.prototype.users=function(e,t,r){void 0===r&&(r=!0);var o=r?[n.User.ReadBasicAll]:[n.User.ReadAll],i=this.buildUsersUrl("",t);this.getUsers(i,e,this.scopesForV2(o),r)},e.prototype.groupAsync=function(e,t){var r=new i.Deferred;return this.group(e,function(e,t){return e?r.reject(e):r.resolve(t)},t),r.promise},e.prototype.group=function(e,t,r){var o=[n.Group.ReadAll],i=this.buildGroupsUrl(e,r);this.getGroup(i,t,this.scopesForV2(o))},e.prototype.groupsAsync=function(e){var t=new i.Deferred;return this.groups(function(e,r){return e?t.reject(e):t.resolve(r)},e),t.promise},e.prototype.groups=function(e,t){var r=[n.Group.ReadAll],o=this.buildGroupsUrl("",t);this.getGroups(o,e,this.scopesForV2(r))},e.prototype.messageForUserAsync=function(e,t,r){var n=new i.Deferred;return this.messageForUser(e,t,function(e,t){return e?n.reject(e):n.resolve(t)},r),n.promise},e.prototype.messageForUser=function(e,t,r,o){var i=[n.Mail.Read],s=this.buildUsersUrl(e+"/messages/"+t,o);this.getMessage(s,t,function(e,t){return r(e,t)},this.scopesForV2(i))},e.prototype.messagesForUserAsync=function(e,t){var r=new i.Deferred;return this.messagesForUser(e,function(e,t){return e?r.reject(e):r.resolve(t)},t),r.promise},e.prototype.messagesForUser=function(e,t,r){var o=[n.Mail.Read],i=this.buildUsersUrl(e+"/messages",r);this.getMessages(i,function(e,r){return t(e,r)},this.scopesForV2(o))},e.prototype.mailFoldersForUserAsync=function(e,t){var r=new i.Deferred;return this.mailFoldersForUser(e,function(e,t){return e?r.reject(e):r.resolve(t)},t),r.promise},e.prototype.mailFoldersForUser=function(e,t,r){var o=[n.Mail.Read],i=this.buildUsersUrl(e+"/mailFolders",r);this.getMailFolders(i,function(e,r){return t(e,r)},this.scopesForV2(o))},e.prototype.eventForUserAsync=function(e,t,r){var n=new i.Deferred;return this.eventForUser(e,t,function(e,t){return e?n.reject(e):n.resolve(t)},r),n.promise},e.prototype.eventForUser=function(e,t,r,o){var i=[n.Calendars.Read],s=this.buildUsersUrl(e+"/events/"+t,o);this.getEvent(s,t,function(e,t){return r(e,t)},this.scopesForV2(i))},e.prototype.eventsForUserAsync=function(e,t,r){var n=new i.Deferred;return this.eventsForUser(e,t,function(e,t){return e?n.reject(e):n.resolve(t)},r),n.promise},e.prototype.eventsForUser=function(e,t,r,o){var i=[n.Calendars.Read],s=this.buildUsersUrl(e+"/"+h[t],o);this.getEvents(s,t,function(e,t){return r(e,t)},this.scopesForV2(i))},e.prototype.memberOfForUserAsync=function(e,t){var r=new i.Deferred;return this.memberOfForUser(e,function(e,t){return e?r.reject(e):r.resolve(t)},t),r.promise},e.prototype.memberOfForUser=function(e,t,r){var o=[n.Group.ReadAll],i=this.buildUsersUrl(e+"/memberOf",r);this.getGroups(i,t,this.scopesForV2(o))},e.prototype.managerForUserAsync=function(e,t){var r=new i.Deferred;return this.managerForUser(e,function(e,t){return e?r.reject(e):r.resolve(t)},t),r.promise},e.prototype.managerForUser=function(e,t,r){var o=[n.Directory.ReadAll],i=this.buildUsersUrl(e+"/manager",r);this.getUser(i,t,this.scopesForV2(o))},e.prototype.directReportsForUserAsync=function(e,t){var r=new i.Deferred;return this.directReportsForUser(e,function(e,t){return e?r.reject(e):r.resolve(t)},t),r.promise},e.prototype.directReportsForUser=function(e,t,r){var o=[n.Directory.ReadAll],i=this.buildUsersUrl(e+"/directReports",r);this.getUsers(i,t,this.scopesForV2(o))},e.prototype.profilePhotoForUserAsync=function(e,t){var r=new i.Deferred;return this.profilePhotoForUser(e,function(e,t){return e?r.reject(e):r.resolve(t)},t),r.promise},e.prototype.profilePhotoForUser=function(e,t,r){var o=[n.User.ReadBasicAll],i=this.buildUsersUrl(e+"/photo",r);this.getPhoto(i,t,this.scopesForV2(o))},e.prototype.profilePhotoValueForUserAsync=function(e,t){var r=new i.Deferred;return this.profilePhotoValueForUser(e,function(e,t){return e?r.reject(e):r.resolve(t)},t),r.promise},e.prototype.profilePhotoValueForUser=function(e,t,r){var o=[n.User.ReadBasicAll],i=this.buildUsersUrl(e+"/photo/$value",r);this.getPhotoValue(i,t,this.scopesForV2(o))},e.prototype.messageAttachmentsForUserAsync=function(e,t,r){var n=new i.Deferred;return this.messageAttachmentsForUser(e,t,function(e,t){return e?n.reject(e):n.resolve(t)},r),n.promise},e.prototype.messageAttachmentsForUser=function(e,t,r,o){var i=[n.Mail.Read],s=this.buildUsersUrl(e+"/messages/"+t+"/attachments",o);this.getMessageAttachments(s,r,this.scopesForV2(i))},e.prototype.messageAttachmentForUserAsync=function(e,t,r,n){var o=new i.Deferred;return this.messageAttachmentForUser(e,t,r,function(e,t){return e?o.reject(e):o.resolve(t)},n),o.promise},e.prototype.messageAttachmentForUser=function(e,t,r,o,i){var s=[n.Mail.Read],a=this.buildUsersUrl(e+"/messages/"+t+"/attachments/"+r,i);this.getMessageAttachment(a,o,this.scopesForV2(s))},e.prototype.getAsync=function(e){var t=new i.Deferred;return this.get(e,function(e,r){return e?t.reject(e):t.resolve(r)}),t.promise},e.prototype.get=function(e,t,r,n){var o=this,i=new XMLHttpRequest;r&&(i.responseType=r),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?t(null,r?i.response:i.responseText):t(o.generateError(i)))},i.open("GET",e),this.addAccessTokenAndSend(i,function(e){e&&t(e)},n)},e.prototype.generateError=function(e){var t=new s.Error;return t.status=e.status,t.statusText=e.statusText,""===e.responseType||"text"===e.responseType?t.text=e.responseText:t.other=e.response,t},e.prototype.endpointGet=function(e){var t=new i.Deferred;return this.get(e.pathWithQuery,function(e,r){var n=JSON.parse(r);if(n.error){var o=new s.Error;return o.other=n.error,void t.reject(o)}t.resolve(n)}),t.promise},e.prototype.getUsers=function(e,t,r,o){var a=this;void 0===o&&(o=!0),this.get(e,function(e,r){if(e)return void t(e);var c=JSON.parse(r);if(c.error){var u=new s.Error;return u.other=c.error,void t(u)}var p=c.value?c.value:[c],h=new d(a,p.map(function(e){return new l(a,e)})),f=c["@odata.nextLink"];f&&(h.nextLink=function(e){var t=o?[n.User.ReadBasicAll]:[n.User.ReadAll],r=new i.Deferred;return a.getUsers(f,function(t,n){e?e(t,n):t?r.reject(t):r.resolve(n)},a.scopesForV2(t),o),r.promise}),t(null,h)},null,r)},e.prototype.getUser=function(e,t,r){var n=this;this.get(e,function(e,r){if(e)return void t(e);var o=JSON.parse(r);if(o.error){var i=new s.Error;return i.other=o.error,void t(i)}var a=new l(n,o);t(null,a)},null,r)},e.prototype.addAccessTokenAndSend=function(e,t,r){this.accessToken?(e.setRequestHeader("Authorization","Bearer "+this.accessToken),e.send()):r?this.KurveIdentity.getAccessTokenForScopes(r,!1,function(r,n){n?t(n):(e.setRequestHeader("Authorization","Bearer "+r),e.send(),t(null))}):this.KurveIdentity.getAccessToken(this.defaultResourceID,function(r,n){r?t(r):(e.setRequestHeader("Authorization","Bearer "+n),e.send(),t(null))})},e.prototype.getMessage=function(e,t,r,n){var o=this;this.get(e,function(e,t){if(e)return void r(e);var n=JSON.parse(t);if(n.error){var i=new s.Error;return i.other=n.error,void r(i)}var a=new f(o,n);r(null,a)},null,n)},e.prototype.getMessages=function(e,t,r){var o=this;this.get(e,function(e,r){if(e)return void t(e);var a=JSON.parse(r);if(a.error){var c=new s.Error;return c.other=a.error,void t(c)}var u=a.value?a.value:[a],p=new v(o,u.map(function(e){return new f(o,e)})),h=a["@odata.nextLink"];h&&(p.nextLink=function(e){var t=[n.Mail.Read],r=new i.Deferred;return o.getMessages(h,function(t,n){e?e(t,n):t?r.reject(t):r.resolve(n)},o.scopesForV2(t)),r.promise}),t(null,p)},null,r)},e.prototype.getEvent=function(e,t,r,n){var o=this;this.get(e,function(e,t){if(e)return void r(e);var n=JSON.parse(t);if(n.error){var i=new s.Error;return i.other=n.error,void r(i)}var a=new y(o,n);r(null,a)},null,n)},e.prototype.getEvents=function(e,t,r,o){var a=this;this.get(e,function(e,o){if(e)return void r(e);var c=JSON.parse(o);if(c.error){var u=new s.Error;return u.other=c.error,void r(u)}var p=c.value?c.value:[c],h=new m(a,t,p.map(function(e){return new y(a,e)})),l=c["@odata.nextLink"];l&&(h.nextLink=function(e){var r=[n.Mail.Read],o=new i.Deferred;return a.getEvents(l,t,function(t,r){e?e(t,r):t?o.reject(t):o.resolve(r)},a.scopesForV2(r)),o.promise}),r(null,h)},null,o)},e.prototype.getGroups=function(e,t,r){var o=this;this.get(e,function(e,r){if(e)return void t(e);var a=JSON.parse(r);if(a.error){var c=new s.Error;return c.other=a.error,void t(c)}var u=a.value?a.value:[a],p=new A(o,u.map(function(e){return new U(o,e)})),h=a["@odata.nextLink"];h&&(p.nextLink=function(e){var t=[n.Group.ReadAll],r=new i.Deferred;return o.getGroups(h,function(t,n){e?e(t,n):t?r.reject(t):r.resolve(n)},o.scopesForV2(t)),r.promise}),t(null,p)},null,r)},e.prototype.getGroup=function(e,t,r){var n=this;this.get(e,function(e,r){if(e)return void t(e);var o=JSON.parse(r);if(o.error){var i=new s.Error;return i.other=o.error,void t(i)}var a=new U(n,o);t(null,a)},null,r)},e.prototype.getPhoto=function(e,t,r){var n=this;this.get(e,function(e,r){if(e)return void t(e);var o=JSON.parse(r);if(o.error){var i=new s.Error;return i.other=o.error,void t(i)}var a=new p(n,o);t(null,a)},null,r)},e.prototype.getPhotoValue=function(e,t,r){this.get(e,function(e,r){return e?void t(null,e):void t(r)},"blob",r)},e.prototype.getMailFolders=function(e,t,r){var o=this;this.get(e,function(e,r){if(e)return void t(e);var a=JSON.parse(r);if(a.error){var c=new s.Error;c.other=a.error,t(c)}var u=a.value?a.value:[a],p=new k(o,u.map(function(e){return new w(o,e)})),h=a["@odata.nextLink"];h&&(p.nextLink=function(e){var t=[n.User.ReadAll],r=new i.Deferred;return o.getMailFolders(h,function(t,n){e?e(t,n):t?r.reject(t):r.resolve(n)},o.scopesForV2(t)),r.promise}),t(null,p)},null,r)},e.prototype.getMessageAttachments=function(e,t,r){var o=this;this.get(e,function(e,r){if(e)return void t(e);var a=JSON.parse(r);if(a.error){var c=new s.Error;return c.other=a.error,void t(c)}var u=a.value?a.value:[a],p=new F(o,u.map(function(e){return new T(o,e)})),h=a["@odata.nextLink"];h&&(p.nextLink=function(e){var t=[n.Mail.Read],r=new i.Deferred;return o.getMessageAttachments(h,function(t,n){e?e(t,n):t?r.reject(t):r.resolve(n)},o.scopesForV2(t)),r.promise}),t(null,p)},null,r)},e.prototype.getMessageAttachment=function(e,t,r){var n=this;this.get(e,function(e,r){if(e)return void t(e);var o=JSON.parse(r);if(o.error){var i=new s.Error;return i.other=o.error,void t(i)}var a=new T(n,o);t(null,a)},null,r)},e.prototype.buildUrl=function(e,t,r){return this.baseUrl+e+t+(r?"?"+r:"")},e.prototype.buildMeUrl=function(e,t){return void 0===e&&(e=""),this.buildUrl("me/",e,t)},e.prototype.buildUsersUrl=function(e,t){return void 0===e&&(e=""),this.buildUrl("users/",e,t)},e.prototype.buildGroupsUrl=function(e,t){return void 0===e&&(e=""),this.buildUrl("groups/",e,t)},e}();t.Graph=C},function(e,t){"use strict";function r(e){setTimeout(e,0)}var n;!function(e){e[e.Pending=0]="Pending",e[e.ResolutionInProgress=1]="ResolutionInProgress",e[e.Resolved=2]="Resolved",e[e.Rejected=3]="Rejected"}(n||(n={}));var o=function(){function e(e,t,r){this._dispatcher=e,this._successCB=t,this._errorCB=r,this.result=new i(e)}return e.prototype.resolve=function(e,t){var r=this;return"function"!=typeof this._successCB?void this.result.resolve(e):void(t?this._dispatcher(function(){return r._dispatchCallback(r._successCB,e)}):this._dispatchCallback(this._successCB,e))},e.prototype.reject=function(e,t){var r=this;return"function"!=typeof this._errorCB?void this.result.reject(e):void(t?this._dispatcher(function(){return r._dispatchCallback(r._errorCB,e)}):this._dispatchCallback(this._errorCB,e))},e.prototype._dispatchCallback=function(e,t){var r;try{r=e(t),this.result.resolve(r)}catch(n){return void this.result.reject(n)}},e}(),i=function(){function e(e){this._stack=[],this._state=n.Pending,e?this._dispatcher=e:this._dispatcher=r,this.promise=new s(this)}return e.prototype.DispatchDeferred=function(e){setTimeout(e,0)},e.prototype.then=function(e,t){if("function"!=typeof e&&"function"!=typeof t)return this.promise;var r=new o(this._dispatcher,e,t);switch(this._state){case n.Pending:case n.ResolutionInProgress:this._stack.push(r);break;case n.Resolved:r.resolve(this._value,!0);break;case n.Rejected:r.reject(this._error,!0)}return r.result.promise},e.prototype.resolve=function(e){return this._state!==n.Pending?this:this._resolve(e)},e.prototype._resolve=function(e){var t,r=this,o=typeof e,i=!0;try{if(null===e||"object"!==o&&"function"!==o||"function"!=typeof(t=e.then))this._state=n.ResolutionInProgress,this._dispatcher(function(){r._state=n.Resolved,r._value=e;var t,o=r._stack.length;for(t=0;o>t;t++)r._stack[t].resolve(e,!1);r._stack.splice(0,o)});else{if(e===this.promise)throw new TypeError("recursive resolution");this._state=n.ResolutionInProgress,t.call(e,function(e){i&&(i=!1,r._resolve(e))},function(e){i&&(i=!1,r._reject(e))})}}catch(s){i&&this._reject(s)}return this},e.prototype.reject=function(e){return this._state!==n.Pending?this:this._reject(e)},e.prototype._reject=function(e){var t=this;return this._state=n.ResolutionInProgress,this._dispatcher(function(){t._state=n.Rejected,t._error=e;var r=t._stack.length,o=0;for(o=0;r>o;o++)t._stack[o].reject(e,!1);t._stack.splice(0,r)}),this},e}();t.Deferred=i;var s=function(){function e(e){this._deferred=e}return e.prototype.then=function(e,t){return this._deferred.then(e,t)},e.prototype.fail=function(e){return this._deferred.then(void 0,e)},e}();t.Promise=s},function(e,t,r){"use strict";var n=r(2);!function(e){e[e.v1=1]="v1",e[e.v2=2]="v2"}(t.OAuthVersion||(t.OAuthVersion={}));var o=t.OAuthVersion,i=function(){function e(){}return e}();t.Error=i;var s=function(){function e(e,t,r,n,o){this.id=e,this.scopes=t,this.resource=r,this.token=n,this.expiry=o}return Object.defineProperty(e.prototype,"isExpired",{get:function(){return this.expiry<=new Date((new Date).getTime()+6e4)},enumerable:!0,configurable:!0}),e.prototype.hasScopes=function(e){var t=this;return this.scopes?e.every(function(e){return t.scopes.some(function(t){return e===t})}):!1},e}(),a=function(){function e(e){var t=this;this.tokenStorage=e,this.cachedTokens={},e&&e.getAll().forEach(function(e){var r=e.id,n=e.scopes,o=e.resource,i=e.token,a=e.expiry,c=new s(r,n,o,i,new Date(a));c.isExpired?t.tokenStorage.remove(c.id):t.cachedTokens[c.id]=c})}return e.prototype.add=function(e){this.cachedTokens[e.id]=e,this.tokenStorage&&this.tokenStorage.add(e.id,e)},e.prototype.getForResource=function(e){var t=this.cachedTokens[e];return t&&t.isExpired?(this.remove(e),null):t},e.prototype.getForScopes=function(e){for(var t in this.cachedTokens){var r=this.cachedTokens[t];if(r.hasScopes(e)){if(!r.isExpired)return r;this.remove(t)}}return null},e.prototype.clear=function(){this.cachedTokens={},this.tokenStorage&&this.tokenStorage.clear()},e.prototype.remove=function(e){this.tokenStorage&&this.tokenStorage.remove(e),delete this.cachedTokens[e]},e}(),c=function(){function e(){}return e}();t.IdToken=c;var u=function(){function e(e){var t=this;this.policy="",this.clientId=e.clientId,this.tokenProcessorUrl=e.tokenProcessingUri,e.version?this.version=e.version:this.version=o.v1,this.tokenCache=new a(e.tokenStorage),window.addEventListener("message",function(e){if("id_token"===e.data.type)if(e.data.error){var r=new i;r.text=e.data.error,t.loginCallback(r)}else if(t.state!==e.data.state){var n=new i;n.statusText="Invalid state",t.loginCallback(n)}else t.decodeIdToken(e.data.token),t.loginCallback(null);else if("access_token"===e.data.type)if(e.data.error){var r=new i;r.text=e.data.error,t.getTokenCallback(null,r)}else{var o=e.data.token,s=document.getElementById("tokenIFrame");if(s.parentNode.removeChild(s),e.data.state!==t.state){var n=new i;n.statusText="Invalid state",t.getTokenCallback(null,n)}else t.getTokenCallback(o,null)}})}return e.prototype.checkForIdentityRedirect=function(){function e(e){var t=window.location.href.indexOf(e);if(0>t)return null;var r=window.location.href.indexOf("&",t+e.length);return window.location.href.substring(t,r>0?r:window.location.href.length)}function t(e){var t=e||window.location.search||"",r=[],n={};if(t=t.replace(/.*?\?/,""),t.length){r=t.split("&");for(var o in r){var i=r[o].split("=")[0];i.length&&("undefined"==typeof n[i]&&(n[i]=[]),n[i].push(r[o].split("=")[1]))}}return n}var r=(t(window.location.href),e("#id_token=")),n=e("#access_token");if(r){return this.decodeIdToken(r),this.loginCallback&&this.loginCallback(null),!0}if(n)throw"Should not get here.  This should be handled via the iframe approach.";return!1},e.prototype.decodeIdToken=function(e){var t=this,r=this.base64Decode(e.substring(e.indexOf(".")+1,e.lastIndexOf("."))),n=JSON.parse(r),o=new Date(new Date("01/01/1970 0:0 UTC").getTime()+1e3*parseInt(n.exp));this.idToken=new c,this.idToken.FullToken=n,this.idToken.Token=e,this.idToken.Expiry=o,this.idToken.UPN=n.upn,this.idToken.TenantId=n.tid,this.idToken.FamilyName=n.family_name,this.idToken.GivenName=n.given_name,this.idToken.Name=n.name,this.idToken.PreferredUsername=n.preferred_username;var i=o.getTime()-(new Date).getTime()-3e5;this.refreshTimer=setTimeout(function(){t.renewIdToken()},i)},e.prototype.decodeAccessToken=function(e,t,r){var n=this.base64Decode(e.substring(e.indexOf(".")+1,e.lastIndexOf("."))),o=JSON.parse(n),i=new Date(new Date("01/01/1970 0:0 UTC").getTime()+1e3*parseInt(o.exp)),a=t||r.join(" "),c=new s(a,r,t,e,i);this.tokenCache.add(c)},e.prototype.getIdToken=function(){return this.idToken},e.prototype.isLoggedIn=function(){return this.idToken?this.idToken.Expiry>new Date:!1},e.prototype.renewIdToken=function(){clearTimeout(this.refreshTimer),this.login(function(){})},e.prototype.getCurrentOauthVersion=function(){return this.version},e.prototype.getAccessTokenAsync=function(e){var t=new n.Deferred;return this.getAccessToken(e,function(e,r){e?t.reject(e):t.resolve(r)}),t.promise},e.prototype.getAccessToken=function(e,t){var r=this;if(this.version!==o.v1){var n=new i;return n.statusText="Currently this identity class is using v2 OAuth mode. You need to use getAccessTokenForScopes() method",void t(n)}var s=this.tokenCache.getForResource(e);if(s)return t(null,s.token);this.getTokenCallback=function(n,o){o?t(o):(r.decodeAccessToken(n,e),t(null,n))},this.nonce="token"+this.generateNonce(),this.state="token"+this.generateNonce();var a=document.createElement("iframe");a.style.display="none",a.id="tokenIFrame",a.src=this.tokenProcessorUrl+"?clientId="+encodeURIComponent(this.clientId)+"&resource="+encodeURIComponent(e)+"&redirectUri="+encodeURIComponent(this.tokenProcessorUrl)+"&state="+encodeURIComponent(this.state)+"&version="+encodeURIComponent(this.version.toString())+"&nonce="+encodeURIComponent(this.nonce)+"&op=token",document.body.appendChild(a)},e.prototype.getAccessTokenForScopesAsync=function(e,t){void 0===t&&(t=!1);var r=new n.Deferred;return this.getAccessTokenForScopes(e,t,function(e,t){t?r.reject(t):r.resolve(e)}),r.promise},e.prototype.getAccessTokenForScopes=function(e,t,r){var n=this;if(void 0===t&&(t=!1),this.version!==o.v2){var s=new i;return s.statusText="Dynamic scopes require v2 mode. Currently this identity class is using v1",void r(null,s)}var a=this.tokenCache.getForScopes(e);if(a)return r(a.token,null);if(this.getTokenCallback=function(o,i){i?t||!i.text?r(null,i):i.text.indexOf("AADSTS65001")>=0?n.getAccessTokenForScopes(e,!0,n.getTokenCallback):r(null,i):(n.decodeAccessToken(o,null,e),r(o,null))},this.nonce="token"+this.generateNonce(),this.state="token"+this.generateNonce(),t)window.open(this.tokenProcessorUrl+"?clientId="+encodeURIComponent(this.clientId)+"&scopes="+encodeURIComponent(e.join(" "))+"&redirectUri="+encodeURIComponent(this.tokenProcessorUrl)+"&version="+encodeURIComponent(this.version.toString())+"&state="+encodeURIComponent(this.state)+"&nonce="+encodeURIComponent(this.nonce)+"&op=token","_blank");else{var c=document.createElement("iframe");c.style.display="none",c.id="tokenIFrame",c.src=this.tokenProcessorUrl+"?clientId="+encodeURIComponent(this.clientId)+"&scopes="+encodeURIComponent(e.join(" "))+"&redirectUri="+encodeURIComponent(this.tokenProcessorUrl)+"&version="+encodeURIComponent(this.version.toString())+"&state="+encodeURIComponent(this.state)+"&nonce="+encodeURIComponent(this.nonce)+"&login_hint="+encodeURIComponent(this.idToken.PreferredUsername)+"&domain_hint="+encodeURIComponent("9188040d-6c67-4c5b-b112-36a304b66dad"===this.idToken.TenantId?"consumers":"organizations")+"&op=token",document.body.appendChild(c)}},e.prototype.loginAsync=function(e){var t=new n.Deferred;return this.login(function(e){e?t.reject(e):t.resolve(null)},e),t.promise},e.prototype.login=function(e,t){if(this.loginCallback=e,t||(t={}),t.policy&&(this.policy=t.policy),t.scopes&&this.version===o.v1){var r=new i;return r.text="Scopes can only be used with OAuth v2.",void e(r)}if(t.policy&&!t.tenant){var r=new i;return r.text="In order to use policy (AAD B2C) a tenant must be specified as well.",void e(r)}this.state="login"+this.generateNonce(),this.nonce="login"+this.generateNonce();var n=this.tokenProcessorUrl+"?clientId="+encodeURIComponent(this.clientId)+"&redirectUri="+encodeURIComponent(this.tokenProcessorUrl)+"&state="+encodeURIComponent(this.state)+"&nonce="+encodeURIComponent(this.nonce)+"&version="+encodeURIComponent(this.version.toString())+"&op=login&p="+encodeURIComponent(this.policy);t.tenant&&(n+="&tenant="+encodeURIComponent(t.tenant)),this.version===o.v2&&(t.scopes||(t.scopes=[]),t.scopes.indexOf("profile")<0&&t.scopes.push("profile"),t.scopes.indexOf("openid")<0&&t.scopes.push("openid"),n+="&scopes="+encodeURIComponent(t.scopes.join(" "))),window.open(n,"_blank")},e.prototype.loginNoWindowAsync=function(e){var t=new n.Deferred;return this.loginNoWindow(function(e){e?t.reject(e):t.resolve(null)},e),t.promise},e.prototype.loginNoWindow=function(e,t){this.loginCallback=e,this.state="clientId="+this.clientId+"&tokenProcessorUrl="+this.tokenProcessorUrl,this.nonce=this.generateNonce();var r=this.checkForIdentityRedirect();if(!r){var n=t?t:window.location.href.split("#")[0],o="https://login.microsoftonline.com/common/oauth2/authorize?response_type=id_token&client_id="+encodeURIComponent(this.clientId)+"&redirect_uri="+encodeURIComponent(n)+"&state="+encodeURIComponent(this.state)+"&nonce="+encodeURIComponent(this.nonce);window.location.href=o}},e.prototype.logOut=function(){this.tokenCache.clear();var e="https://login.microsoftonline.com/common/oauth2/logout?post_logout_redirect_uri="+encodeURI(window.location.href);window.location.href=e},e.prototype.base64Decode=function(e){var t,r,n,o,i={},s=0,a=0,c="",u=String.fromCharCode,p=e.length,h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(t=0;64>t;t++)i[h.charAt(t)]=t;for(n=0;p>n;n++)for(r=i[e.charAt(n)],s=(s<<6)+r,a+=6;a>=8;)((o=s>>>(a-=8)&255)||p-2>n)&&(c+=u(o));return c},e.prototype.generateNonce=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;32>r;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},e}();t.Identity=u},function(e,t){"use strict";function r(e,t){return e?e+(t?"&"+t:""):t}var n=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)},o=function(){function e(e,t){this.pathWithQuery=e,this.scopes=t}return e}();t.Action=o;var i=function(e,t){return e+(t?"?"+t:"")},s=function(){function e(e,t){var n=this;this.path=e,this.query=t,this.addQuery=function(e){return new a(n.path,r(n.query,e),n.actions);
},this.pathWithQuery=i(this.path,this.query),this.path=e,this.query=t}return e}();t.Endpoint=s;var a=function(e){function t(t,r,n){if(e.call(this,t,r),n){for(var o in n)n[o].pathWithQuery=i(t,r);this.actions=n}}return n(t,e),t}(s);t.AddQuery=a;var c=function(e){function t(t,r){e.call(this,t+"/attachments/"+r),this.actions={GET:new o(this.path)}}return n(t,e),t}(s);t.Attachment=c;var u=function(e){return function(t){return new c(e,t)}},p=function(e){function t(t){e.call(this,t+"/attachments"),this.actions={GETCOLLECTION:new o(this.path)}}return n(t,e),t}(s);t.Attachments=p;var h=function(e){return new p(e)},l=function(e){function t(t,r){e.call(this,t+"/messages/"+r),this.actions={GET:new o(this.path),POST:new o(this.path)},this.attachment=u(this.path),this.attachments=h(this.path)}return n(t,e),t}(s);t.Message=l;var d=function(e){return function(t){return new l(e,t)}},f=function(e){function t(t){e.call(this,t+"/messages/"),this.actions={GETCOLLECTION:new o(this.path)}}return n(t,e),t}(s);t.Messages=f;var v=function(e){return new f(e)},y=function(e){function t(t,r){e.call(this,t+"/events/"),this.actions={GET:new o(this.path)},this.attachment=u(this.path),this.attachments=h(this.path)}return n(t,e),t}(s);t.Event=y;var m=function(e){return function(t){return new y(e,t)}},g=function(e){function t(t){e.call(this,t+"/events/"),this.actions={GETCOLLECTION:new o(this.path)}}return n(t,e),t}(s);t.Events=g;var U=function(e){return new g(e)},A=function(e){function t(t,r,n){e.call(this,t+"/calendarView","startDateTime="+r.toString()+"&endDateTime="+n.toString()),this.actions={GETCOLLECTION:new o(i(this.path,this.query))}}return n(t,e),t}(s);t.CalendarView=A;var w=function(e){return function(t,r){return new A(e,t,r)}},k=function(e){function t(t,r){void 0===t&&(t=""),e.call(this,r?t+"/users/"+r:t+"/me"),this.actions={GET:new o(this.path)},this.message=d(this.path),this.messages=v(this.path),this.event=m(this.path),this.events=U(this.path),this.calendarView=w(this.path)}return n(t,e),t}(s);t.User=k;var R=new k("https://graph.microsoft.com/v1.0"),T=function(e){return new k("",e)},F=function(e){function t(t){void 0===t&&(t=""),e.call(this,t+"/users"),this.actions={GETCOLLECTION:new o(this.path)}}return n(t,e),t}(s);t.Users=F;var C=new F,_=function(){function e(){this.me=R,this.user=T,this.users=C}return e}();t.Root=_;var I=function(){function e(){}return e.prototype.getUntypedCollection=function(e,t){return{}},e.prototype.getTypedCollection=function(e,t){return this.getUntyped(e,t)},e.prototype.getCollection=function(e){var t=e.actions&&e.actions.GETCOLLECTION;return t?(console.log("GETCOLLECTION path",t.pathWithQuery),this.getTypedCollection(t.pathWithQuery,t.scopes)):void console.log("no GETCOLLECTION endpoint, sorry!")},e.prototype.getUntyped=function(e,t){return{}},e.prototype.getTyped=function(e,t){},e.prototype.get=function(e){var t=e.actions&&e.actions.GET;return t?(console.log("GET path",t.pathWithQuery),this.getTyped(t.pathWithQuery,t.scopes)):void console.log("no GET endpoint, sorry!")},e.prototype.postUntyped=function(e,t,r){return{}},e.prototype.postTyped=function(e,t,r){return this.postUntyped(e,t,r)},e.prototype.post=function(e,t){var r=e.actions&&e.actions.POST;return r?(console.log("POST path",r.pathWithQuery),this.postTyped(r.pathWithQuery,r.scopes,t)):void console.log("no POST endpoint, sorry!")},e.prototype.patchUntyped=function(e,t,r){return{}},e.prototype.patchTyped=function(e,t,r){return this.patchUntyped(e,t,r)},e.prototype.patch=function(e,t){var r=e.actions&&e.actions.PATCH;return r?(console.log("PATCH path",r.pathWithQuery),this.patchTyped(r.pathWithQuery,r.scopes,t)):void console.log("no PATCH endpoint, sorry!")},e.prototype.deleteUntyped=function(e,t){},e.prototype.deleteTyped=function(e,t){},e.prototype["delete"]=function(e){var t=e.actions.DELETE;t?(console.log("DELETE path",t.pathWithQuery),this.getTyped(t.pathWithQuery,t.scopes)):console.log("no DELETE endpoint, sorry!")},e}();new _,new I}])});
//# sourceMappingURL=kurve.min.js.map