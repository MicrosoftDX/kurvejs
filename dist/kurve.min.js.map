{"version":3,"sources":["webpack:///webpack/universalModuleDefinition","webpack:///dist/kurve.min.js","webpack:///webpack/bootstrap 27368a582cc96073eb14","webpack:///./src/kurve.ts","webpack:///./src/graph.ts","webpack:///./src/promises.ts","webpack:///./src/identity.ts"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","__export","hasOwnProperty","Scopes","__extends","d","b","__","constructor","prototype","Object","create","promises_1","identity_1","Util","rootUrl","General","OpenId","OfflineAccess","User","Read","ReadWrite","ReadBasicAll","ReadAll","ReadWriteAll","Contacts","Directory","AccessAsUserAll","Group","Mail","Send","Calendars","Files","ReadWriteAppFolder","ReadWriteSelected","Tasks","People","Notes","Create","ReadWriteCreatedByApp","DataModelWrapper","graph","_data","defineProperty","get","enumerable","configurable","DataModelListWrapper","_super","apply","arguments","ProfilePhoto","EventsEndpoint","events","callback","odataQuery","eventsForUser","userPrincipalName","eventsAsync","eventsForUserAsync","memberOf","Error","memberOfForUser","memberOfAsync","memberOfForUserAsync","messages","messagesForUser","messagesAsync","messagesForUserAsync","manager","managerForUser","managerAsync","managerForUserAsync","profilePhoto","profilePhotoForUser","profilePhotoAsync","profilePhotoForUserAsync","profilePhotoValue","profilePhotoValueForUser","profilePhotoValueAsync","profilePhotoValueForUserAsync","calendarView","calendarViewAsync","mailFolders","mailFoldersForUser","mailFoldersAsync","mailFoldersForUserAsync","message","messageId","messageForUser","messageAsync","messageForUserAsync","event","eventId","eventForUser","eventAsync","eventForUserAsync","messageAttachment","attachmentId","messageAttachmentForUser","messageAttachmentAsync","messageAttachmentForUserAsync","Users","Message","Messages","Event","Events","endpoint","Contact","Groups","MailFolder","MailFolders","AttachmentType","Attachment","getType","fileAttachment","itemAttachment","referenceAttachment","Attachments","Graph","identityInfo","mode","https","accessToken","KurveIdentity","defaultResourceID","baseUrl","defaultAccessToken","identity","scopesForV2","scopes","getCurrentEndPointVersion","EndPointVersion","v1","meAsync","Deferred","me","error","user","reject","resolve","promise","urlString","buildMeUrl","getUser","userAsync","userId","basicProfileOnly","buildUsersUrl","usersAsync","users","getUsers","groupAsync","groupId","group","buildGroupsUrl","getGroup","groupsAsync","groups","getGroups","getMessage","result","getMessages","getMailFolders","getEvent","getEvents","directReportsForUserAsync","directReportsForUser","getPhoto","getPhotoValue","messageAttachmentsForUserAsync","messageAttachmentsForUser","getMessageAttachments","attachment","getMessageAttachment","getAsync","url","response","responseType","_this","Mode","Client","xhr","XMLHttpRequest","onreadystatechange","readyState","status","responseText","generateError","open","addAccessTokenAndSend","addTokenError","findAccessToken","token","path","substr","length","options","host","port","method","headers","Content-Type","accept","Authorization","post_req","request","setEncoding","on","chunk","end","statusText","text","other","errorGet","usersODATA","JSON","parse","errorODATA","resultsArray","value","map","o","nextLink","userODATA","getAccessTokenForScopes","getAccessToken","setRequestHeader","send","ODATA","ODATAError","messagesODATA","EventId","odata","groupsODATA","photo","attachmentsODATA","attachments","buildUrl","DispatchDeferred","closure","setTimeout","PromiseState","_dispatcher","_successCB","_errorCB","defer","_dispatchCallback","arg","err","dispatcher","_stack","_state","Pending","Promise","then","successCB","errorCB","client","ResolutionInProgress","push","Resolved","_value","Rejected","_error","_resolve","type","pending","i","stackSize","splice","TypeError","_reject","_deferred","successCallback","errorCallback","fail","undefined","CachedToken","resource","expiry","Date","getTime","hasScopes","requiredScopes","every","requiredScope","some","actualScope","TokenCache","tokenStorage","cachedTokens","getAll","forEach","_a","cachedToken","isExpired","remove","add","getForResource","getForScopes","key","clear","IdToken","Identity","identitySettings","policy","clientId","tokenProcessorUrl","tokenProcessingUri","version","appSecret","tokenCache","window","addEventListener","data","e","loginCallback","state","decodeIdToken","getTokenCallback","iframe","document","getElementById","parentNode","removeChild","parseQueryString","str","queryString","location","search","keyValPairs","params","replace","split","pairNum","s","start","indexOf","substring","checkForIdentityRedirect","idToken","href","decodedToken","base64Decode","lastIndexOf","decodedTokenJSON","expiryDate","parseInt","exp","FullToken","Token","Expiry","UPN","upn","TenantId","tid","FamilyName","family_name","GivenName","given_name","Name","name","PreferredUsername","preferred_username","expiration","refreshTimer","renewIdToken","decodeAccessToken","join","getIdToken","isLoggedIn","clearTimeout","login","getAccessTokenAsync","t","nonce","generateNonce","createElement","style","display","src","encodeURIComponent","toString","body","appendChild","cookies","parseNodeCookies","req","NodeRetrieveDataCallBack","code","post_data","post_options","Content-Length","chunkJson","access_token","write","list","rc","cookie","parts","shift","trim","decodeURI","handleNodeCallback","res","crypto","persistDataCallback","retrieveDataCallback","NodePersistDataCallBack","codeFromRequest","stateFromRequest","cachedState","sha","createHash","update","Math","random","sessionID","digest","writeHead","Set-Cookie","Location","content-type","getAccessTokenForScopesAsync","promptForConsent","v2","loginAsync","loginSettings","tenant","loginURL","loginNoWindowAsync","toUrl","loginNoWindow","redirected","redirectUri","logOut","encodeURI","encodedString","x","a","l","r","w","String","fromCharCode","L","A","charAt","chars","floor"],"mappings":"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","file":"dist/kurve.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Kurve\"] = factory();\n\telse\n\t\troot[\"Kurve\"] = factory();\n})(this, function() {\nreturn \n\n\n/** WEBPACK FOOTER **\n ** webpack/universalModuleDefinition\n **/","(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Kurve\"] = factory();\n\telse\n\t\troot[\"Kurve\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tfunction __export(m) {\r\n\t    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n\t}\r\n\t__export(__webpack_require__(1));\r\n\t__export(__webpack_require__(3));\r\n\n\n/***/ },\n/* 1 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar __extends = (this && this.__extends) || function (d, b) {\r\n\t    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n\t    function __() { this.constructor = d; }\r\n\t    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n\t};\r\n\tvar promises_1 = __webpack_require__(2);\r\n\tvar identity_1 = __webpack_require__(3);\r\n\tvar Scopes;\r\n\t(function (Scopes) {\r\n\t    var Util = (function () {\r\n\t        function Util() {\r\n\t        }\r\n\t        Util.rootUrl = \"https://graph.microsoft.com/\";\r\n\t        return Util;\r\n\t    }());\r\n\t    var General = (function () {\r\n\t        function General() {\r\n\t        }\r\n\t        General.OpenId = \"openid\";\r\n\t        General.OfflineAccess = \"offline_access\";\r\n\t        return General;\r\n\t    }());\r\n\t    Scopes.General = General;\r\n\t    var User = (function () {\r\n\t        function User() {\r\n\t        }\r\n\t        User.Read = Util.rootUrl + \"User.Read\";\r\n\t        User.ReadWrite = Util.rootUrl + \"User.ReadWrite\";\r\n\t        User.ReadBasicAll = Util.rootUrl + \"User.ReadBasic.All\";\r\n\t        User.ReadAll = Util.rootUrl + \"User.Read.All\";\r\n\t        User.ReadWriteAll = Util.rootUrl + \"User.ReadWrite.All\";\r\n\t        return User;\r\n\t    }());\r\n\t    Scopes.User = User;\r\n\t    var Contacts = (function () {\r\n\t        function Contacts() {\r\n\t        }\r\n\t        Contacts.Read = Util.rootUrl + \"Contacts.Read\";\r\n\t        Contacts.ReadWrite = Util.rootUrl + \"Contacts.ReadWrite\";\r\n\t        return Contacts;\r\n\t    }());\r\n\t    Scopes.Contacts = Contacts;\r\n\t    var Directory = (function () {\r\n\t        function Directory() {\r\n\t        }\r\n\t        Directory.ReadAll = Util.rootUrl + \"Directory.Read.All\";\r\n\t        Directory.ReadWriteAll = Util.rootUrl + \"Directory.ReadWrite.All\";\r\n\t        Directory.AccessAsUserAll = Util.rootUrl + \"Directory.AccessAsUser.All\";\r\n\t        return Directory;\r\n\t    }());\r\n\t    Scopes.Directory = Directory;\r\n\t    var Group = (function () {\r\n\t        function Group() {\r\n\t        }\r\n\t        Group.ReadAll = Util.rootUrl + \"Group.Read.All\";\r\n\t        Group.ReadWriteAll = Util.rootUrl + \"Group.ReadWrite.All\";\r\n\t        Group.AccessAsUserAll = Util.rootUrl + \"Directory.AccessAsUser.All\";\r\n\t        return Group;\r\n\t    }());\r\n\t    Scopes.Group = Group;\r\n\t    var Mail = (function () {\r\n\t        function Mail() {\r\n\t        }\r\n\t        Mail.Read = Util.rootUrl + \"Mail.Read\";\r\n\t        Mail.ReadWrite = Util.rootUrl + \"Mail.ReadWrite\";\r\n\t        Mail.Send = Util.rootUrl + \"Mail.Send\";\r\n\t        return Mail;\r\n\t    }());\r\n\t    Scopes.Mail = Mail;\r\n\t    var Calendars = (function () {\r\n\t        function Calendars() {\r\n\t        }\r\n\t        Calendars.Read = Util.rootUrl + \"Calendars.Read\";\r\n\t        Calendars.ReadWrite = Util.rootUrl + \"Calendars.ReadWrite\";\r\n\t        return Calendars;\r\n\t    }());\r\n\t    Scopes.Calendars = Calendars;\r\n\t    var Files = (function () {\r\n\t        function Files() {\r\n\t        }\r\n\t        Files.Read = Util.rootUrl + \"Files.Read\";\r\n\t        Files.ReadAll = Util.rootUrl + \"Files.Read.All\";\r\n\t        Files.ReadWrite = Util.rootUrl + \"Files.ReadWrite\";\r\n\t        Files.ReadWriteAppFolder = Util.rootUrl + \"Files.ReadWrite.AppFolder\";\r\n\t        Files.ReadWriteSelected = Util.rootUrl + \"Files.ReadWrite.Selected\";\r\n\t        return Files;\r\n\t    }());\r\n\t    Scopes.Files = Files;\r\n\t    var Tasks = (function () {\r\n\t        function Tasks() {\r\n\t        }\r\n\t        Tasks.ReadWrite = Util.rootUrl + \"Tasks.ReadWrite\";\r\n\t        return Tasks;\r\n\t    }());\r\n\t    Scopes.Tasks = Tasks;\r\n\t    var People = (function () {\r\n\t        function People() {\r\n\t        }\r\n\t        People.Read = Util.rootUrl + \"People.Read\";\r\n\t        People.ReadWrite = Util.rootUrl + \"People.ReadWrite\";\r\n\t        return People;\r\n\t    }());\r\n\t    Scopes.People = People;\r\n\t    var Notes = (function () {\r\n\t        function Notes() {\r\n\t        }\r\n\t        Notes.Create = Util.rootUrl + \"Notes.Create\";\r\n\t        Notes.ReadWriteCreatedByApp = Util.rootUrl + \"Notes.ReadWrite.CreatedByApp\";\r\n\t        Notes.Read = Util.rootUrl + \"Notes.Read\";\r\n\t        Notes.ReadAll = Util.rootUrl + \"Notes.Read.All\";\r\n\t        Notes.ReadWriteAll = Util.rootUrl + \"Notes.ReadWrite.All\";\r\n\t        return Notes;\r\n\t    }());\r\n\t    Scopes.Notes = Notes;\r\n\t})(Scopes = exports.Scopes || (exports.Scopes = {}));\r\n\tvar DataModelWrapper = (function () {\r\n\t    function DataModelWrapper(graph, _data) {\r\n\t        this.graph = graph;\r\n\t        this._data = _data;\r\n\t    }\r\n\t    Object.defineProperty(DataModelWrapper.prototype, \"data\", {\r\n\t        get: function () { return this._data; },\r\n\t        enumerable: true,\r\n\t        configurable: true\r\n\t    });\r\n\t    return DataModelWrapper;\r\n\t}());\r\n\texports.DataModelWrapper = DataModelWrapper;\r\n\tvar DataModelListWrapper = (function (_super) {\r\n\t    __extends(DataModelListWrapper, _super);\r\n\t    function DataModelListWrapper() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    return DataModelListWrapper;\r\n\t}(DataModelWrapper));\r\n\texports.DataModelListWrapper = DataModelListWrapper;\r\n\tvar ProfilePhoto = (function (_super) {\r\n\t    __extends(ProfilePhoto, _super);\r\n\t    function ProfilePhoto() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    return ProfilePhoto;\r\n\t}(DataModelWrapper));\r\n\texports.ProfilePhoto = ProfilePhoto;\r\n\t(function (EventsEndpoint) {\r\n\t    EventsEndpoint[EventsEndpoint[\"events\"] = 0] = \"events\";\r\n\t    EventsEndpoint[EventsEndpoint[\"calendarView\"] = 1] = \"calendarView\";\r\n\t})(exports.EventsEndpoint || (exports.EventsEndpoint = {}));\r\n\tvar EventsEndpoint = exports.EventsEndpoint;\r\n\tvar User = (function (_super) {\r\n\t    __extends(User, _super);\r\n\t    function User() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    User.prototype.events = function (callback, odataQuery) {\r\n\t        this.graph.eventsForUser(this._data.userPrincipalName, EventsEndpoint.events, callback, odataQuery);\r\n\t    };\r\n\t    User.prototype.eventsAsync = function (odataQuery) {\r\n\t        return this.graph.eventsForUserAsync(this._data.userPrincipalName, EventsEndpoint.events, odataQuery);\r\n\t    };\r\n\t    User.prototype.memberOf = function (callback, Error, odataQuery) {\r\n\t        this.graph.memberOfForUser(this._data.userPrincipalName, callback, odataQuery);\r\n\t    };\r\n\t    User.prototype.memberOfAsync = function (odataQuery) {\r\n\t        return this.graph.memberOfForUserAsync(this._data.userPrincipalName, odataQuery);\r\n\t    };\r\n\t    User.prototype.messages = function (callback, odataQuery) {\r\n\t        this.graph.messagesForUser(this._data.userPrincipalName, callback, odataQuery);\r\n\t    };\r\n\t    User.prototype.messagesAsync = function (odataQuery) {\r\n\t        return this.graph.messagesForUserAsync(this._data.userPrincipalName, odataQuery);\r\n\t    };\r\n\t    User.prototype.manager = function (callback, odataQuery) {\r\n\t        this.graph.managerForUser(this._data.userPrincipalName, callback, odataQuery);\r\n\t    };\r\n\t    User.prototype.managerAsync = function (odataQuery) {\r\n\t        return this.graph.managerForUserAsync(this._data.userPrincipalName, odataQuery);\r\n\t    };\r\n\t    User.prototype.profilePhoto = function (callback, odataQuery) {\r\n\t        this.graph.profilePhotoForUser(this._data.userPrincipalName, callback, odataQuery);\r\n\t    };\r\n\t    User.prototype.profilePhotoAsync = function (odataQuery) {\r\n\t        return this.graph.profilePhotoForUserAsync(this._data.userPrincipalName, odataQuery);\r\n\t    };\r\n\t    User.prototype.profilePhotoValue = function (callback, odataQuery) {\r\n\t        this.graph.profilePhotoValueForUser(this._data.userPrincipalName, callback, odataQuery);\r\n\t    };\r\n\t    User.prototype.profilePhotoValueAsync = function (odataQuery) {\r\n\t        return this.graph.profilePhotoValueForUserAsync(this._data.userPrincipalName, odataQuery);\r\n\t    };\r\n\t    User.prototype.calendarView = function (callback, odataQuery) {\r\n\t        this.graph.eventsForUser(this._data.userPrincipalName, EventsEndpoint.calendarView, callback, odataQuery);\r\n\t    };\r\n\t    User.prototype.calendarViewAsync = function (odataQuery) {\r\n\t        return this.graph.eventsForUserAsync(this._data.userPrincipalName, EventsEndpoint.calendarView, odataQuery);\r\n\t    };\r\n\t    User.prototype.mailFolders = function (callback, odataQuery) {\r\n\t        this.graph.mailFoldersForUser(this._data.userPrincipalName, callback, odataQuery);\r\n\t    };\r\n\t    User.prototype.mailFoldersAsync = function (odataQuery) {\r\n\t        return this.graph.mailFoldersForUserAsync(this._data.userPrincipalName, odataQuery);\r\n\t    };\r\n\t    User.prototype.message = function (messageId, callback, odataQuery) {\r\n\t        this.graph.messageForUser(this._data.userPrincipalName, messageId, callback, odataQuery);\r\n\t    };\r\n\t    User.prototype.messageAsync = function (messageId, odataQuery) {\r\n\t        return this.graph.messageForUserAsync(this._data.userPrincipalName, messageId, odataQuery);\r\n\t    };\r\n\t    User.prototype.event = function (eventId, callback, odataQuery) {\r\n\t        this.graph.eventForUser(this._data.userPrincipalName, eventId, callback, odataQuery);\r\n\t    };\r\n\t    User.prototype.eventAsync = function (eventId, odataQuery) {\r\n\t        return this.graph.eventForUserAsync(this._data.userPrincipalName, eventId, odataQuery);\r\n\t    };\r\n\t    User.prototype.messageAttachment = function (messageId, attachmentId, callback, odataQuery) {\r\n\t        this.graph.messageAttachmentForUser(this._data.userPrincipalName, messageId, attachmentId, callback, odataQuery);\r\n\t    };\r\n\t    User.prototype.messageAttachmentAsync = function (messageId, attachmentId, odataQuery) {\r\n\t        return this.graph.messageAttachmentForUserAsync(this._data.userPrincipalName, messageId, attachmentId, odataQuery);\r\n\t    };\r\n\t    return User;\r\n\t}(DataModelWrapper));\r\n\texports.User = User;\r\n\tvar Users = (function (_super) {\r\n\t    __extends(Users, _super);\r\n\t    function Users() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    return Users;\r\n\t}(DataModelListWrapper));\r\n\texports.Users = Users;\r\n\tvar Message = (function (_super) {\r\n\t    __extends(Message, _super);\r\n\t    function Message() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    return Message;\r\n\t}(DataModelWrapper));\r\n\texports.Message = Message;\r\n\tvar Messages = (function (_super) {\r\n\t    __extends(Messages, _super);\r\n\t    function Messages() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    return Messages;\r\n\t}(DataModelListWrapper));\r\n\texports.Messages = Messages;\r\n\tvar Event = (function (_super) {\r\n\t    __extends(Event, _super);\r\n\t    function Event() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    return Event;\r\n\t}(DataModelWrapper));\r\n\texports.Event = Event;\r\n\tvar Events = (function (_super) {\r\n\t    __extends(Events, _super);\r\n\t    function Events(graph, endpoint, _data) {\r\n\t        _super.call(this, graph, _data);\r\n\t        this.graph = graph;\r\n\t        this.endpoint = endpoint;\r\n\t        this._data = _data;\r\n\t    }\r\n\t    return Events;\r\n\t}(DataModelListWrapper));\r\n\texports.Events = Events;\r\n\tvar Contact = (function () {\r\n\t    function Contact() {\r\n\t    }\r\n\t    return Contact;\r\n\t}());\r\n\texports.Contact = Contact;\r\n\tvar Group = (function (_super) {\r\n\t    __extends(Group, _super);\r\n\t    function Group() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    return Group;\r\n\t}(DataModelWrapper));\r\n\texports.Group = Group;\r\n\tvar Groups = (function (_super) {\r\n\t    __extends(Groups, _super);\r\n\t    function Groups() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    return Groups;\r\n\t}(DataModelListWrapper));\r\n\texports.Groups = Groups;\r\n\tvar MailFolder = (function (_super) {\r\n\t    __extends(MailFolder, _super);\r\n\t    function MailFolder() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    return MailFolder;\r\n\t}(DataModelWrapper));\r\n\texports.MailFolder = MailFolder;\r\n\tvar MailFolders = (function (_super) {\r\n\t    __extends(MailFolders, _super);\r\n\t    function MailFolders() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    return MailFolders;\r\n\t}(DataModelListWrapper));\r\n\texports.MailFolders = MailFolders;\r\n\t(function (AttachmentType) {\r\n\t    AttachmentType[AttachmentType[\"fileAttachment\"] = 0] = \"fileAttachment\";\r\n\t    AttachmentType[AttachmentType[\"itemAttachment\"] = 1] = \"itemAttachment\";\r\n\t    AttachmentType[AttachmentType[\"referenceAttachment\"] = 2] = \"referenceAttachment\";\r\n\t})(exports.AttachmentType || (exports.AttachmentType = {}));\r\n\tvar AttachmentType = exports.AttachmentType;\r\n\tvar Attachment = (function (_super) {\r\n\t    __extends(Attachment, _super);\r\n\t    function Attachment() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    Attachment.prototype.getType = function () {\r\n\t        switch (this._data['@odata.type']) {\r\n\t            case \"#microsoft.graph.fileAttachment\":\r\n\t                return AttachmentType.fileAttachment;\r\n\t            case \"#microsoft.graph.itemAttachment\":\r\n\t                return AttachmentType.itemAttachment;\r\n\t            case \"#microsoft.graph.referenceAttachment\":\r\n\t                return AttachmentType.referenceAttachment;\r\n\t        }\r\n\t    };\r\n\t    return Attachment;\r\n\t}(DataModelWrapper));\r\n\texports.Attachment = Attachment;\r\n\tvar Attachments = (function (_super) {\r\n\t    __extends(Attachments, _super);\r\n\t    function Attachments() {\r\n\t        _super.apply(this, arguments);\r\n\t    }\r\n\t    return Attachments;\r\n\t}(DataModelListWrapper));\r\n\texports.Attachments = Attachments;\r\n\tvar Graph = (function () {\r\n\t    function Graph(identityInfo, mode, https) {\r\n\t        this.accessToken = null;\r\n\t        this.KurveIdentity = null;\r\n\t        this.defaultResourceID = \"https://graph.microsoft.com\";\r\n\t        this.baseUrl = \"https://graph.microsoft.com/v1.0/\";\r\n\t        if (https)\r\n\t            this.https = https;\r\n\t        this.mode = mode;\r\n\t        if (identityInfo.defaultAccessToken) {\r\n\t            this.accessToken = identityInfo.defaultAccessToken;\r\n\t        }\r\n\t        else {\r\n\t            this.KurveIdentity = identityInfo.identity;\r\n\t        }\r\n\t    }\r\n\t    Graph.prototype.scopesForV2 = function (scopes) {\r\n\t        if (!this.KurveIdentity)\r\n\t            return null;\r\n\t        if (this.KurveIdentity.getCurrentEndPointVersion() === identity_1.EndPointVersion.v1)\r\n\t            return null;\r\n\t        else\r\n\t            return scopes;\r\n\t    };\r\n\t    Graph.prototype.meAsync = function (odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.me(function (error, user) { return error ? d.reject(error) : d.resolve(user); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.me = function (callback, odataQuery) {\r\n\t        var scopes = [Scopes.User.Read];\r\n\t        var urlString = this.buildMeUrl(\"\", odataQuery);\r\n\t        this.getUser(urlString, callback, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.userAsync = function (userId, odataQuery, basicProfileOnly) {\r\n\t        if (basicProfileOnly === void 0) { basicProfileOnly = true; }\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.user(userId, function (error, user) { return error ? d.reject(error) : d.resolve(user); }, odataQuery, basicProfileOnly);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.user = function (userId, callback, odataQuery, basicProfileOnly) {\r\n\t        if (basicProfileOnly === void 0) { basicProfileOnly = true; }\r\n\t        var scopes = basicProfileOnly ? [Scopes.User.ReadBasicAll] : [Scopes.User.ReadAll];\r\n\t        var urlString = this.buildUsersUrl(userId, odataQuery);\r\n\t        this.getUser(urlString, callback, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.usersAsync = function (odataQuery, basicProfileOnly) {\r\n\t        if (basicProfileOnly === void 0) { basicProfileOnly = true; }\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.users(function (error, users) { return error ? d.reject(error) : d.resolve(users); }, odataQuery, basicProfileOnly);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.users = function (callback, odataQuery, basicProfileOnly) {\r\n\t        if (basicProfileOnly === void 0) { basicProfileOnly = true; }\r\n\t        var scopes = basicProfileOnly ? [Scopes.User.ReadBasicAll] : [Scopes.User.ReadAll];\r\n\t        var urlString = this.buildUsersUrl(\"\", odataQuery);\r\n\t        this.getUsers(urlString, callback, this.scopesForV2(scopes), basicProfileOnly);\r\n\t    };\r\n\t    Graph.prototype.groupAsync = function (groupId, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.group(groupId, function (error, group) { return error ? d.reject(error) : d.resolve(group); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.group = function (groupId, callback, odataQuery) {\r\n\t        var scopes = [Scopes.Group.ReadAll];\r\n\t        var urlString = this.buildGroupsUrl(groupId, odataQuery);\r\n\t        this.getGroup(urlString, callback, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.groupsAsync = function (odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.groups(function (error, groups) { return error ? d.reject(error) : d.resolve(groups); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.groups = function (callback, odataQuery) {\r\n\t        var scopes = [Scopes.Group.ReadAll];\r\n\t        var urlString = this.buildGroupsUrl(\"\", odataQuery);\r\n\t        this.getGroups(urlString, callback, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.messageForUserAsync = function (userPrincipalName, messageId, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.messageForUser(userPrincipalName, messageId, function (error, message) { return error ? d.reject(error) : d.resolve(message); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.messageForUser = function (userPrincipalName, messageId, callback, odataQuery) {\r\n\t        var scopes = [Scopes.Mail.Read];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/messages/\" + messageId, odataQuery);\r\n\t        this.getMessage(urlString, messageId, function (error, result) { return callback(error, result); }, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.messagesForUserAsync = function (userPrincipalName, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.messagesForUser(userPrincipalName, function (error, messages) { return error ? d.reject(error) : d.resolve(messages); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.messagesForUser = function (userPrincipalName, callback, odataQuery) {\r\n\t        var scopes = [Scopes.Mail.Read];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/messages\", odataQuery);\r\n\t        this.getMessages(urlString, function (error, result) { return callback(error, result); }, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.mailFoldersForUserAsync = function (userPrincipalName, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.mailFoldersForUser(userPrincipalName, function (error, messages) { return error ? d.reject(error) : d.resolve(messages); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.mailFoldersForUser = function (userPrincipalName, callback, odataQuery) {\r\n\t        var scopes = [Scopes.Mail.Read];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/mailFolders\", odataQuery);\r\n\t        this.getMailFolders(urlString, function (error, result) { return callback(error, result); }, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.eventForUserAsync = function (userPrincipalName, eventId, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.eventForUser(userPrincipalName, eventId, function (error, event) { return error ? d.reject(error) : d.resolve(event); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.eventForUser = function (userPrincipalName, eventId, callback, odataQuery) {\r\n\t        var scopes = [Scopes.Calendars.Read];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/events/\" + eventId, odataQuery);\r\n\t        this.getEvent(urlString, eventId, function (error, result) { return callback(error, result); }, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.eventsForUserAsync = function (userPrincipalName, endpoint, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.eventsForUser(userPrincipalName, endpoint, function (error, events) { return error ? d.reject(error) : d.resolve(events); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.eventsForUser = function (userPrincipalName, endpoint, callback, odataQuery) {\r\n\t        var scopes = [Scopes.Calendars.Read];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/\" + EventsEndpoint[endpoint], odataQuery);\r\n\t        this.getEvents(urlString, endpoint, function (error, result) { return callback(error, result); }, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.memberOfForUserAsync = function (userPrincipalName, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.memberOfForUser(userPrincipalName, function (error, groups) { return error ? d.reject(error) : d.resolve(groups); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.memberOfForUser = function (userPrincipalName, callback, odataQuery) {\r\n\t        var scopes = [Scopes.Group.ReadAll];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/memberOf\", odataQuery);\r\n\t        this.getGroups(urlString, callback, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.managerForUserAsync = function (userPrincipalName, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.managerForUser(userPrincipalName, function (error, user) { return error ? d.reject(error) : d.resolve(user); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.managerForUser = function (userPrincipalName, callback, odataQuery) {\r\n\t        var scopes = [Scopes.Directory.ReadAll];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/manager\", odataQuery);\r\n\t        this.getUser(urlString, callback, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.directReportsForUserAsync = function (userPrincipalName, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.directReportsForUser(userPrincipalName, function (error, users) { return error ? d.reject(error) : d.resolve(users); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.directReportsForUser = function (userPrincipalName, callback, odataQuery) {\r\n\t        var scopes = [Scopes.Directory.ReadAll];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/directReports\", odataQuery);\r\n\t        this.getUsers(urlString, callback, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.profilePhotoForUserAsync = function (userPrincipalName, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.profilePhotoForUser(userPrincipalName, function (error, profilePhoto) { return error ? d.reject(error) : d.resolve(profilePhoto); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.profilePhotoForUser = function (userPrincipalName, callback, odataQuery) {\r\n\t        var scopes = [Scopes.User.ReadBasicAll];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/photo\", odataQuery);\r\n\t        this.getPhoto(urlString, callback, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.profilePhotoValueForUserAsync = function (userPrincipalName, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.profilePhotoValueForUser(userPrincipalName, function (error, result) { return error ? d.reject(error) : d.resolve(result); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.profilePhotoValueForUser = function (userPrincipalName, callback, odataQuery) {\r\n\t        var scopes = [Scopes.User.ReadBasicAll];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/photo/$value\", odataQuery);\r\n\t        this.getPhotoValue(urlString, callback, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.messageAttachmentsForUserAsync = function (userPrincipalName, messageId, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.messageAttachmentsForUser(userPrincipalName, messageId, function (error, result) { return error ? d.reject(error) : d.resolve(result); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.messageAttachmentsForUser = function (userPrincipalName, messageId, callback, odataQuery) {\r\n\t        var scopes = [Scopes.Mail.Read];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/messages/\" + messageId + \"/attachments\", odataQuery);\r\n\t        this.getMessageAttachments(urlString, callback, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.messageAttachmentForUserAsync = function (userPrincipalName, messageId, attachmentId, odataQuery) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.messageAttachmentForUser(userPrincipalName, messageId, attachmentId, function (error, attachment) { return error ? d.reject(error) : d.resolve(attachment); }, odataQuery);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.messageAttachmentForUser = function (userPrincipalName, messageId, attachmentId, callback, odataQuery) {\r\n\t        var scopes = [Scopes.Mail.Read];\r\n\t        var urlString = this.buildUsersUrl(userPrincipalName + \"/messages/\" + messageId + \"/attachments/\" + attachmentId, odataQuery);\r\n\t        this.getMessageAttachment(urlString, callback, this.scopesForV2(scopes));\r\n\t    };\r\n\t    Graph.prototype.getAsync = function (url) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.get(url, function (error, response) { return error ? d.reject(error) : d.resolve(response); });\r\n\t        return d.promise;\r\n\t    };\r\n\t    Graph.prototype.get = function (url, callback, responseType, scopes) {\r\n\t        var _this = this;\r\n\t        if (this.mode === identity_1.Mode.Client) {\r\n\t            var xhr = new XMLHttpRequest();\r\n\t            if (responseType)\r\n\t                xhr.responseType = responseType;\r\n\t            xhr.onreadystatechange = function () {\r\n\t                if (xhr.readyState === 4)\r\n\t                    if (xhr.status === 200)\r\n\t                        callback(null, responseType ? xhr.response : xhr.responseText);\r\n\t                    else\r\n\t                        callback(_this.generateError(xhr));\r\n\t            };\r\n\t            xhr.open(\"GET\", url);\r\n\t            this.addAccessTokenAndSend(xhr, function (addTokenError) {\r\n\t                if (addTokenError) {\r\n\t                    callback(addTokenError);\r\n\t                }\r\n\t            }, scopes);\r\n\t        }\r\n\t        else {\r\n\t            var token = this.findAccessToken(function (token, error) {\r\n\t                var path = url.substr(27, url.length);\r\n\t                var options = {\r\n\t                    host: 'graph.microsoft.com',\r\n\t                    port: '443',\r\n\t                    path: path,\r\n\t                    method: 'GET',\r\n\t                    headers: {\r\n\t                        'Content-Type': responseType,\r\n\t                        accept: '*/*',\r\n\t                        'Authorization': 'Bearer ' + token\r\n\t                    }\r\n\t                };\r\n\t                var post_req = _this.https.request(options, function (response) {\r\n\t                    response.setEncoding('utf8');\r\n\t                    response.on('data', function (chunk) {\r\n\t                        callback(null, chunk);\r\n\t                    });\r\n\t                });\r\n\t                post_req.end();\r\n\t            }, scopes);\r\n\t        }\r\n\t    };\r\n\t    Graph.prototype.generateError = function (xhr) {\r\n\t        var response = new identity_1.Error();\r\n\t        response.status = xhr.status;\r\n\t        response.statusText = xhr.statusText;\r\n\t        if (xhr.responseType === '' || xhr.responseType === 'text')\r\n\t            response.text = xhr.responseText;\r\n\t        else\r\n\t            response.other = xhr.response;\r\n\t        return response;\r\n\t    };\r\n\t    Graph.prototype.getUsers = function (urlString, callback, scopes, basicProfileOnly) {\r\n\t        var _this = this;\r\n\t        if (basicProfileOnly === void 0) { basicProfileOnly = true; }\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var usersODATA = JSON.parse(result);\r\n\t            if (usersODATA.error) {\r\n\t                var errorODATA = new identity_1.Error();\r\n\t                errorODATA.other = usersODATA.error;\r\n\t                callback(errorODATA);\r\n\t                return;\r\n\t            }\r\n\t            var resultsArray = (usersODATA.value ? usersODATA.value : [usersODATA]);\r\n\t            var users = new Users(_this, resultsArray.map(function (o) { return new User(_this, o); }));\r\n\t            var nextLink = usersODATA['@odata.nextLink'];\r\n\t            if (nextLink) {\r\n\t                users.nextLink = function (callback) {\r\n\t                    var scopes = basicProfileOnly ? [Scopes.User.ReadBasicAll] : [Scopes.User.ReadAll];\r\n\t                    var d = new promises_1.Deferred();\r\n\t                    _this.getUsers(nextLink, function (error, result) {\r\n\t                        if (callback)\r\n\t                            callback(error, result);\r\n\t                        else\r\n\t                            error ? d.reject(error) : d.resolve(result);\r\n\t                    }, _this.scopesForV2(scopes), basicProfileOnly);\r\n\t                    return d.promise;\r\n\t                };\r\n\t            }\r\n\t            callback(null, users);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.getUser = function (urlString, callback, scopes) {\r\n\t        var _this = this;\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var userODATA = JSON.parse(result);\r\n\t            if (userODATA.error) {\r\n\t                var errorODATA = new identity_1.Error();\r\n\t                errorODATA.other = userODATA.error;\r\n\t                callback(errorODATA);\r\n\t                return;\r\n\t            }\r\n\t            var user = new User(_this, userODATA);\r\n\t            callback(null, user);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.findAccessToken = function (callback, scopes) {\r\n\t        if (this.accessToken) {\r\n\t            callback(this.accessToken, null);\r\n\t        }\r\n\t        else {\r\n\t            if (scopes) {\r\n\t                this.KurveIdentity.getAccessTokenForScopes(scopes, false, (function (token, error) {\r\n\t                    if (error)\r\n\t                        callback(null, error);\r\n\t                    else {\r\n\t                        callback(token, null);\r\n\t                    }\r\n\t                }));\r\n\t            }\r\n\t            else {\r\n\t                this.KurveIdentity.getAccessToken(this.defaultResourceID, (function (error, token) {\r\n\t                    if (error)\r\n\t                        callback(null, error);\r\n\t                    else {\r\n\t                        callback(token, null);\r\n\t                    }\r\n\t                }));\r\n\t            }\r\n\t        }\r\n\t    };\r\n\t    Graph.prototype.addAccessTokenAndSend = function (xhr, callback, scopes) {\r\n\t        this.findAccessToken(function (token, error) {\r\n\t            if (token) {\r\n\t                xhr.setRequestHeader('Authorization', 'Bearer ' + token);\r\n\t                xhr.send();\r\n\t            }\r\n\t            else {\r\n\t                callback(error);\r\n\t            }\r\n\t        }, scopes);\r\n\t    };\r\n\t    Graph.prototype.getMessage = function (urlString, messageId, callback, scopes) {\r\n\t        var _this = this;\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var ODATA = JSON.parse(result);\r\n\t            if (ODATA.error) {\r\n\t                var ODATAError = new identity_1.Error();\r\n\t                ODATAError.other = ODATA.error;\r\n\t                callback(ODATAError);\r\n\t                return;\r\n\t            }\r\n\t            var message = new Message(_this, ODATA);\r\n\t            callback(null, message);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.getMessages = function (urlString, callback, scopes) {\r\n\t        var _this = this;\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var messagesODATA = JSON.parse(result);\r\n\t            if (messagesODATA.error) {\r\n\t                var errorODATA = new identity_1.Error();\r\n\t                errorODATA.other = messagesODATA.error;\r\n\t                callback(errorODATA);\r\n\t                return;\r\n\t            }\r\n\t            var resultsArray = (messagesODATA.value ? messagesODATA.value : [messagesODATA]);\r\n\t            var messages = new Messages(_this, resultsArray.map(function (o) { return new Message(_this, o); }));\r\n\t            var nextLink = messagesODATA['@odata.nextLink'];\r\n\t            if (nextLink) {\r\n\t                messages.nextLink = function (callback) {\r\n\t                    var scopes = [Scopes.Mail.Read];\r\n\t                    var d = new promises_1.Deferred();\r\n\t                    _this.getMessages(nextLink, function (error, messages) {\r\n\t                        if (callback)\r\n\t                            callback(error, messages);\r\n\t                        else\r\n\t                            error ? d.reject(error) : d.resolve(messages);\r\n\t                    }, _this.scopesForV2(scopes));\r\n\t                    return d.promise;\r\n\t                };\r\n\t            }\r\n\t            callback(null, messages);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.getEvent = function (urlString, EventId, callback, scopes) {\r\n\t        var _this = this;\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var ODATA = JSON.parse(result);\r\n\t            if (ODATA.error) {\r\n\t                var ODATAError = new identity_1.Error();\r\n\t                ODATAError.other = ODATA.error;\r\n\t                callback(ODATAError);\r\n\t                return;\r\n\t            }\r\n\t            var event = new Event(_this, ODATA);\r\n\t            callback(null, event);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.getEvents = function (urlString, endpoint, callback, scopes) {\r\n\t        var _this = this;\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var odata = JSON.parse(result);\r\n\t            if (odata.error) {\r\n\t                var errorODATA = new identity_1.Error();\r\n\t                errorODATA.other = odata.error;\r\n\t                callback(errorODATA);\r\n\t                return;\r\n\t            }\r\n\t            var resultsArray = (odata.value ? odata.value : [odata]);\r\n\t            var events = new Events(_this, endpoint, resultsArray.map(function (o) { return new Event(_this, o); }));\r\n\t            var nextLink = odata['@odata.nextLink'];\r\n\t            if (nextLink) {\r\n\t                events.nextLink = function (callback) {\r\n\t                    var scopes = [Scopes.Mail.Read];\r\n\t                    var d = new promises_1.Deferred();\r\n\t                    _this.getEvents(nextLink, endpoint, function (error, result) {\r\n\t                        if (callback)\r\n\t                            callback(error, result);\r\n\t                        else\r\n\t                            error ? d.reject(error) : d.resolve(result);\r\n\t                    }, _this.scopesForV2(scopes));\r\n\t                    return d.promise;\r\n\t                };\r\n\t            }\r\n\t            callback(null, events);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.getGroups = function (urlString, callback, scopes) {\r\n\t        var _this = this;\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var groupsODATA = JSON.parse(result);\r\n\t            if (groupsODATA.error) {\r\n\t                var errorODATA = new identity_1.Error();\r\n\t                errorODATA.other = groupsODATA.error;\r\n\t                callback(errorODATA);\r\n\t                return;\r\n\t            }\r\n\t            var resultsArray = (groupsODATA.value ? groupsODATA.value : [groupsODATA]);\r\n\t            var groups = new Groups(_this, resultsArray.map(function (o) { return new Group(_this, o); }));\r\n\t            var nextLink = groupsODATA['@odata.nextLink'];\r\n\t            if (nextLink) {\r\n\t                groups.nextLink = function (callback) {\r\n\t                    var scopes = [Scopes.Group.ReadAll];\r\n\t                    var d = new promises_1.Deferred();\r\n\t                    _this.getGroups(nextLink, function (error, result) {\r\n\t                        if (callback)\r\n\t                            callback(error, result);\r\n\t                        else\r\n\t                            error ? d.reject(error) : d.resolve(result);\r\n\t                    }, _this.scopesForV2(scopes));\r\n\t                    return d.promise;\r\n\t                };\r\n\t            }\r\n\t            callback(null, groups);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.getGroup = function (urlString, callback, scopes) {\r\n\t        var _this = this;\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var ODATA = JSON.parse(result);\r\n\t            if (ODATA.error) {\r\n\t                var ODATAError = new identity_1.Error();\r\n\t                ODATAError.other = ODATA.error;\r\n\t                callback(ODATAError);\r\n\t                return;\r\n\t            }\r\n\t            var group = new Group(_this, ODATA);\r\n\t            callback(null, group);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.getPhoto = function (urlString, callback, scopes) {\r\n\t        var _this = this;\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var ODATA = JSON.parse(result);\r\n\t            if (ODATA.error) {\r\n\t                var errorODATA = new identity_1.Error();\r\n\t                errorODATA.other = ODATA.error;\r\n\t                callback(errorODATA);\r\n\t                return;\r\n\t            }\r\n\t            var photo = new ProfilePhoto(_this, ODATA);\r\n\t            callback(null, photo);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.getPhotoValue = function (urlString, callback, scopes) {\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(null, errorGet);\r\n\t                return;\r\n\t            }\r\n\t            callback(result);\r\n\t        }, \"blob\", scopes);\r\n\t    };\r\n\t    Graph.prototype.getMailFolders = function (urlString, callback, scopes) {\r\n\t        var _this = this;\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var odata = JSON.parse(result);\r\n\t            if (odata.error) {\r\n\t                var errorODATA = new identity_1.Error();\r\n\t                errorODATA.other = odata.error;\r\n\t                callback(errorODATA);\r\n\t            }\r\n\t            var resultsArray = (odata.value ? odata.value : [odata]);\r\n\t            var mailFolders = new MailFolders(_this, resultsArray.map(function (o) { return new MailFolder(_this, o); }));\r\n\t            var nextLink = odata['@odata.nextLink'];\r\n\t            if (nextLink) {\r\n\t                mailFolders.nextLink = function (callback) {\r\n\t                    var scopes = [Scopes.User.ReadAll];\r\n\t                    var d = new promises_1.Deferred();\r\n\t                    _this.getMailFolders(nextLink, function (error, result) {\r\n\t                        if (callback)\r\n\t                            callback(error, result);\r\n\t                        else\r\n\t                            error ? d.reject(error) : d.resolve(result);\r\n\t                    }, _this.scopesForV2(scopes));\r\n\t                    return d.promise;\r\n\t                };\r\n\t            }\r\n\t            callback(null, mailFolders);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.getMessageAttachments = function (urlString, callback, scopes) {\r\n\t        var _this = this;\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var attachmentsODATA = JSON.parse(result);\r\n\t            if (attachmentsODATA.error) {\r\n\t                var errorODATA = new identity_1.Error();\r\n\t                errorODATA.other = attachmentsODATA.error;\r\n\t                callback(errorODATA);\r\n\t                return;\r\n\t            }\r\n\t            var resultsArray = (attachmentsODATA.value ? attachmentsODATA.value : [attachmentsODATA]);\r\n\t            var attachments = new Attachments(_this, resultsArray.map(function (o) { return new Attachment(_this, o); }));\r\n\t            var nextLink = attachmentsODATA['@odata.nextLink'];\r\n\t            if (nextLink) {\r\n\t                attachments.nextLink = function (callback) {\r\n\t                    var scopes = [Scopes.Mail.Read];\r\n\t                    var d = new promises_1.Deferred();\r\n\t                    _this.getMessageAttachments(nextLink, function (error, attachments) {\r\n\t                        if (callback)\r\n\t                            callback(error, attachments);\r\n\t                        else\r\n\t                            error ? d.reject(error) : d.resolve(attachments);\r\n\t                    }, _this.scopesForV2(scopes));\r\n\t                    return d.promise;\r\n\t                };\r\n\t            }\r\n\t            callback(null, attachments);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.getMessageAttachment = function (urlString, callback, scopes) {\r\n\t        var _this = this;\r\n\t        this.get(urlString, function (errorGet, result) {\r\n\t            if (errorGet) {\r\n\t                callback(errorGet);\r\n\t                return;\r\n\t            }\r\n\t            var ODATA = JSON.parse(result);\r\n\t            if (ODATA.error) {\r\n\t                var ODATAError = new identity_1.Error();\r\n\t                ODATAError.other = ODATA.error;\r\n\t                callback(ODATAError);\r\n\t                return;\r\n\t            }\r\n\t            var attachment = new Attachment(_this, ODATA);\r\n\t            callback(null, attachment);\r\n\t        }, null, scopes);\r\n\t    };\r\n\t    Graph.prototype.buildUrl = function (root, path, odataQuery) {\r\n\t        return this.baseUrl + root + path + (odataQuery ? \"?\" + odataQuery : \"\");\r\n\t    };\r\n\t    Graph.prototype.buildMeUrl = function (path, odataQuery) {\r\n\t        if (path === void 0) { path = \"\"; }\r\n\t        return this.buildUrl(\"me/\", path, odataQuery);\r\n\t    };\r\n\t    Graph.prototype.buildUsersUrl = function (path, odataQuery) {\r\n\t        if (path === void 0) { path = \"\"; }\r\n\t        return this.buildUrl(\"users/\", path, odataQuery);\r\n\t    };\r\n\t    Graph.prototype.buildGroupsUrl = function (path, odataQuery) {\r\n\t        if (path === void 0) { path = \"\"; }\r\n\t        return this.buildUrl(\"groups/\", path, odataQuery);\r\n\t    };\r\n\t    return Graph;\r\n\t}());\r\n\texports.Graph = Graph;\r\n\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t\"use strict\";\r\n\tfunction DispatchDeferred(closure) {\r\n\t    setTimeout(closure, 0);\r\n\t}\r\n\tvar PromiseState;\r\n\t(function (PromiseState) {\r\n\t    PromiseState[PromiseState[\"Pending\"] = 0] = \"Pending\";\r\n\t    PromiseState[PromiseState[\"ResolutionInProgress\"] = 1] = \"ResolutionInProgress\";\r\n\t    PromiseState[PromiseState[\"Resolved\"] = 2] = \"Resolved\";\r\n\t    PromiseState[PromiseState[\"Rejected\"] = 3] = \"Rejected\";\r\n\t})(PromiseState || (PromiseState = {}));\r\n\tvar Client = (function () {\r\n\t    function Client(_dispatcher, _successCB, _errorCB) {\r\n\t        this._dispatcher = _dispatcher;\r\n\t        this._successCB = _successCB;\r\n\t        this._errorCB = _errorCB;\r\n\t        this.result = new Deferred(_dispatcher);\r\n\t    }\r\n\t    Client.prototype.resolve = function (value, defer) {\r\n\t        var _this = this;\r\n\t        if (typeof (this._successCB) !== 'function') {\r\n\t            this.result.resolve(value);\r\n\t            return;\r\n\t        }\r\n\t        if (defer) {\r\n\t            this._dispatcher(function () { return _this._dispatchCallback(_this._successCB, value); });\r\n\t        }\r\n\t        else {\r\n\t            this._dispatchCallback(this._successCB, value);\r\n\t        }\r\n\t    };\r\n\t    Client.prototype.reject = function (error, defer) {\r\n\t        var _this = this;\r\n\t        if (typeof (this._errorCB) !== 'function') {\r\n\t            this.result.reject(error);\r\n\t            return;\r\n\t        }\r\n\t        if (defer) {\r\n\t            this._dispatcher(function () { return _this._dispatchCallback(_this._errorCB, error); });\r\n\t        }\r\n\t        else {\r\n\t            this._dispatchCallback(this._errorCB, error);\r\n\t        }\r\n\t    };\r\n\t    Client.prototype._dispatchCallback = function (callback, arg) {\r\n\t        var result, then, type;\r\n\t        try {\r\n\t            result = callback(arg);\r\n\t            this.result.resolve(result);\r\n\t        }\r\n\t        catch (err) {\r\n\t            this.result.reject(err);\r\n\t            return;\r\n\t        }\r\n\t    };\r\n\t    return Client;\r\n\t}());\r\n\tvar Deferred = (function () {\r\n\t    function Deferred(dispatcher) {\r\n\t        this._stack = [];\r\n\t        this._state = PromiseState.Pending;\r\n\t        if (dispatcher)\r\n\t            this._dispatcher = dispatcher;\r\n\t        else\r\n\t            this._dispatcher = DispatchDeferred;\r\n\t        this.promise = new Promise(this);\r\n\t    }\r\n\t    Deferred.prototype.DispatchDeferred = function (closure) {\r\n\t        setTimeout(closure, 0);\r\n\t    };\r\n\t    Deferred.prototype.then = function (successCB, errorCB) {\r\n\t        if (typeof (successCB) !== 'function' && typeof (errorCB) !== 'function') {\r\n\t            return this.promise;\r\n\t        }\r\n\t        var client = new Client(this._dispatcher, successCB, errorCB);\r\n\t        switch (this._state) {\r\n\t            case PromiseState.Pending:\r\n\t            case PromiseState.ResolutionInProgress:\r\n\t                this._stack.push(client);\r\n\t                break;\r\n\t            case PromiseState.Resolved:\r\n\t                client.resolve(this._value, true);\r\n\t                break;\r\n\t            case PromiseState.Rejected:\r\n\t                client.reject(this._error, true);\r\n\t                break;\r\n\t        }\r\n\t        return client.result.promise;\r\n\t    };\r\n\t    Deferred.prototype.resolve = function (value) {\r\n\t        if (this._state !== PromiseState.Pending) {\r\n\t            return this;\r\n\t        }\r\n\t        return this._resolve(value);\r\n\t    };\r\n\t    Deferred.prototype._resolve = function (value) {\r\n\t        var _this = this;\r\n\t        var type = typeof (value), then, pending = true;\r\n\t        try {\r\n\t            if (value !== null &&\r\n\t                (type === 'object' || type === 'function') &&\r\n\t                typeof (then = value.then) === 'function') {\r\n\t                if (value === this.promise) {\r\n\t                    throw new TypeError('recursive resolution');\r\n\t                }\r\n\t                this._state = PromiseState.ResolutionInProgress;\r\n\t                then.call(value, function (result) {\r\n\t                    if (pending) {\r\n\t                        pending = false;\r\n\t                        _this._resolve(result);\r\n\t                    }\r\n\t                }, function (error) {\r\n\t                    if (pending) {\r\n\t                        pending = false;\r\n\t                        _this._reject(error);\r\n\t                    }\r\n\t                });\r\n\t            }\r\n\t            else {\r\n\t                this._state = PromiseState.ResolutionInProgress;\r\n\t                this._dispatcher(function () {\r\n\t                    _this._state = PromiseState.Resolved;\r\n\t                    _this._value = value;\r\n\t                    var i, stackSize = _this._stack.length;\r\n\t                    for (i = 0; i < stackSize; i++) {\r\n\t                        _this._stack[i].resolve(value, false);\r\n\t                    }\r\n\t                    _this._stack.splice(0, stackSize);\r\n\t                });\r\n\t            }\r\n\t        }\r\n\t        catch (err) {\r\n\t            if (pending) {\r\n\t                this._reject(err);\r\n\t            }\r\n\t        }\r\n\t        return this;\r\n\t    };\r\n\t    Deferred.prototype.reject = function (error) {\r\n\t        if (this._state !== PromiseState.Pending) {\r\n\t            return this;\r\n\t        }\r\n\t        return this._reject(error);\r\n\t    };\r\n\t    Deferred.prototype._reject = function (error) {\r\n\t        var _this = this;\r\n\t        this._state = PromiseState.ResolutionInProgress;\r\n\t        this._dispatcher(function () {\r\n\t            _this._state = PromiseState.Rejected;\r\n\t            _this._error = error;\r\n\t            var stackSize = _this._stack.length, i = 0;\r\n\t            for (i = 0; i < stackSize; i++) {\r\n\t                _this._stack[i].reject(error, false);\r\n\t            }\r\n\t            _this._stack.splice(0, stackSize);\r\n\t        });\r\n\t        return this;\r\n\t    };\r\n\t    return Deferred;\r\n\t}());\r\n\texports.Deferred = Deferred;\r\n\tvar Promise = (function () {\r\n\t    function Promise(_deferred) {\r\n\t        this._deferred = _deferred;\r\n\t    }\r\n\t    Promise.prototype.then = function (successCallback, errorCallback) {\r\n\t        return this._deferred.then(successCallback, errorCallback);\r\n\t    };\r\n\t    Promise.prototype.fail = function (errorCallback) {\r\n\t        return this._deferred.then(undefined, errorCallback);\r\n\t    };\r\n\t    return Promise;\r\n\t}());\r\n\texports.Promise = Promise;\r\n\n\n/***/ },\n/* 3 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t\"use strict\";\r\n\tvar promises_1 = __webpack_require__(2);\r\n\t(function (EndPointVersion) {\r\n\t    EndPointVersion[EndPointVersion[\"v1\"] = 1] = \"v1\";\r\n\t    EndPointVersion[EndPointVersion[\"v2\"] = 2] = \"v2\";\r\n\t})(exports.EndPointVersion || (exports.EndPointVersion = {}));\r\n\tvar EndPointVersion = exports.EndPointVersion;\r\n\t(function (Mode) {\r\n\t    Mode[Mode[\"Client\"] = 1] = \"Client\";\r\n\t    Mode[Mode[\"Node\"] = 2] = \"Node\";\r\n\t})(exports.Mode || (exports.Mode = {}));\r\n\tvar Mode = exports.Mode;\r\n\tvar Error = (function () {\r\n\t    function Error() {\r\n\t    }\r\n\t    return Error;\r\n\t}());\r\n\texports.Error = Error;\r\n\tvar CachedToken = (function () {\r\n\t    function CachedToken(id, scopes, resource, token, expiry) {\r\n\t        this.id = id;\r\n\t        this.scopes = scopes;\r\n\t        this.resource = resource;\r\n\t        this.token = token;\r\n\t        this.expiry = expiry;\r\n\t    }\r\n\t    ;\r\n\t    Object.defineProperty(CachedToken.prototype, \"isExpired\", {\r\n\t        get: function () {\r\n\t            return this.expiry <= new Date(new Date().getTime() + 60000);\r\n\t        },\r\n\t        enumerable: true,\r\n\t        configurable: true\r\n\t    });\r\n\t    CachedToken.prototype.hasScopes = function (requiredScopes) {\r\n\t        var _this = this;\r\n\t        if (!this.scopes) {\r\n\t            return false;\r\n\t        }\r\n\t        return requiredScopes.every(function (requiredScope) {\r\n\t            return _this.scopes.some(function (actualScope) { return requiredScope === actualScope; });\r\n\t        });\r\n\t    };\r\n\t    return CachedToken;\r\n\t}());\r\n\tvar TokenCache = (function () {\r\n\t    function TokenCache(tokenStorage) {\r\n\t        var _this = this;\r\n\t        this.tokenStorage = tokenStorage;\r\n\t        this.cachedTokens = {};\r\n\t        if (tokenStorage) {\r\n\t            tokenStorage.getAll().forEach(function (_a) {\r\n\t                var id = _a.id, scopes = _a.scopes, resource = _a.resource, token = _a.token, expiry = _a.expiry;\r\n\t                var cachedToken = new CachedToken(id, scopes, resource, token, new Date(expiry));\r\n\t                if (cachedToken.isExpired) {\r\n\t                    _this.tokenStorage.remove(cachedToken.id);\r\n\t                }\r\n\t                else {\r\n\t                    _this.cachedTokens[cachedToken.id] = cachedToken;\r\n\t                }\r\n\t            });\r\n\t        }\r\n\t    }\r\n\t    TokenCache.prototype.add = function (token) {\r\n\t        this.cachedTokens[token.id] = token;\r\n\t        this.tokenStorage && this.tokenStorage.add(token.id, token);\r\n\t    };\r\n\t    TokenCache.prototype.getForResource = function (resource) {\r\n\t        var cachedToken = this.cachedTokens[resource];\r\n\t        if (cachedToken && cachedToken.isExpired) {\r\n\t            this.remove(resource);\r\n\t            return null;\r\n\t        }\r\n\t        return cachedToken;\r\n\t    };\r\n\t    TokenCache.prototype.getForScopes = function (scopes) {\r\n\t        for (var key in this.cachedTokens) {\r\n\t            var cachedToken = this.cachedTokens[key];\r\n\t            if (cachedToken.hasScopes(scopes)) {\r\n\t                if (cachedToken.isExpired) {\r\n\t                    this.remove(key);\r\n\t                }\r\n\t                else {\r\n\t                    return cachedToken;\r\n\t                }\r\n\t            }\r\n\t        }\r\n\t        return null;\r\n\t    };\r\n\t    TokenCache.prototype.clear = function () {\r\n\t        this.cachedTokens = {};\r\n\t        this.tokenStorage && this.tokenStorage.clear();\r\n\t    };\r\n\t    TokenCache.prototype.remove = function (key) {\r\n\t        this.tokenStorage && this.tokenStorage.remove(key);\r\n\t        delete this.cachedTokens[key];\r\n\t    };\r\n\t    return TokenCache;\r\n\t}());\r\n\tvar IdToken = (function () {\r\n\t    function IdToken() {\r\n\t    }\r\n\t    return IdToken;\r\n\t}());\r\n\texports.IdToken = IdToken;\r\n\tvar Identity = (function () {\r\n\t    function Identity(identitySettings) {\r\n\t        var _this = this;\r\n\t        this.policy = \"\";\r\n\t        this.mode = Mode.Client;\r\n\t        this.clientId = identitySettings.clientId;\r\n\t        this.tokenProcessorUrl = identitySettings.tokenProcessingUri;\r\n\t        if (identitySettings.version)\r\n\t            this.version = identitySettings.version;\r\n\t        else\r\n\t            this.version = EndPointVersion.v1;\r\n\t        if (identitySettings.appSecret)\r\n\t            this.appSecret = identitySettings.appSecret;\r\n\t        this.mode = identitySettings.mode;\r\n\t        if (this.mode === Mode.Client) {\r\n\t            this.tokenCache = new TokenCache(identitySettings.tokenStorage);\r\n\t            window.addEventListener(\"message\", function (event) {\r\n\t                if (event.data.type === \"id_token\") {\r\n\t                    if (event.data.error) {\r\n\t                        var e = new Error();\r\n\t                        e.text = event.data.error;\r\n\t                        _this.loginCallback(e);\r\n\t                    }\r\n\t                    else {\r\n\t                        if (_this.state !== event.data.state) {\r\n\t                            var error = new Error();\r\n\t                            error.statusText = \"Invalid state\";\r\n\t                            _this.loginCallback(error);\r\n\t                        }\r\n\t                        else {\r\n\t                            _this.decodeIdToken(event.data.token);\r\n\t                            _this.loginCallback(null);\r\n\t                        }\r\n\t                    }\r\n\t                }\r\n\t                else if (event.data.type === \"access_token\") {\r\n\t                    if (event.data.error) {\r\n\t                        var e = new Error();\r\n\t                        e.text = event.data.error;\r\n\t                        _this.getTokenCallback(null, e);\r\n\t                    }\r\n\t                    else {\r\n\t                        var token = event.data.token;\r\n\t                        var iframe = document.getElementById(\"tokenIFrame\");\r\n\t                        iframe.parentNode.removeChild(iframe);\r\n\t                        if (event.data.state !== _this.state) {\r\n\t                            var error = new Error();\r\n\t                            error.statusText = \"Invalid state\";\r\n\t                            _this.getTokenCallback(null, error);\r\n\t                        }\r\n\t                        else {\r\n\t                            _this.getTokenCallback(token, null);\r\n\t                        }\r\n\t                    }\r\n\t                }\r\n\t            });\r\n\t        }\r\n\t    }\r\n\t    Identity.prototype.parseQueryString = function (str) {\r\n\t        var queryString = str || window.location.search || '';\r\n\t        var keyValPairs = [];\r\n\t        var params = {};\r\n\t        queryString = queryString.replace(/.*?\\?/, \"\");\r\n\t        if (queryString.length) {\r\n\t            keyValPairs = queryString.split('&');\r\n\t            for (var pairNum in keyValPairs) {\r\n\t                var key = keyValPairs[pairNum].split('=')[0];\r\n\t                if (!key.length)\r\n\t                    continue;\r\n\t                if (typeof params[key] === 'undefined')\r\n\t                    params[key] = [];\r\n\t                params[key].push(keyValPairs[pairNum].split('=')[1]);\r\n\t            }\r\n\t        }\r\n\t        return params;\r\n\t    };\r\n\t    Identity.prototype.token = function (s, url) {\r\n\t        var start = url.indexOf(s);\r\n\t        if (start < 0)\r\n\t            return null;\r\n\t        var end = url.indexOf(\"&\", start + s.length);\r\n\t        return url.substring(start, ((end > 0) ? end : url.length));\r\n\t    };\r\n\t    Identity.prototype.checkForIdentityRedirect = function () {\r\n\t        var params = this.parseQueryString(window.location.href);\r\n\t        var idToken = this.token(\"#id_token=\", window.location.href);\r\n\t        var accessToken = this.token(\"#access_token\", window.location.href);\r\n\t        if (idToken) {\r\n\t            if (true) {\r\n\t                this.decodeIdToken(idToken);\r\n\t                this.loginCallback && this.loginCallback(null);\r\n\t            }\r\n\t            else {\r\n\t                var error = new Error();\r\n\t                error.statusText = \"Invalid state\";\r\n\t                this.loginCallback && this.loginCallback(error);\r\n\t            }\r\n\t            return true;\r\n\t        }\r\n\t        else if (accessToken) {\r\n\t            throw \"Should not get here.  This should be handled via the iframe approach.\";\r\n\t        }\r\n\t        return false;\r\n\t    };\r\n\t    Identity.prototype.decodeIdToken = function (idToken) {\r\n\t        var _this = this;\r\n\t        var decodedToken = this.base64Decode(idToken.substring(idToken.indexOf('.') + 1, idToken.lastIndexOf('.')));\r\n\t        var decodedTokenJSON = JSON.parse(decodedToken);\r\n\t        var expiryDate = new Date(new Date('01/01/1970 0:0 UTC').getTime() + parseInt(decodedTokenJSON.exp) * 1000);\r\n\t        this.idToken = new IdToken();\r\n\t        this.idToken.FullToken = decodedTokenJSON;\r\n\t        this.idToken.Token = idToken;\r\n\t        this.idToken.Expiry = expiryDate;\r\n\t        this.idToken.UPN = decodedTokenJSON.upn;\r\n\t        this.idToken.TenantId = decodedTokenJSON.tid;\r\n\t        this.idToken.FamilyName = decodedTokenJSON.family_name;\r\n\t        this.idToken.GivenName = decodedTokenJSON.given_name;\r\n\t        this.idToken.Name = decodedTokenJSON.name;\r\n\t        this.idToken.PreferredUsername = decodedTokenJSON.preferred_username;\r\n\t        var expiration = expiryDate.getTime() - new Date().getTime() - 300000;\r\n\t        this.refreshTimer = setTimeout((function () {\r\n\t            _this.renewIdToken();\r\n\t        }), expiration);\r\n\t    };\r\n\t    Identity.prototype.decodeAccessToken = function (accessToken, resource, scopes) {\r\n\t        var decodedToken = this.base64Decode(accessToken.substring(accessToken.indexOf('.') + 1, accessToken.lastIndexOf('.')));\r\n\t        var decodedTokenJSON = JSON.parse(decodedToken);\r\n\t        var expiryDate = new Date(new Date('01/01/1970 0:0 UTC').getTime() + parseInt(decodedTokenJSON.exp) * 1000);\r\n\t        var key = resource || scopes.join(\" \");\r\n\t        var token = new CachedToken(key, scopes, resource, accessToken, expiryDate);\r\n\t        return token;\r\n\t    };\r\n\t    Identity.prototype.getIdToken = function () {\r\n\t        return this.idToken;\r\n\t    };\r\n\t    Identity.prototype.isLoggedIn = function () {\r\n\t        if (!this.idToken)\r\n\t            return false;\r\n\t        return (this.idToken.Expiry > new Date());\r\n\t    };\r\n\t    Identity.prototype.renewIdToken = function () {\r\n\t        clearTimeout(this.refreshTimer);\r\n\t        this.login(function () { });\r\n\t    };\r\n\t    Identity.prototype.getCurrentEndPointVersion = function () {\r\n\t        return this.version;\r\n\t    };\r\n\t    Identity.prototype.getAccessTokenAsync = function (resource) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.getAccessToken(resource, (function (error, token) {\r\n\t            if (error) {\r\n\t                d.reject(error);\r\n\t            }\r\n\t            else {\r\n\t                d.resolve(token);\r\n\t            }\r\n\t        }));\r\n\t        return d.promise;\r\n\t    };\r\n\t    Identity.prototype.getAccessToken = function (resource, callback) {\r\n\t        var _this = this;\r\n\t        if (this.version !== EndPointVersion.v1) {\r\n\t            var e = new Error();\r\n\t            e.statusText = \"Currently this identity class is using v2 endpoint mode. You need to use getAccessTokenForScopes() method\";\r\n\t            callback(e);\r\n\t            return;\r\n\t        }\r\n\t        if (this.mode === Mode.Client) {\r\n\t            var token = this.tokenCache.getForResource(resource);\r\n\t            if (token) {\r\n\t                return callback(null, token.token);\r\n\t            }\r\n\t            this.getTokenCallback = (function (token, error) {\r\n\t                if (error) {\r\n\t                    callback(error);\r\n\t                }\r\n\t                else {\r\n\t                    var t = _this.decodeAccessToken(token, resource);\r\n\t                    _this.tokenCache.add(t);\r\n\t                    callback(null, token);\r\n\t                }\r\n\t            });\r\n\t            this.nonce = \"token\" + this.generateNonce();\r\n\t            this.state = \"token\" + this.generateNonce();\r\n\t            var iframe = document.createElement('iframe');\r\n\t            iframe.style.display = \"none\";\r\n\t            iframe.id = \"tokenIFrame\";\r\n\t            iframe.src = this.tokenProcessorUrl + \"?clientId=\" + encodeURIComponent(this.clientId) +\r\n\t                \"&resource=\" + encodeURIComponent(resource) +\r\n\t                \"&redirectUri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n\t                \"&state=\" + encodeURIComponent(this.state) +\r\n\t                \"&version=\" + encodeURIComponent(this.version.toString()) +\r\n\t                \"&nonce=\" + encodeURIComponent(this.nonce) +\r\n\t                \"&op=token\";\r\n\t            document.body.appendChild(iframe);\r\n\t        }\r\n\t        else {\r\n\t            var cookies = this.parseNodeCookies(this.req);\r\n\t            var upn = this.NodeRetrieveDataCallBack(\"session|\" + cookies[\"kurveSession\"]);\r\n\t            var code = this.NodeRetrieveDataCallBack(\"code|\" + upn);\r\n\t            var post_data = \"grant_type=authorization_code\" +\r\n\t                \"&client_id=\" + encodeURIComponent(this.clientId) +\r\n\t                \"&code=\" + encodeURIComponent(code) +\r\n\t                \"&redirect_uri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n\t                \"&resource=\" + encodeURIComponent(resource) +\r\n\t                \"&client_secret=\" + encodeURIComponent(this.appSecret);\r\n\t            var post_options = {\r\n\t                host: 'login.microsoftonline.com',\r\n\t                port: '443',\r\n\t                path: '/common/oauth2/token',\r\n\t                method: 'POST',\r\n\t                headers: {\r\n\t                    'Content-Type': 'application/x-www-form-urlencoded',\r\n\t                    'Content-Length': post_data.length,\r\n\t                    accept: '*/*'\r\n\t                }\r\n\t            };\r\n\t            var post_req = this.https.request(post_options, function (response) {\r\n\t                response.setEncoding('utf8');\r\n\t                response.on('data', function (chunk) {\r\n\t                    var chunkJson = JSON.parse(chunk);\r\n\t                    var t = _this.decodeAccessToken(chunkJson.access_token, resource);\r\n\t                    callback(null, chunkJson.access_token);\r\n\t                });\r\n\t            });\r\n\t            post_req.write(post_data);\r\n\t            post_req.end();\r\n\t        }\r\n\t    };\r\n\t    Identity.prototype.parseNodeCookies = function (req) {\r\n\t        var list = {};\r\n\t        var rc = req.headers.cookie;\r\n\t        rc && rc.split(';').forEach(function (cookie) {\r\n\t            var parts = cookie.split('=');\r\n\t            list[parts.shift().trim()] = decodeURI(parts.join('='));\r\n\t        });\r\n\t        return list;\r\n\t    };\r\n\t    Identity.prototype.handleNodeCallback = function (req, res, https, crypto, persistDataCallback, retrieveDataCallback) {\r\n\t        var _this = this;\r\n\t        this.NodePersistDataCallBack = persistDataCallback;\r\n\t        this.NodeRetrieveDataCallBack = retrieveDataCallback;\r\n\t        var url = req.url;\r\n\t        this.req = req;\r\n\t        this.res = res;\r\n\t        this.https = https;\r\n\t        var params = this.parseQueryString(url);\r\n\t        var code = this.token(\"code=\", url);\r\n\t        var accessToken = this.token(\"#access_token\", url);\r\n\t        var cookies = this.parseNodeCookies(req);\r\n\t        var d = new promises_1.Deferred();\r\n\t        if (this.version === EndPointVersion.v1) {\r\n\t            if (code) {\r\n\t                var codeFromRequest = params[\"code\"][0];\r\n\t                var stateFromRequest = params[\"state\"][0];\r\n\t                var cachedState = retrieveDataCallback(\"state|\" + stateFromRequest);\r\n\t                if (cachedState) {\r\n\t                    if (cachedState === \"waiting\") {\r\n\t                        var expiry = new Date(new Date().getTime() + 86400000);\r\n\t                        persistDataCallback(\"state|\" + stateFromRequest, \"done\", expiry);\r\n\t                        var post_data = \"grant_type=authorization_code\" +\r\n\t                            \"&client_id=\" + encodeURIComponent(this.clientId) +\r\n\t                            \"&code=\" + encodeURIComponent(codeFromRequest) +\r\n\t                            \"&redirect_uri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n\t                            \"&resource=\" + encodeURIComponent(\"https://graph.microsoft.com\") +\r\n\t                            \"&client_secret=\" + encodeURIComponent(this.appSecret);\r\n\t                        var post_options = {\r\n\t                            host: 'login.microsoftonline.com',\r\n\t                            port: '443',\r\n\t                            path: '/common/oauth2/token',\r\n\t                            method: 'POST',\r\n\t                            headers: {\r\n\t                                'Content-Type': 'application/x-www-form-urlencoded',\r\n\t                                'Content-Length': post_data.length,\r\n\t                                accept: '*/*'\r\n\t                            }\r\n\t                        };\r\n\t                        var post_req = https.request(post_options, function (response) {\r\n\t                            response.setEncoding('utf8');\r\n\t                            response.on('data', function (chunk) {\r\n\t                                var chunkJson = JSON.parse(chunk);\r\n\t                                var decodedToken = JSON.parse(_this.base64Decode(chunkJson.access_token.substring(chunkJson.access_token.indexOf('.') + 1, chunkJson.access_token.lastIndexOf('.'))));\r\n\t                                var upn = decodedToken.upn;\r\n\t                                var sha = crypto.createHash('sha256');\r\n\t                                sha.update(Math.random().toString());\r\n\t                                var sessionID = sha.digest('hex');\r\n\t                                var expiry = new Date(new Date().getTime() + 30 * 60 * 1000);\r\n\t                                persistDataCallback(\"session|\" + sessionID, upn, expiry);\r\n\t                                persistDataCallback(\"code|\" + upn, codeFromRequest, expiry);\r\n\t                                res.writeHead(302, {\r\n\t                                    'Set-Cookie': 'kurveSession=' + sessionID,\r\n\t                                    'Location': '/'\r\n\t                                });\r\n\t                                res.end();\r\n\t                                d.resolve(false);\r\n\t                            });\r\n\t                        });\r\n\t                        post_req.write(post_data);\r\n\t                        post_req.end();\r\n\t                    }\r\n\t                    else {\r\n\t                        res.writeHead(500, \"Replay detected\", { 'content-type': 'text/plain' });\r\n\t                        res.end(\"Replay detected\");\r\n\t                        d.resolve(false);\r\n\t                    }\r\n\t                }\r\n\t                else {\r\n\t                    res.writeHead(500, \"State doesn't match\", { 'content-type': 'text/plain' });\r\n\t                    res.end(\"State doesn't match\");\r\n\t                    d.resolve(false);\r\n\t                }\r\n\t                return d.promise;\r\n\t            }\r\n\t            else {\r\n\t                if (cookies[\"kurveSession\"]) {\r\n\t                    var upn = retrieveDataCallback(\"session|\" + cookies[\"kurveSession\"]);\r\n\t                    if (upn) {\r\n\t                        d.resolve(true);\r\n\t                        return d.promise;\r\n\t                    }\r\n\t                }\r\n\t                var state = this.generateNonce();\r\n\t                var expiry = new Date(new Date().getTime() + 900000);\r\n\t                persistDataCallback(\"state|\" + state, \"waiting\", expiry);\r\n\t                var url = \"https://login.microsoftonline.com/common/oauth2/authorize?response_type=code&client_id=\" +\r\n\t                    encodeURIComponent(this.clientId) +\r\n\t                    \"&redirect_uri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n\t                    \"&state=\" + encodeURIComponent(state);\r\n\t                res.writeHead(302, { 'Location': url });\r\n\t                res.end();\r\n\t                d.resolve(false);\r\n\t                return d.promise;\r\n\t            }\r\n\t        }\r\n\t        else {\r\n\t            d.resolve(false);\r\n\t            return d.promise;\r\n\t        }\r\n\t    };\r\n\t    Identity.prototype.getAccessTokenForScopesAsync = function (scopes, promptForConsent) {\r\n\t        if (promptForConsent === void 0) { promptForConsent = false; }\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.getAccessTokenForScopes(scopes, promptForConsent, function (token, error) {\r\n\t            if (error) {\r\n\t                d.reject(error);\r\n\t            }\r\n\t            else {\r\n\t                d.resolve(token);\r\n\t            }\r\n\t        });\r\n\t        return d.promise;\r\n\t    };\r\n\t    Identity.prototype.getAccessTokenForScopes = function (scopes, promptForConsent, callback) {\r\n\t        var _this = this;\r\n\t        if (promptForConsent === void 0) { promptForConsent = false; }\r\n\t        if (this.version !== EndPointVersion.v2) {\r\n\t            var e = new Error();\r\n\t            e.statusText = \"Dynamic scopes require v2 mode. Currently this identity class is using v1\";\r\n\t            callback(null, e);\r\n\t            return;\r\n\t        }\r\n\t        var token = this.tokenCache.getForScopes(scopes);\r\n\t        if (token) {\r\n\t            return callback(token.token, null);\r\n\t        }\r\n\t        this.getTokenCallback = (function (token, error) {\r\n\t            if (error) {\r\n\t                if (promptForConsent || !error.text) {\r\n\t                    callback(null, error);\r\n\t                }\r\n\t                else if (error.text.indexOf(\"AADSTS65001\") >= 0) {\r\n\t                    _this.getAccessTokenForScopes(scopes, true, _this.getTokenCallback);\r\n\t                }\r\n\t                else {\r\n\t                    callback(null, error);\r\n\t                }\r\n\t            }\r\n\t            else {\r\n\t                var t = _this.decodeAccessToken(token, null, scopes);\r\n\t                _this.tokenCache.add(t);\r\n\t                callback(token, null);\r\n\t            }\r\n\t        });\r\n\t        this.nonce = \"token\" + this.generateNonce();\r\n\t        this.state = \"token\" + this.generateNonce();\r\n\t        if (!promptForConsent) {\r\n\t            var iframe = document.createElement('iframe');\r\n\t            iframe.style.display = \"none\";\r\n\t            iframe.id = \"tokenIFrame\";\r\n\t            iframe.src = this.tokenProcessorUrl + \"?clientId=\" + encodeURIComponent(this.clientId) +\r\n\t                \"&scopes=\" + encodeURIComponent(scopes.join(\" \")) +\r\n\t                \"&redirectUri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n\t                \"&version=\" + encodeURIComponent(this.version.toString()) +\r\n\t                \"&state=\" + encodeURIComponent(this.state) +\r\n\t                \"&nonce=\" + encodeURIComponent(this.nonce) +\r\n\t                \"&login_hint=\" + encodeURIComponent(this.idToken.PreferredUsername) +\r\n\t                \"&domain_hint=\" + encodeURIComponent(this.idToken.TenantId === \"9188040d-6c67-4c5b-b112-36a304b66dad\" ? \"consumers\" : \"organizations\") +\r\n\t                \"&op=token\";\r\n\t            document.body.appendChild(iframe);\r\n\t        }\r\n\t        else {\r\n\t            window.open(this.tokenProcessorUrl + \"?clientId=\" + encodeURIComponent(this.clientId) +\r\n\t                \"&scopes=\" + encodeURIComponent(scopes.join(\" \")) +\r\n\t                \"&redirectUri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n\t                \"&version=\" + encodeURIComponent(this.version.toString()) +\r\n\t                \"&state=\" + encodeURIComponent(this.state) +\r\n\t                \"&nonce=\" + encodeURIComponent(this.nonce) +\r\n\t                \"&op=token\", \"_blank\");\r\n\t        }\r\n\t    };\r\n\t    Identity.prototype.loginAsync = function (loginSettings) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.login(function (error) {\r\n\t            if (error) {\r\n\t                d.reject(error);\r\n\t            }\r\n\t            else {\r\n\t                d.resolve(null);\r\n\t            }\r\n\t        }, loginSettings);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Identity.prototype.login = function (callback, loginSettings) {\r\n\t        this.loginCallback = callback;\r\n\t        if (!loginSettings)\r\n\t            loginSettings = {};\r\n\t        if (loginSettings.policy)\r\n\t            this.policy = loginSettings.policy;\r\n\t        if (loginSettings.scopes && this.version === EndPointVersion.v1) {\r\n\t            var e = new Error();\r\n\t            e.text = \"Scopes can only be used with endpoint v2.\";\r\n\t            callback(e);\r\n\t            return;\r\n\t        }\r\n\t        if (loginSettings.policy && !loginSettings.tenant) {\r\n\t            var e = new Error();\r\n\t            e.text = \"In order to use policy (AAD B2C) a tenant must be specified as well.\";\r\n\t            callback(e);\r\n\t            return;\r\n\t        }\r\n\t        this.state = \"login\" + this.generateNonce();\r\n\t        this.nonce = \"login\" + this.generateNonce();\r\n\t        var loginURL = this.tokenProcessorUrl + \"?clientId=\" + encodeURIComponent(this.clientId) +\r\n\t            \"&redirectUri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n\t            \"&state=\" + encodeURIComponent(this.state) +\r\n\t            \"&nonce=\" + encodeURIComponent(this.nonce) +\r\n\t            \"&version=\" + encodeURIComponent(this.version.toString()) +\r\n\t            \"&op=login\" +\r\n\t            \"&p=\" + encodeURIComponent(this.policy);\r\n\t        if (loginSettings.tenant) {\r\n\t            loginURL += \"&tenant=\" + encodeURIComponent(loginSettings.tenant);\r\n\t        }\r\n\t        if (this.version === EndPointVersion.v2) {\r\n\t            if (!loginSettings.scopes)\r\n\t                loginSettings.scopes = [];\r\n\t            if (loginSettings.scopes.indexOf(\"profile\") < 0)\r\n\t                loginSettings.scopes.push(\"profile\");\r\n\t            if (loginSettings.scopes.indexOf(\"openid\") < 0)\r\n\t                loginSettings.scopes.push(\"openid\");\r\n\t            loginURL += \"&scopes=\" + encodeURIComponent(loginSettings.scopes.join(\" \"));\r\n\t        }\r\n\t        window.open(loginURL, \"_blank\");\r\n\t    };\r\n\t    Identity.prototype.loginNoWindowAsync = function (toUrl) {\r\n\t        var d = new promises_1.Deferred();\r\n\t        this.loginNoWindow(function (error) {\r\n\t            if (error) {\r\n\t                d.reject(error);\r\n\t            }\r\n\t            else {\r\n\t                d.resolve(null);\r\n\t            }\r\n\t        }, toUrl);\r\n\t        return d.promise;\r\n\t    };\r\n\t    Identity.prototype.loginNoWindow = function (callback, toUrl) {\r\n\t        this.loginCallback = callback;\r\n\t        this.state = \"clientId=\" + this.clientId + \"&\" + \"tokenProcessorUrl=\" + this.tokenProcessorUrl;\r\n\t        this.nonce = this.generateNonce();\r\n\t        var redirected = this.checkForIdentityRedirect();\r\n\t        if (!redirected) {\r\n\t            var redirectUri = (toUrl) ? toUrl : window.location.href.split(\"#\")[0];\r\n\t            var url = \"https://login.microsoftonline.com/common/oauth2/authorize?response_type=id_token\" +\r\n\t                \"&client_id=\" + encodeURIComponent(this.clientId) +\r\n\t                \"&redirect_uri=\" + encodeURIComponent(redirectUri) +\r\n\t                \"&state=\" + encodeURIComponent(this.state) +\r\n\t                \"&nonce=\" + encodeURIComponent(this.nonce);\r\n\t            window.location.href = url;\r\n\t        }\r\n\t    };\r\n\t    Identity.prototype.logOut = function () {\r\n\t        this.tokenCache.clear();\r\n\t        var url = \"https://login.microsoftonline.com/common/oauth2/logout?post_logout_redirect_uri=\" + encodeURI(window.location.href);\r\n\t        window.location.href = url;\r\n\t    };\r\n\t    Identity.prototype.base64Decode = function (encodedString) {\r\n\t        var e = {}, i, b = 0, c, x, l = 0, a, r = '', w = String.fromCharCode, L = encodedString.length;\r\n\t        var A = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\r\n\t        for (i = 0; i < 64; i++) {\r\n\t            e[A.charAt(i)] = i;\r\n\t        }\r\n\t        for (x = 0; x < L; x++) {\r\n\t            c = e[encodedString.charAt(x)];\r\n\t            b = (b << 6) + c;\r\n\t            l += 6;\r\n\t            while (l >= 8) {\r\n\t                ((a = (b >>> (l -= 8)) & 0xff) || (x < (L - 2))) && (r += w(a));\r\n\t            }\r\n\t        }\r\n\t        return r;\r\n\t    };\r\n\t    Identity.prototype.generateNonce = function () {\r\n\t        var text = \"\";\r\n\t        var chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n\t        for (var i = 0; i < 32; i++) {\r\n\t            text += chars.charAt(Math.floor(Math.random() * chars.length));\r\n\t        }\r\n\t        return text;\r\n\t    };\r\n\t    return Identity;\r\n\t}());\r\n\texports.Identity = Identity;\r\n\n\n/***/ }\n/******/ ])\n});\n;\n\n\n/** WEBPACK FOOTER **\n ** dist/kurve.min.js\n **/"," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 27368a582cc96073eb14\n **/","\"use strict\";\r\nfunction __export(m) {\r\n    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];\r\n}\r\n__export(require(\"./graph\"));\r\n__export(require(\"./identity\"));\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/kurve.ts\n ** module id = 0\n ** module chunks = 0\n **/","\"use strict\";\r\nvar __extends = (this && this.__extends) || function (d, b) {\r\n    for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\r\n    function __() { this.constructor = d; }\r\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n};\r\nvar promises_1 = require(\"./promises\");\r\nvar identity_1 = require(\"./identity\");\r\nvar Scopes;\r\n(function (Scopes) {\r\n    var Util = (function () {\r\n        function Util() {\r\n        }\r\n        Util.rootUrl = \"https://graph.microsoft.com/\";\r\n        return Util;\r\n    }());\r\n    var General = (function () {\r\n        function General() {\r\n        }\r\n        General.OpenId = \"openid\";\r\n        General.OfflineAccess = \"offline_access\";\r\n        return General;\r\n    }());\r\n    Scopes.General = General;\r\n    var User = (function () {\r\n        function User() {\r\n        }\r\n        User.Read = Util.rootUrl + \"User.Read\";\r\n        User.ReadWrite = Util.rootUrl + \"User.ReadWrite\";\r\n        User.ReadBasicAll = Util.rootUrl + \"User.ReadBasic.All\";\r\n        User.ReadAll = Util.rootUrl + \"User.Read.All\";\r\n        User.ReadWriteAll = Util.rootUrl + \"User.ReadWrite.All\";\r\n        return User;\r\n    }());\r\n    Scopes.User = User;\r\n    var Contacts = (function () {\r\n        function Contacts() {\r\n        }\r\n        Contacts.Read = Util.rootUrl + \"Contacts.Read\";\r\n        Contacts.ReadWrite = Util.rootUrl + \"Contacts.ReadWrite\";\r\n        return Contacts;\r\n    }());\r\n    Scopes.Contacts = Contacts;\r\n    var Directory = (function () {\r\n        function Directory() {\r\n        }\r\n        Directory.ReadAll = Util.rootUrl + \"Directory.Read.All\";\r\n        Directory.ReadWriteAll = Util.rootUrl + \"Directory.ReadWrite.All\";\r\n        Directory.AccessAsUserAll = Util.rootUrl + \"Directory.AccessAsUser.All\";\r\n        return Directory;\r\n    }());\r\n    Scopes.Directory = Directory;\r\n    var Group = (function () {\r\n        function Group() {\r\n        }\r\n        Group.ReadAll = Util.rootUrl + \"Group.Read.All\";\r\n        Group.ReadWriteAll = Util.rootUrl + \"Group.ReadWrite.All\";\r\n        Group.AccessAsUserAll = Util.rootUrl + \"Directory.AccessAsUser.All\";\r\n        return Group;\r\n    }());\r\n    Scopes.Group = Group;\r\n    var Mail = (function () {\r\n        function Mail() {\r\n        }\r\n        Mail.Read = Util.rootUrl + \"Mail.Read\";\r\n        Mail.ReadWrite = Util.rootUrl + \"Mail.ReadWrite\";\r\n        Mail.Send = Util.rootUrl + \"Mail.Send\";\r\n        return Mail;\r\n    }());\r\n    Scopes.Mail = Mail;\r\n    var Calendars = (function () {\r\n        function Calendars() {\r\n        }\r\n        Calendars.Read = Util.rootUrl + \"Calendars.Read\";\r\n        Calendars.ReadWrite = Util.rootUrl + \"Calendars.ReadWrite\";\r\n        return Calendars;\r\n    }());\r\n    Scopes.Calendars = Calendars;\r\n    var Files = (function () {\r\n        function Files() {\r\n        }\r\n        Files.Read = Util.rootUrl + \"Files.Read\";\r\n        Files.ReadAll = Util.rootUrl + \"Files.Read.All\";\r\n        Files.ReadWrite = Util.rootUrl + \"Files.ReadWrite\";\r\n        Files.ReadWriteAppFolder = Util.rootUrl + \"Files.ReadWrite.AppFolder\";\r\n        Files.ReadWriteSelected = Util.rootUrl + \"Files.ReadWrite.Selected\";\r\n        return Files;\r\n    }());\r\n    Scopes.Files = Files;\r\n    var Tasks = (function () {\r\n        function Tasks() {\r\n        }\r\n        Tasks.ReadWrite = Util.rootUrl + \"Tasks.ReadWrite\";\r\n        return Tasks;\r\n    }());\r\n    Scopes.Tasks = Tasks;\r\n    var People = (function () {\r\n        function People() {\r\n        }\r\n        People.Read = Util.rootUrl + \"People.Read\";\r\n        People.ReadWrite = Util.rootUrl + \"People.ReadWrite\";\r\n        return People;\r\n    }());\r\n    Scopes.People = People;\r\n    var Notes = (function () {\r\n        function Notes() {\r\n        }\r\n        Notes.Create = Util.rootUrl + \"Notes.Create\";\r\n        Notes.ReadWriteCreatedByApp = Util.rootUrl + \"Notes.ReadWrite.CreatedByApp\";\r\n        Notes.Read = Util.rootUrl + \"Notes.Read\";\r\n        Notes.ReadAll = Util.rootUrl + \"Notes.Read.All\";\r\n        Notes.ReadWriteAll = Util.rootUrl + \"Notes.ReadWrite.All\";\r\n        return Notes;\r\n    }());\r\n    Scopes.Notes = Notes;\r\n})(Scopes = exports.Scopes || (exports.Scopes = {}));\r\nvar DataModelWrapper = (function () {\r\n    function DataModelWrapper(graph, _data) {\r\n        this.graph = graph;\r\n        this._data = _data;\r\n    }\r\n    Object.defineProperty(DataModelWrapper.prototype, \"data\", {\r\n        get: function () { return this._data; },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    return DataModelWrapper;\r\n}());\r\nexports.DataModelWrapper = DataModelWrapper;\r\nvar DataModelListWrapper = (function (_super) {\r\n    __extends(DataModelListWrapper, _super);\r\n    function DataModelListWrapper() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    return DataModelListWrapper;\r\n}(DataModelWrapper));\r\nexports.DataModelListWrapper = DataModelListWrapper;\r\nvar ProfilePhoto = (function (_super) {\r\n    __extends(ProfilePhoto, _super);\r\n    function ProfilePhoto() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    return ProfilePhoto;\r\n}(DataModelWrapper));\r\nexports.ProfilePhoto = ProfilePhoto;\r\n(function (EventsEndpoint) {\r\n    EventsEndpoint[EventsEndpoint[\"events\"] = 0] = \"events\";\r\n    EventsEndpoint[EventsEndpoint[\"calendarView\"] = 1] = \"calendarView\";\r\n})(exports.EventsEndpoint || (exports.EventsEndpoint = {}));\r\nvar EventsEndpoint = exports.EventsEndpoint;\r\nvar User = (function (_super) {\r\n    __extends(User, _super);\r\n    function User() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    User.prototype.events = function (callback, odataQuery) {\r\n        this.graph.eventsForUser(this._data.userPrincipalName, EventsEndpoint.events, callback, odataQuery);\r\n    };\r\n    User.prototype.eventsAsync = function (odataQuery) {\r\n        return this.graph.eventsForUserAsync(this._data.userPrincipalName, EventsEndpoint.events, odataQuery);\r\n    };\r\n    User.prototype.memberOf = function (callback, Error, odataQuery) {\r\n        this.graph.memberOfForUser(this._data.userPrincipalName, callback, odataQuery);\r\n    };\r\n    User.prototype.memberOfAsync = function (odataQuery) {\r\n        return this.graph.memberOfForUserAsync(this._data.userPrincipalName, odataQuery);\r\n    };\r\n    User.prototype.messages = function (callback, odataQuery) {\r\n        this.graph.messagesForUser(this._data.userPrincipalName, callback, odataQuery);\r\n    };\r\n    User.prototype.messagesAsync = function (odataQuery) {\r\n        return this.graph.messagesForUserAsync(this._data.userPrincipalName, odataQuery);\r\n    };\r\n    User.prototype.manager = function (callback, odataQuery) {\r\n        this.graph.managerForUser(this._data.userPrincipalName, callback, odataQuery);\r\n    };\r\n    User.prototype.managerAsync = function (odataQuery) {\r\n        return this.graph.managerForUserAsync(this._data.userPrincipalName, odataQuery);\r\n    };\r\n    User.prototype.profilePhoto = function (callback, odataQuery) {\r\n        this.graph.profilePhotoForUser(this._data.userPrincipalName, callback, odataQuery);\r\n    };\r\n    User.prototype.profilePhotoAsync = function (odataQuery) {\r\n        return this.graph.profilePhotoForUserAsync(this._data.userPrincipalName, odataQuery);\r\n    };\r\n    User.prototype.profilePhotoValue = function (callback, odataQuery) {\r\n        this.graph.profilePhotoValueForUser(this._data.userPrincipalName, callback, odataQuery);\r\n    };\r\n    User.prototype.profilePhotoValueAsync = function (odataQuery) {\r\n        return this.graph.profilePhotoValueForUserAsync(this._data.userPrincipalName, odataQuery);\r\n    };\r\n    User.prototype.calendarView = function (callback, odataQuery) {\r\n        this.graph.eventsForUser(this._data.userPrincipalName, EventsEndpoint.calendarView, callback, odataQuery);\r\n    };\r\n    User.prototype.calendarViewAsync = function (odataQuery) {\r\n        return this.graph.eventsForUserAsync(this._data.userPrincipalName, EventsEndpoint.calendarView, odataQuery);\r\n    };\r\n    User.prototype.mailFolders = function (callback, odataQuery) {\r\n        this.graph.mailFoldersForUser(this._data.userPrincipalName, callback, odataQuery);\r\n    };\r\n    User.prototype.mailFoldersAsync = function (odataQuery) {\r\n        return this.graph.mailFoldersForUserAsync(this._data.userPrincipalName, odataQuery);\r\n    };\r\n    User.prototype.message = function (messageId, callback, odataQuery) {\r\n        this.graph.messageForUser(this._data.userPrincipalName, messageId, callback, odataQuery);\r\n    };\r\n    User.prototype.messageAsync = function (messageId, odataQuery) {\r\n        return this.graph.messageForUserAsync(this._data.userPrincipalName, messageId, odataQuery);\r\n    };\r\n    User.prototype.event = function (eventId, callback, odataQuery) {\r\n        this.graph.eventForUser(this._data.userPrincipalName, eventId, callback, odataQuery);\r\n    };\r\n    User.prototype.eventAsync = function (eventId, odataQuery) {\r\n        return this.graph.eventForUserAsync(this._data.userPrincipalName, eventId, odataQuery);\r\n    };\r\n    User.prototype.messageAttachment = function (messageId, attachmentId, callback, odataQuery) {\r\n        this.graph.messageAttachmentForUser(this._data.userPrincipalName, messageId, attachmentId, callback, odataQuery);\r\n    };\r\n    User.prototype.messageAttachmentAsync = function (messageId, attachmentId, odataQuery) {\r\n        return this.graph.messageAttachmentForUserAsync(this._data.userPrincipalName, messageId, attachmentId, odataQuery);\r\n    };\r\n    return User;\r\n}(DataModelWrapper));\r\nexports.User = User;\r\nvar Users = (function (_super) {\r\n    __extends(Users, _super);\r\n    function Users() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    return Users;\r\n}(DataModelListWrapper));\r\nexports.Users = Users;\r\nvar Message = (function (_super) {\r\n    __extends(Message, _super);\r\n    function Message() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    return Message;\r\n}(DataModelWrapper));\r\nexports.Message = Message;\r\nvar Messages = (function (_super) {\r\n    __extends(Messages, _super);\r\n    function Messages() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    return Messages;\r\n}(DataModelListWrapper));\r\nexports.Messages = Messages;\r\nvar Event = (function (_super) {\r\n    __extends(Event, _super);\r\n    function Event() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    return Event;\r\n}(DataModelWrapper));\r\nexports.Event = Event;\r\nvar Events = (function (_super) {\r\n    __extends(Events, _super);\r\n    function Events(graph, endpoint, _data) {\r\n        _super.call(this, graph, _data);\r\n        this.graph = graph;\r\n        this.endpoint = endpoint;\r\n        this._data = _data;\r\n    }\r\n    return Events;\r\n}(DataModelListWrapper));\r\nexports.Events = Events;\r\nvar Contact = (function () {\r\n    function Contact() {\r\n    }\r\n    return Contact;\r\n}());\r\nexports.Contact = Contact;\r\nvar Group = (function (_super) {\r\n    __extends(Group, _super);\r\n    function Group() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    return Group;\r\n}(DataModelWrapper));\r\nexports.Group = Group;\r\nvar Groups = (function (_super) {\r\n    __extends(Groups, _super);\r\n    function Groups() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    return Groups;\r\n}(DataModelListWrapper));\r\nexports.Groups = Groups;\r\nvar MailFolder = (function (_super) {\r\n    __extends(MailFolder, _super);\r\n    function MailFolder() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    return MailFolder;\r\n}(DataModelWrapper));\r\nexports.MailFolder = MailFolder;\r\nvar MailFolders = (function (_super) {\r\n    __extends(MailFolders, _super);\r\n    function MailFolders() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    return MailFolders;\r\n}(DataModelListWrapper));\r\nexports.MailFolders = MailFolders;\r\n(function (AttachmentType) {\r\n    AttachmentType[AttachmentType[\"fileAttachment\"] = 0] = \"fileAttachment\";\r\n    AttachmentType[AttachmentType[\"itemAttachment\"] = 1] = \"itemAttachment\";\r\n    AttachmentType[AttachmentType[\"referenceAttachment\"] = 2] = \"referenceAttachment\";\r\n})(exports.AttachmentType || (exports.AttachmentType = {}));\r\nvar AttachmentType = exports.AttachmentType;\r\nvar Attachment = (function (_super) {\r\n    __extends(Attachment, _super);\r\n    function Attachment() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    Attachment.prototype.getType = function () {\r\n        switch (this._data['@odata.type']) {\r\n            case \"#microsoft.graph.fileAttachment\":\r\n                return AttachmentType.fileAttachment;\r\n            case \"#microsoft.graph.itemAttachment\":\r\n                return AttachmentType.itemAttachment;\r\n            case \"#microsoft.graph.referenceAttachment\":\r\n                return AttachmentType.referenceAttachment;\r\n        }\r\n    };\r\n    return Attachment;\r\n}(DataModelWrapper));\r\nexports.Attachment = Attachment;\r\nvar Attachments = (function (_super) {\r\n    __extends(Attachments, _super);\r\n    function Attachments() {\r\n        _super.apply(this, arguments);\r\n    }\r\n    return Attachments;\r\n}(DataModelListWrapper));\r\nexports.Attachments = Attachments;\r\nvar Graph = (function () {\r\n    function Graph(identityInfo, mode, https) {\r\n        this.accessToken = null;\r\n        this.KurveIdentity = null;\r\n        this.defaultResourceID = \"https://graph.microsoft.com\";\r\n        this.baseUrl = \"https://graph.microsoft.com/v1.0/\";\r\n        if (https)\r\n            this.https = https;\r\n        this.mode = mode;\r\n        if (identityInfo.defaultAccessToken) {\r\n            this.accessToken = identityInfo.defaultAccessToken;\r\n        }\r\n        else {\r\n            this.KurveIdentity = identityInfo.identity;\r\n        }\r\n    }\r\n    Graph.prototype.scopesForV2 = function (scopes) {\r\n        if (!this.KurveIdentity)\r\n            return null;\r\n        if (this.KurveIdentity.getCurrentEndPointVersion() === identity_1.EndPointVersion.v1)\r\n            return null;\r\n        else\r\n            return scopes;\r\n    };\r\n    Graph.prototype.meAsync = function (odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.me(function (error, user) { return error ? d.reject(error) : d.resolve(user); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.me = function (callback, odataQuery) {\r\n        var scopes = [Scopes.User.Read];\r\n        var urlString = this.buildMeUrl(\"\", odataQuery);\r\n        this.getUser(urlString, callback, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.userAsync = function (userId, odataQuery, basicProfileOnly) {\r\n        if (basicProfileOnly === void 0) { basicProfileOnly = true; }\r\n        var d = new promises_1.Deferred();\r\n        this.user(userId, function (error, user) { return error ? d.reject(error) : d.resolve(user); }, odataQuery, basicProfileOnly);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.user = function (userId, callback, odataQuery, basicProfileOnly) {\r\n        if (basicProfileOnly === void 0) { basicProfileOnly = true; }\r\n        var scopes = basicProfileOnly ? [Scopes.User.ReadBasicAll] : [Scopes.User.ReadAll];\r\n        var urlString = this.buildUsersUrl(userId, odataQuery);\r\n        this.getUser(urlString, callback, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.usersAsync = function (odataQuery, basicProfileOnly) {\r\n        if (basicProfileOnly === void 0) { basicProfileOnly = true; }\r\n        var d = new promises_1.Deferred();\r\n        this.users(function (error, users) { return error ? d.reject(error) : d.resolve(users); }, odataQuery, basicProfileOnly);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.users = function (callback, odataQuery, basicProfileOnly) {\r\n        if (basicProfileOnly === void 0) { basicProfileOnly = true; }\r\n        var scopes = basicProfileOnly ? [Scopes.User.ReadBasicAll] : [Scopes.User.ReadAll];\r\n        var urlString = this.buildUsersUrl(\"\", odataQuery);\r\n        this.getUsers(urlString, callback, this.scopesForV2(scopes), basicProfileOnly);\r\n    };\r\n    Graph.prototype.groupAsync = function (groupId, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.group(groupId, function (error, group) { return error ? d.reject(error) : d.resolve(group); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.group = function (groupId, callback, odataQuery) {\r\n        var scopes = [Scopes.Group.ReadAll];\r\n        var urlString = this.buildGroupsUrl(groupId, odataQuery);\r\n        this.getGroup(urlString, callback, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.groupsAsync = function (odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.groups(function (error, groups) { return error ? d.reject(error) : d.resolve(groups); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.groups = function (callback, odataQuery) {\r\n        var scopes = [Scopes.Group.ReadAll];\r\n        var urlString = this.buildGroupsUrl(\"\", odataQuery);\r\n        this.getGroups(urlString, callback, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.messageForUserAsync = function (userPrincipalName, messageId, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.messageForUser(userPrincipalName, messageId, function (error, message) { return error ? d.reject(error) : d.resolve(message); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.messageForUser = function (userPrincipalName, messageId, callback, odataQuery) {\r\n        var scopes = [Scopes.Mail.Read];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/messages/\" + messageId, odataQuery);\r\n        this.getMessage(urlString, messageId, function (error, result) { return callback(error, result); }, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.messagesForUserAsync = function (userPrincipalName, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.messagesForUser(userPrincipalName, function (error, messages) { return error ? d.reject(error) : d.resolve(messages); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.messagesForUser = function (userPrincipalName, callback, odataQuery) {\r\n        var scopes = [Scopes.Mail.Read];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/messages\", odataQuery);\r\n        this.getMessages(urlString, function (error, result) { return callback(error, result); }, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.mailFoldersForUserAsync = function (userPrincipalName, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.mailFoldersForUser(userPrincipalName, function (error, messages) { return error ? d.reject(error) : d.resolve(messages); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.mailFoldersForUser = function (userPrincipalName, callback, odataQuery) {\r\n        var scopes = [Scopes.Mail.Read];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/mailFolders\", odataQuery);\r\n        this.getMailFolders(urlString, function (error, result) { return callback(error, result); }, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.eventForUserAsync = function (userPrincipalName, eventId, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.eventForUser(userPrincipalName, eventId, function (error, event) { return error ? d.reject(error) : d.resolve(event); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.eventForUser = function (userPrincipalName, eventId, callback, odataQuery) {\r\n        var scopes = [Scopes.Calendars.Read];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/events/\" + eventId, odataQuery);\r\n        this.getEvent(urlString, eventId, function (error, result) { return callback(error, result); }, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.eventsForUserAsync = function (userPrincipalName, endpoint, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.eventsForUser(userPrincipalName, endpoint, function (error, events) { return error ? d.reject(error) : d.resolve(events); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.eventsForUser = function (userPrincipalName, endpoint, callback, odataQuery) {\r\n        var scopes = [Scopes.Calendars.Read];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/\" + EventsEndpoint[endpoint], odataQuery);\r\n        this.getEvents(urlString, endpoint, function (error, result) { return callback(error, result); }, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.memberOfForUserAsync = function (userPrincipalName, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.memberOfForUser(userPrincipalName, function (error, groups) { return error ? d.reject(error) : d.resolve(groups); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.memberOfForUser = function (userPrincipalName, callback, odataQuery) {\r\n        var scopes = [Scopes.Group.ReadAll];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/memberOf\", odataQuery);\r\n        this.getGroups(urlString, callback, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.managerForUserAsync = function (userPrincipalName, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.managerForUser(userPrincipalName, function (error, user) { return error ? d.reject(error) : d.resolve(user); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.managerForUser = function (userPrincipalName, callback, odataQuery) {\r\n        var scopes = [Scopes.Directory.ReadAll];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/manager\", odataQuery);\r\n        this.getUser(urlString, callback, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.directReportsForUserAsync = function (userPrincipalName, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.directReportsForUser(userPrincipalName, function (error, users) { return error ? d.reject(error) : d.resolve(users); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.directReportsForUser = function (userPrincipalName, callback, odataQuery) {\r\n        var scopes = [Scopes.Directory.ReadAll];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/directReports\", odataQuery);\r\n        this.getUsers(urlString, callback, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.profilePhotoForUserAsync = function (userPrincipalName, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.profilePhotoForUser(userPrincipalName, function (error, profilePhoto) { return error ? d.reject(error) : d.resolve(profilePhoto); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.profilePhotoForUser = function (userPrincipalName, callback, odataQuery) {\r\n        var scopes = [Scopes.User.ReadBasicAll];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/photo\", odataQuery);\r\n        this.getPhoto(urlString, callback, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.profilePhotoValueForUserAsync = function (userPrincipalName, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.profilePhotoValueForUser(userPrincipalName, function (error, result) { return error ? d.reject(error) : d.resolve(result); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.profilePhotoValueForUser = function (userPrincipalName, callback, odataQuery) {\r\n        var scopes = [Scopes.User.ReadBasicAll];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/photo/$value\", odataQuery);\r\n        this.getPhotoValue(urlString, callback, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.messageAttachmentsForUserAsync = function (userPrincipalName, messageId, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.messageAttachmentsForUser(userPrincipalName, messageId, function (error, result) { return error ? d.reject(error) : d.resolve(result); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.messageAttachmentsForUser = function (userPrincipalName, messageId, callback, odataQuery) {\r\n        var scopes = [Scopes.Mail.Read];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/messages/\" + messageId + \"/attachments\", odataQuery);\r\n        this.getMessageAttachments(urlString, callback, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.messageAttachmentForUserAsync = function (userPrincipalName, messageId, attachmentId, odataQuery) {\r\n        var d = new promises_1.Deferred();\r\n        this.messageAttachmentForUser(userPrincipalName, messageId, attachmentId, function (error, attachment) { return error ? d.reject(error) : d.resolve(attachment); }, odataQuery);\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.messageAttachmentForUser = function (userPrincipalName, messageId, attachmentId, callback, odataQuery) {\r\n        var scopes = [Scopes.Mail.Read];\r\n        var urlString = this.buildUsersUrl(userPrincipalName + \"/messages/\" + messageId + \"/attachments/\" + attachmentId, odataQuery);\r\n        this.getMessageAttachment(urlString, callback, this.scopesForV2(scopes));\r\n    };\r\n    Graph.prototype.getAsync = function (url) {\r\n        var d = new promises_1.Deferred();\r\n        this.get(url, function (error, response) { return error ? d.reject(error) : d.resolve(response); });\r\n        return d.promise;\r\n    };\r\n    Graph.prototype.get = function (url, callback, responseType, scopes) {\r\n        var _this = this;\r\n        if (this.mode === identity_1.Mode.Client) {\r\n            var xhr = new XMLHttpRequest();\r\n            if (responseType)\r\n                xhr.responseType = responseType;\r\n            xhr.onreadystatechange = function () {\r\n                if (xhr.readyState === 4)\r\n                    if (xhr.status === 200)\r\n                        callback(null, responseType ? xhr.response : xhr.responseText);\r\n                    else\r\n                        callback(_this.generateError(xhr));\r\n            };\r\n            xhr.open(\"GET\", url);\r\n            this.addAccessTokenAndSend(xhr, function (addTokenError) {\r\n                if (addTokenError) {\r\n                    callback(addTokenError);\r\n                }\r\n            }, scopes);\r\n        }\r\n        else {\r\n            var token = this.findAccessToken(function (token, error) {\r\n                var path = url.substr(27, url.length);\r\n                var options = {\r\n                    host: 'graph.microsoft.com',\r\n                    port: '443',\r\n                    path: path,\r\n                    method: 'GET',\r\n                    headers: {\r\n                        'Content-Type': responseType,\r\n                        accept: '*/*',\r\n                        'Authorization': 'Bearer ' + token\r\n                    }\r\n                };\r\n                var post_req = _this.https.request(options, function (response) {\r\n                    response.setEncoding('utf8');\r\n                    response.on('data', function (chunk) {\r\n                        callback(null, chunk);\r\n                    });\r\n                });\r\n                post_req.end();\r\n            }, scopes);\r\n        }\r\n    };\r\n    Graph.prototype.generateError = function (xhr) {\r\n        var response = new identity_1.Error();\r\n        response.status = xhr.status;\r\n        response.statusText = xhr.statusText;\r\n        if (xhr.responseType === '' || xhr.responseType === 'text')\r\n            response.text = xhr.responseText;\r\n        else\r\n            response.other = xhr.response;\r\n        return response;\r\n    };\r\n    Graph.prototype.getUsers = function (urlString, callback, scopes, basicProfileOnly) {\r\n        var _this = this;\r\n        if (basicProfileOnly === void 0) { basicProfileOnly = true; }\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var usersODATA = JSON.parse(result);\r\n            if (usersODATA.error) {\r\n                var errorODATA = new identity_1.Error();\r\n                errorODATA.other = usersODATA.error;\r\n                callback(errorODATA);\r\n                return;\r\n            }\r\n            var resultsArray = (usersODATA.value ? usersODATA.value : [usersODATA]);\r\n            var users = new Users(_this, resultsArray.map(function (o) { return new User(_this, o); }));\r\n            var nextLink = usersODATA['@odata.nextLink'];\r\n            if (nextLink) {\r\n                users.nextLink = function (callback) {\r\n                    var scopes = basicProfileOnly ? [Scopes.User.ReadBasicAll] : [Scopes.User.ReadAll];\r\n                    var d = new promises_1.Deferred();\r\n                    _this.getUsers(nextLink, function (error, result) {\r\n                        if (callback)\r\n                            callback(error, result);\r\n                        else\r\n                            error ? d.reject(error) : d.resolve(result);\r\n                    }, _this.scopesForV2(scopes), basicProfileOnly);\r\n                    return d.promise;\r\n                };\r\n            }\r\n            callback(null, users);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.getUser = function (urlString, callback, scopes) {\r\n        var _this = this;\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var userODATA = JSON.parse(result);\r\n            if (userODATA.error) {\r\n                var errorODATA = new identity_1.Error();\r\n                errorODATA.other = userODATA.error;\r\n                callback(errorODATA);\r\n                return;\r\n            }\r\n            var user = new User(_this, userODATA);\r\n            callback(null, user);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.findAccessToken = function (callback, scopes) {\r\n        if (this.accessToken) {\r\n            callback(this.accessToken, null);\r\n        }\r\n        else {\r\n            if (scopes) {\r\n                this.KurveIdentity.getAccessTokenForScopes(scopes, false, (function (token, error) {\r\n                    if (error)\r\n                        callback(null, error);\r\n                    else {\r\n                        callback(token, null);\r\n                    }\r\n                }));\r\n            }\r\n            else {\r\n                this.KurveIdentity.getAccessToken(this.defaultResourceID, (function (error, token) {\r\n                    if (error)\r\n                        callback(null, error);\r\n                    else {\r\n                        callback(token, null);\r\n                    }\r\n                }));\r\n            }\r\n        }\r\n    };\r\n    Graph.prototype.addAccessTokenAndSend = function (xhr, callback, scopes) {\r\n        this.findAccessToken(function (token, error) {\r\n            if (token) {\r\n                xhr.setRequestHeader('Authorization', 'Bearer ' + token);\r\n                xhr.send();\r\n            }\r\n            else {\r\n                callback(error);\r\n            }\r\n        }, scopes);\r\n    };\r\n    Graph.prototype.getMessage = function (urlString, messageId, callback, scopes) {\r\n        var _this = this;\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var ODATA = JSON.parse(result);\r\n            if (ODATA.error) {\r\n                var ODATAError = new identity_1.Error();\r\n                ODATAError.other = ODATA.error;\r\n                callback(ODATAError);\r\n                return;\r\n            }\r\n            var message = new Message(_this, ODATA);\r\n            callback(null, message);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.getMessages = function (urlString, callback, scopes) {\r\n        var _this = this;\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var messagesODATA = JSON.parse(result);\r\n            if (messagesODATA.error) {\r\n                var errorODATA = new identity_1.Error();\r\n                errorODATA.other = messagesODATA.error;\r\n                callback(errorODATA);\r\n                return;\r\n            }\r\n            var resultsArray = (messagesODATA.value ? messagesODATA.value : [messagesODATA]);\r\n            var messages = new Messages(_this, resultsArray.map(function (o) { return new Message(_this, o); }));\r\n            var nextLink = messagesODATA['@odata.nextLink'];\r\n            if (nextLink) {\r\n                messages.nextLink = function (callback) {\r\n                    var scopes = [Scopes.Mail.Read];\r\n                    var d = new promises_1.Deferred();\r\n                    _this.getMessages(nextLink, function (error, messages) {\r\n                        if (callback)\r\n                            callback(error, messages);\r\n                        else\r\n                            error ? d.reject(error) : d.resolve(messages);\r\n                    }, _this.scopesForV2(scopes));\r\n                    return d.promise;\r\n                };\r\n            }\r\n            callback(null, messages);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.getEvent = function (urlString, EventId, callback, scopes) {\r\n        var _this = this;\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var ODATA = JSON.parse(result);\r\n            if (ODATA.error) {\r\n                var ODATAError = new identity_1.Error();\r\n                ODATAError.other = ODATA.error;\r\n                callback(ODATAError);\r\n                return;\r\n            }\r\n            var event = new Event(_this, ODATA);\r\n            callback(null, event);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.getEvents = function (urlString, endpoint, callback, scopes) {\r\n        var _this = this;\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var odata = JSON.parse(result);\r\n            if (odata.error) {\r\n                var errorODATA = new identity_1.Error();\r\n                errorODATA.other = odata.error;\r\n                callback(errorODATA);\r\n                return;\r\n            }\r\n            var resultsArray = (odata.value ? odata.value : [odata]);\r\n            var events = new Events(_this, endpoint, resultsArray.map(function (o) { return new Event(_this, o); }));\r\n            var nextLink = odata['@odata.nextLink'];\r\n            if (nextLink) {\r\n                events.nextLink = function (callback) {\r\n                    var scopes = [Scopes.Mail.Read];\r\n                    var d = new promises_1.Deferred();\r\n                    _this.getEvents(nextLink, endpoint, function (error, result) {\r\n                        if (callback)\r\n                            callback(error, result);\r\n                        else\r\n                            error ? d.reject(error) : d.resolve(result);\r\n                    }, _this.scopesForV2(scopes));\r\n                    return d.promise;\r\n                };\r\n            }\r\n            callback(null, events);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.getGroups = function (urlString, callback, scopes) {\r\n        var _this = this;\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var groupsODATA = JSON.parse(result);\r\n            if (groupsODATA.error) {\r\n                var errorODATA = new identity_1.Error();\r\n                errorODATA.other = groupsODATA.error;\r\n                callback(errorODATA);\r\n                return;\r\n            }\r\n            var resultsArray = (groupsODATA.value ? groupsODATA.value : [groupsODATA]);\r\n            var groups = new Groups(_this, resultsArray.map(function (o) { return new Group(_this, o); }));\r\n            var nextLink = groupsODATA['@odata.nextLink'];\r\n            if (nextLink) {\r\n                groups.nextLink = function (callback) {\r\n                    var scopes = [Scopes.Group.ReadAll];\r\n                    var d = new promises_1.Deferred();\r\n                    _this.getGroups(nextLink, function (error, result) {\r\n                        if (callback)\r\n                            callback(error, result);\r\n                        else\r\n                            error ? d.reject(error) : d.resolve(result);\r\n                    }, _this.scopesForV2(scopes));\r\n                    return d.promise;\r\n                };\r\n            }\r\n            callback(null, groups);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.getGroup = function (urlString, callback, scopes) {\r\n        var _this = this;\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var ODATA = JSON.parse(result);\r\n            if (ODATA.error) {\r\n                var ODATAError = new identity_1.Error();\r\n                ODATAError.other = ODATA.error;\r\n                callback(ODATAError);\r\n                return;\r\n            }\r\n            var group = new Group(_this, ODATA);\r\n            callback(null, group);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.getPhoto = function (urlString, callback, scopes) {\r\n        var _this = this;\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var ODATA = JSON.parse(result);\r\n            if (ODATA.error) {\r\n                var errorODATA = new identity_1.Error();\r\n                errorODATA.other = ODATA.error;\r\n                callback(errorODATA);\r\n                return;\r\n            }\r\n            var photo = new ProfilePhoto(_this, ODATA);\r\n            callback(null, photo);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.getPhotoValue = function (urlString, callback, scopes) {\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(null, errorGet);\r\n                return;\r\n            }\r\n            callback(result);\r\n        }, \"blob\", scopes);\r\n    };\r\n    Graph.prototype.getMailFolders = function (urlString, callback, scopes) {\r\n        var _this = this;\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var odata = JSON.parse(result);\r\n            if (odata.error) {\r\n                var errorODATA = new identity_1.Error();\r\n                errorODATA.other = odata.error;\r\n                callback(errorODATA);\r\n            }\r\n            var resultsArray = (odata.value ? odata.value : [odata]);\r\n            var mailFolders = new MailFolders(_this, resultsArray.map(function (o) { return new MailFolder(_this, o); }));\r\n            var nextLink = odata['@odata.nextLink'];\r\n            if (nextLink) {\r\n                mailFolders.nextLink = function (callback) {\r\n                    var scopes = [Scopes.User.ReadAll];\r\n                    var d = new promises_1.Deferred();\r\n                    _this.getMailFolders(nextLink, function (error, result) {\r\n                        if (callback)\r\n                            callback(error, result);\r\n                        else\r\n                            error ? d.reject(error) : d.resolve(result);\r\n                    }, _this.scopesForV2(scopes));\r\n                    return d.promise;\r\n                };\r\n            }\r\n            callback(null, mailFolders);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.getMessageAttachments = function (urlString, callback, scopes) {\r\n        var _this = this;\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var attachmentsODATA = JSON.parse(result);\r\n            if (attachmentsODATA.error) {\r\n                var errorODATA = new identity_1.Error();\r\n                errorODATA.other = attachmentsODATA.error;\r\n                callback(errorODATA);\r\n                return;\r\n            }\r\n            var resultsArray = (attachmentsODATA.value ? attachmentsODATA.value : [attachmentsODATA]);\r\n            var attachments = new Attachments(_this, resultsArray.map(function (o) { return new Attachment(_this, o); }));\r\n            var nextLink = attachmentsODATA['@odata.nextLink'];\r\n            if (nextLink) {\r\n                attachments.nextLink = function (callback) {\r\n                    var scopes = [Scopes.Mail.Read];\r\n                    var d = new promises_1.Deferred();\r\n                    _this.getMessageAttachments(nextLink, function (error, attachments) {\r\n                        if (callback)\r\n                            callback(error, attachments);\r\n                        else\r\n                            error ? d.reject(error) : d.resolve(attachments);\r\n                    }, _this.scopesForV2(scopes));\r\n                    return d.promise;\r\n                };\r\n            }\r\n            callback(null, attachments);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.getMessageAttachment = function (urlString, callback, scopes) {\r\n        var _this = this;\r\n        this.get(urlString, function (errorGet, result) {\r\n            if (errorGet) {\r\n                callback(errorGet);\r\n                return;\r\n            }\r\n            var ODATA = JSON.parse(result);\r\n            if (ODATA.error) {\r\n                var ODATAError = new identity_1.Error();\r\n                ODATAError.other = ODATA.error;\r\n                callback(ODATAError);\r\n                return;\r\n            }\r\n            var attachment = new Attachment(_this, ODATA);\r\n            callback(null, attachment);\r\n        }, null, scopes);\r\n    };\r\n    Graph.prototype.buildUrl = function (root, path, odataQuery) {\r\n        return this.baseUrl + root + path + (odataQuery ? \"?\" + odataQuery : \"\");\r\n    };\r\n    Graph.prototype.buildMeUrl = function (path, odataQuery) {\r\n        if (path === void 0) { path = \"\"; }\r\n        return this.buildUrl(\"me/\", path, odataQuery);\r\n    };\r\n    Graph.prototype.buildUsersUrl = function (path, odataQuery) {\r\n        if (path === void 0) { path = \"\"; }\r\n        return this.buildUrl(\"users/\", path, odataQuery);\r\n    };\r\n    Graph.prototype.buildGroupsUrl = function (path, odataQuery) {\r\n        if (path === void 0) { path = \"\"; }\r\n        return this.buildUrl(\"groups/\", path, odataQuery);\r\n    };\r\n    return Graph;\r\n}());\r\nexports.Graph = Graph;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/graph.ts\n ** module id = 1\n ** module chunks = 0\n **/","\"use strict\";\r\nfunction DispatchDeferred(closure) {\r\n    setTimeout(closure, 0);\r\n}\r\nvar PromiseState;\r\n(function (PromiseState) {\r\n    PromiseState[PromiseState[\"Pending\"] = 0] = \"Pending\";\r\n    PromiseState[PromiseState[\"ResolutionInProgress\"] = 1] = \"ResolutionInProgress\";\r\n    PromiseState[PromiseState[\"Resolved\"] = 2] = \"Resolved\";\r\n    PromiseState[PromiseState[\"Rejected\"] = 3] = \"Rejected\";\r\n})(PromiseState || (PromiseState = {}));\r\nvar Client = (function () {\r\n    function Client(_dispatcher, _successCB, _errorCB) {\r\n        this._dispatcher = _dispatcher;\r\n        this._successCB = _successCB;\r\n        this._errorCB = _errorCB;\r\n        this.result = new Deferred(_dispatcher);\r\n    }\r\n    Client.prototype.resolve = function (value, defer) {\r\n        var _this = this;\r\n        if (typeof (this._successCB) !== 'function') {\r\n            this.result.resolve(value);\r\n            return;\r\n        }\r\n        if (defer) {\r\n            this._dispatcher(function () { return _this._dispatchCallback(_this._successCB, value); });\r\n        }\r\n        else {\r\n            this._dispatchCallback(this._successCB, value);\r\n        }\r\n    };\r\n    Client.prototype.reject = function (error, defer) {\r\n        var _this = this;\r\n        if (typeof (this._errorCB) !== 'function') {\r\n            this.result.reject(error);\r\n            return;\r\n        }\r\n        if (defer) {\r\n            this._dispatcher(function () { return _this._dispatchCallback(_this._errorCB, error); });\r\n        }\r\n        else {\r\n            this._dispatchCallback(this._errorCB, error);\r\n        }\r\n    };\r\n    Client.prototype._dispatchCallback = function (callback, arg) {\r\n        var result, then, type;\r\n        try {\r\n            result = callback(arg);\r\n            this.result.resolve(result);\r\n        }\r\n        catch (err) {\r\n            this.result.reject(err);\r\n            return;\r\n        }\r\n    };\r\n    return Client;\r\n}());\r\nvar Deferred = (function () {\r\n    function Deferred(dispatcher) {\r\n        this._stack = [];\r\n        this._state = PromiseState.Pending;\r\n        if (dispatcher)\r\n            this._dispatcher = dispatcher;\r\n        else\r\n            this._dispatcher = DispatchDeferred;\r\n        this.promise = new Promise(this);\r\n    }\r\n    Deferred.prototype.DispatchDeferred = function (closure) {\r\n        setTimeout(closure, 0);\r\n    };\r\n    Deferred.prototype.then = function (successCB, errorCB) {\r\n        if (typeof (successCB) !== 'function' && typeof (errorCB) !== 'function') {\r\n            return this.promise;\r\n        }\r\n        var client = new Client(this._dispatcher, successCB, errorCB);\r\n        switch (this._state) {\r\n            case PromiseState.Pending:\r\n            case PromiseState.ResolutionInProgress:\r\n                this._stack.push(client);\r\n                break;\r\n            case PromiseState.Resolved:\r\n                client.resolve(this._value, true);\r\n                break;\r\n            case PromiseState.Rejected:\r\n                client.reject(this._error, true);\r\n                break;\r\n        }\r\n        return client.result.promise;\r\n    };\r\n    Deferred.prototype.resolve = function (value) {\r\n        if (this._state !== PromiseState.Pending) {\r\n            return this;\r\n        }\r\n        return this._resolve(value);\r\n    };\r\n    Deferred.prototype._resolve = function (value) {\r\n        var _this = this;\r\n        var type = typeof (value), then, pending = true;\r\n        try {\r\n            if (value !== null &&\r\n                (type === 'object' || type === 'function') &&\r\n                typeof (then = value.then) === 'function') {\r\n                if (value === this.promise) {\r\n                    throw new TypeError('recursive resolution');\r\n                }\r\n                this._state = PromiseState.ResolutionInProgress;\r\n                then.call(value, function (result) {\r\n                    if (pending) {\r\n                        pending = false;\r\n                        _this._resolve(result);\r\n                    }\r\n                }, function (error) {\r\n                    if (pending) {\r\n                        pending = false;\r\n                        _this._reject(error);\r\n                    }\r\n                });\r\n            }\r\n            else {\r\n                this._state = PromiseState.ResolutionInProgress;\r\n                this._dispatcher(function () {\r\n                    _this._state = PromiseState.Resolved;\r\n                    _this._value = value;\r\n                    var i, stackSize = _this._stack.length;\r\n                    for (i = 0; i < stackSize; i++) {\r\n                        _this._stack[i].resolve(value, false);\r\n                    }\r\n                    _this._stack.splice(0, stackSize);\r\n                });\r\n            }\r\n        }\r\n        catch (err) {\r\n            if (pending) {\r\n                this._reject(err);\r\n            }\r\n        }\r\n        return this;\r\n    };\r\n    Deferred.prototype.reject = function (error) {\r\n        if (this._state !== PromiseState.Pending) {\r\n            return this;\r\n        }\r\n        return this._reject(error);\r\n    };\r\n    Deferred.prototype._reject = function (error) {\r\n        var _this = this;\r\n        this._state = PromiseState.ResolutionInProgress;\r\n        this._dispatcher(function () {\r\n            _this._state = PromiseState.Rejected;\r\n            _this._error = error;\r\n            var stackSize = _this._stack.length, i = 0;\r\n            for (i = 0; i < stackSize; i++) {\r\n                _this._stack[i].reject(error, false);\r\n            }\r\n            _this._stack.splice(0, stackSize);\r\n        });\r\n        return this;\r\n    };\r\n    return Deferred;\r\n}());\r\nexports.Deferred = Deferred;\r\nvar Promise = (function () {\r\n    function Promise(_deferred) {\r\n        this._deferred = _deferred;\r\n    }\r\n    Promise.prototype.then = function (successCallback, errorCallback) {\r\n        return this._deferred.then(successCallback, errorCallback);\r\n    };\r\n    Promise.prototype.fail = function (errorCallback) {\r\n        return this._deferred.then(undefined, errorCallback);\r\n    };\r\n    return Promise;\r\n}());\r\nexports.Promise = Promise;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/promises.ts\n ** module id = 2\n ** module chunks = 0\n **/","\"use strict\";\r\nvar promises_1 = require(\"./promises\");\r\n(function (EndPointVersion) {\r\n    EndPointVersion[EndPointVersion[\"v1\"] = 1] = \"v1\";\r\n    EndPointVersion[EndPointVersion[\"v2\"] = 2] = \"v2\";\r\n})(exports.EndPointVersion || (exports.EndPointVersion = {}));\r\nvar EndPointVersion = exports.EndPointVersion;\r\n(function (Mode) {\r\n    Mode[Mode[\"Client\"] = 1] = \"Client\";\r\n    Mode[Mode[\"Node\"] = 2] = \"Node\";\r\n})(exports.Mode || (exports.Mode = {}));\r\nvar Mode = exports.Mode;\r\nvar Error = (function () {\r\n    function Error() {\r\n    }\r\n    return Error;\r\n}());\r\nexports.Error = Error;\r\nvar CachedToken = (function () {\r\n    function CachedToken(id, scopes, resource, token, expiry) {\r\n        this.id = id;\r\n        this.scopes = scopes;\r\n        this.resource = resource;\r\n        this.token = token;\r\n        this.expiry = expiry;\r\n    }\r\n    ;\r\n    Object.defineProperty(CachedToken.prototype, \"isExpired\", {\r\n        get: function () {\r\n            return this.expiry <= new Date(new Date().getTime() + 60000);\r\n        },\r\n        enumerable: true,\r\n        configurable: true\r\n    });\r\n    CachedToken.prototype.hasScopes = function (requiredScopes) {\r\n        var _this = this;\r\n        if (!this.scopes) {\r\n            return false;\r\n        }\r\n        return requiredScopes.every(function (requiredScope) {\r\n            return _this.scopes.some(function (actualScope) { return requiredScope === actualScope; });\r\n        });\r\n    };\r\n    return CachedToken;\r\n}());\r\nvar TokenCache = (function () {\r\n    function TokenCache(tokenStorage) {\r\n        var _this = this;\r\n        this.tokenStorage = tokenStorage;\r\n        this.cachedTokens = {};\r\n        if (tokenStorage) {\r\n            tokenStorage.getAll().forEach(function (_a) {\r\n                var id = _a.id, scopes = _a.scopes, resource = _a.resource, token = _a.token, expiry = _a.expiry;\r\n                var cachedToken = new CachedToken(id, scopes, resource, token, new Date(expiry));\r\n                if (cachedToken.isExpired) {\r\n                    _this.tokenStorage.remove(cachedToken.id);\r\n                }\r\n                else {\r\n                    _this.cachedTokens[cachedToken.id] = cachedToken;\r\n                }\r\n            });\r\n        }\r\n    }\r\n    TokenCache.prototype.add = function (token) {\r\n        this.cachedTokens[token.id] = token;\r\n        this.tokenStorage && this.tokenStorage.add(token.id, token);\r\n    };\r\n    TokenCache.prototype.getForResource = function (resource) {\r\n        var cachedToken = this.cachedTokens[resource];\r\n        if (cachedToken && cachedToken.isExpired) {\r\n            this.remove(resource);\r\n            return null;\r\n        }\r\n        return cachedToken;\r\n    };\r\n    TokenCache.prototype.getForScopes = function (scopes) {\r\n        for (var key in this.cachedTokens) {\r\n            var cachedToken = this.cachedTokens[key];\r\n            if (cachedToken.hasScopes(scopes)) {\r\n                if (cachedToken.isExpired) {\r\n                    this.remove(key);\r\n                }\r\n                else {\r\n                    return cachedToken;\r\n                }\r\n            }\r\n        }\r\n        return null;\r\n    };\r\n    TokenCache.prototype.clear = function () {\r\n        this.cachedTokens = {};\r\n        this.tokenStorage && this.tokenStorage.clear();\r\n    };\r\n    TokenCache.prototype.remove = function (key) {\r\n        this.tokenStorage && this.tokenStorage.remove(key);\r\n        delete this.cachedTokens[key];\r\n    };\r\n    return TokenCache;\r\n}());\r\nvar IdToken = (function () {\r\n    function IdToken() {\r\n    }\r\n    return IdToken;\r\n}());\r\nexports.IdToken = IdToken;\r\nvar Identity = (function () {\r\n    function Identity(identitySettings) {\r\n        var _this = this;\r\n        this.policy = \"\";\r\n        this.mode = Mode.Client;\r\n        this.clientId = identitySettings.clientId;\r\n        this.tokenProcessorUrl = identitySettings.tokenProcessingUri;\r\n        if (identitySettings.version)\r\n            this.version = identitySettings.version;\r\n        else\r\n            this.version = EndPointVersion.v1;\r\n        if (identitySettings.appSecret)\r\n            this.appSecret = identitySettings.appSecret;\r\n        this.mode = identitySettings.mode;\r\n        if (this.mode === Mode.Client) {\r\n            this.tokenCache = new TokenCache(identitySettings.tokenStorage);\r\n            window.addEventListener(\"message\", function (event) {\r\n                if (event.data.type === \"id_token\") {\r\n                    if (event.data.error) {\r\n                        var e = new Error();\r\n                        e.text = event.data.error;\r\n                        _this.loginCallback(e);\r\n                    }\r\n                    else {\r\n                        if (_this.state !== event.data.state) {\r\n                            var error = new Error();\r\n                            error.statusText = \"Invalid state\";\r\n                            _this.loginCallback(error);\r\n                        }\r\n                        else {\r\n                            _this.decodeIdToken(event.data.token);\r\n                            _this.loginCallback(null);\r\n                        }\r\n                    }\r\n                }\r\n                else if (event.data.type === \"access_token\") {\r\n                    if (event.data.error) {\r\n                        var e = new Error();\r\n                        e.text = event.data.error;\r\n                        _this.getTokenCallback(null, e);\r\n                    }\r\n                    else {\r\n                        var token = event.data.token;\r\n                        var iframe = document.getElementById(\"tokenIFrame\");\r\n                        iframe.parentNode.removeChild(iframe);\r\n                        if (event.data.state !== _this.state) {\r\n                            var error = new Error();\r\n                            error.statusText = \"Invalid state\";\r\n                            _this.getTokenCallback(null, error);\r\n                        }\r\n                        else {\r\n                            _this.getTokenCallback(token, null);\r\n                        }\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n    Identity.prototype.parseQueryString = function (str) {\r\n        var queryString = str || window.location.search || '';\r\n        var keyValPairs = [];\r\n        var params = {};\r\n        queryString = queryString.replace(/.*?\\?/, \"\");\r\n        if (queryString.length) {\r\n            keyValPairs = queryString.split('&');\r\n            for (var pairNum in keyValPairs) {\r\n                var key = keyValPairs[pairNum].split('=')[0];\r\n                if (!key.length)\r\n                    continue;\r\n                if (typeof params[key] === 'undefined')\r\n                    params[key] = [];\r\n                params[key].push(keyValPairs[pairNum].split('=')[1]);\r\n            }\r\n        }\r\n        return params;\r\n    };\r\n    Identity.prototype.token = function (s, url) {\r\n        var start = url.indexOf(s);\r\n        if (start < 0)\r\n            return null;\r\n        var end = url.indexOf(\"&\", start + s.length);\r\n        return url.substring(start, ((end > 0) ? end : url.length));\r\n    };\r\n    Identity.prototype.checkForIdentityRedirect = function () {\r\n        var params = this.parseQueryString(window.location.href);\r\n        var idToken = this.token(\"#id_token=\", window.location.href);\r\n        var accessToken = this.token(\"#access_token\", window.location.href);\r\n        if (idToken) {\r\n            if (true || this.state === params[\"state\"][0]) {\r\n                this.decodeIdToken(idToken);\r\n                this.loginCallback && this.loginCallback(null);\r\n            }\r\n            else {\r\n                var error = new Error();\r\n                error.statusText = \"Invalid state\";\r\n                this.loginCallback && this.loginCallback(error);\r\n            }\r\n            return true;\r\n        }\r\n        else if (accessToken) {\r\n            throw \"Should not get here.  This should be handled via the iframe approach.\";\r\n        }\r\n        return false;\r\n    };\r\n    Identity.prototype.decodeIdToken = function (idToken) {\r\n        var _this = this;\r\n        var decodedToken = this.base64Decode(idToken.substring(idToken.indexOf('.') + 1, idToken.lastIndexOf('.')));\r\n        var decodedTokenJSON = JSON.parse(decodedToken);\r\n        var expiryDate = new Date(new Date('01/01/1970 0:0 UTC').getTime() + parseInt(decodedTokenJSON.exp) * 1000);\r\n        this.idToken = new IdToken();\r\n        this.idToken.FullToken = decodedTokenJSON;\r\n        this.idToken.Token = idToken;\r\n        this.idToken.Expiry = expiryDate;\r\n        this.idToken.UPN = decodedTokenJSON.upn;\r\n        this.idToken.TenantId = decodedTokenJSON.tid;\r\n        this.idToken.FamilyName = decodedTokenJSON.family_name;\r\n        this.idToken.GivenName = decodedTokenJSON.given_name;\r\n        this.idToken.Name = decodedTokenJSON.name;\r\n        this.idToken.PreferredUsername = decodedTokenJSON.preferred_username;\r\n        var expiration = expiryDate.getTime() - new Date().getTime() - 300000;\r\n        this.refreshTimer = setTimeout((function () {\r\n            _this.renewIdToken();\r\n        }), expiration);\r\n    };\r\n    Identity.prototype.decodeAccessToken = function (accessToken, resource, scopes) {\r\n        var decodedToken = this.base64Decode(accessToken.substring(accessToken.indexOf('.') + 1, accessToken.lastIndexOf('.')));\r\n        var decodedTokenJSON = JSON.parse(decodedToken);\r\n        var expiryDate = new Date(new Date('01/01/1970 0:0 UTC').getTime() + parseInt(decodedTokenJSON.exp) * 1000);\r\n        var key = resource || scopes.join(\" \");\r\n        var token = new CachedToken(key, scopes, resource, accessToken, expiryDate);\r\n        return token;\r\n    };\r\n    Identity.prototype.getIdToken = function () {\r\n        return this.idToken;\r\n    };\r\n    Identity.prototype.isLoggedIn = function () {\r\n        if (!this.idToken)\r\n            return false;\r\n        return (this.idToken.Expiry > new Date());\r\n    };\r\n    Identity.prototype.renewIdToken = function () {\r\n        clearTimeout(this.refreshTimer);\r\n        this.login(function () { });\r\n    };\r\n    Identity.prototype.getCurrentEndPointVersion = function () {\r\n        return this.version;\r\n    };\r\n    Identity.prototype.getAccessTokenAsync = function (resource) {\r\n        var d = new promises_1.Deferred();\r\n        this.getAccessToken(resource, (function (error, token) {\r\n            if (error) {\r\n                d.reject(error);\r\n            }\r\n            else {\r\n                d.resolve(token);\r\n            }\r\n        }));\r\n        return d.promise;\r\n    };\r\n    Identity.prototype.getAccessToken = function (resource, callback) {\r\n        var _this = this;\r\n        if (this.version !== EndPointVersion.v1) {\r\n            var e = new Error();\r\n            e.statusText = \"Currently this identity class is using v2 endpoint mode. You need to use getAccessTokenForScopes() method\";\r\n            callback(e);\r\n            return;\r\n        }\r\n        if (this.mode === Mode.Client) {\r\n            var token = this.tokenCache.getForResource(resource);\r\n            if (token) {\r\n                return callback(null, token.token);\r\n            }\r\n            this.getTokenCallback = (function (token, error) {\r\n                if (error) {\r\n                    callback(error);\r\n                }\r\n                else {\r\n                    var t = _this.decodeAccessToken(token, resource);\r\n                    _this.tokenCache.add(t);\r\n                    callback(null, token);\r\n                }\r\n            });\r\n            this.nonce = \"token\" + this.generateNonce();\r\n            this.state = \"token\" + this.generateNonce();\r\n            var iframe = document.createElement('iframe');\r\n            iframe.style.display = \"none\";\r\n            iframe.id = \"tokenIFrame\";\r\n            iframe.src = this.tokenProcessorUrl + \"?clientId=\" + encodeURIComponent(this.clientId) +\r\n                \"&resource=\" + encodeURIComponent(resource) +\r\n                \"&redirectUri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n                \"&state=\" + encodeURIComponent(this.state) +\r\n                \"&version=\" + encodeURIComponent(this.version.toString()) +\r\n                \"&nonce=\" + encodeURIComponent(this.nonce) +\r\n                \"&op=token\";\r\n            document.body.appendChild(iframe);\r\n        }\r\n        else {\r\n            var cookies = this.parseNodeCookies(this.req);\r\n            var upn = this.NodeRetrieveDataCallBack(\"session|\" + cookies[\"kurveSession\"]);\r\n            var code = this.NodeRetrieveDataCallBack(\"code|\" + upn);\r\n            var post_data = \"grant_type=authorization_code\" +\r\n                \"&client_id=\" + encodeURIComponent(this.clientId) +\r\n                \"&code=\" + encodeURIComponent(code) +\r\n                \"&redirect_uri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n                \"&resource=\" + encodeURIComponent(resource) +\r\n                \"&client_secret=\" + encodeURIComponent(this.appSecret);\r\n            var post_options = {\r\n                host: 'login.microsoftonline.com',\r\n                port: '443',\r\n                path: '/common/oauth2/token',\r\n                method: 'POST',\r\n                headers: {\r\n                    'Content-Type': 'application/x-www-form-urlencoded',\r\n                    'Content-Length': post_data.length,\r\n                    accept: '*/*'\r\n                }\r\n            };\r\n            var post_req = this.https.request(post_options, function (response) {\r\n                response.setEncoding('utf8');\r\n                response.on('data', function (chunk) {\r\n                    var chunkJson = JSON.parse(chunk);\r\n                    var t = _this.decodeAccessToken(chunkJson.access_token, resource);\r\n                    callback(null, chunkJson.access_token);\r\n                });\r\n            });\r\n            post_req.write(post_data);\r\n            post_req.end();\r\n        }\r\n    };\r\n    Identity.prototype.parseNodeCookies = function (req) {\r\n        var list = {};\r\n        var rc = req.headers.cookie;\r\n        rc && rc.split(';').forEach(function (cookie) {\r\n            var parts = cookie.split('=');\r\n            list[parts.shift().trim()] = decodeURI(parts.join('='));\r\n        });\r\n        return list;\r\n    };\r\n    Identity.prototype.handleNodeCallback = function (req, res, https, crypto, persistDataCallback, retrieveDataCallback) {\r\n        var _this = this;\r\n        this.NodePersistDataCallBack = persistDataCallback;\r\n        this.NodeRetrieveDataCallBack = retrieveDataCallback;\r\n        var url = req.url;\r\n        this.req = req;\r\n        this.res = res;\r\n        this.https = https;\r\n        var params = this.parseQueryString(url);\r\n        var code = this.token(\"code=\", url);\r\n        var accessToken = this.token(\"#access_token\", url);\r\n        var cookies = this.parseNodeCookies(req);\r\n        var d = new promises_1.Deferred();\r\n        if (this.version === EndPointVersion.v1) {\r\n            if (code) {\r\n                var codeFromRequest = params[\"code\"][0];\r\n                var stateFromRequest = params[\"state\"][0];\r\n                var cachedState = retrieveDataCallback(\"state|\" + stateFromRequest);\r\n                if (cachedState) {\r\n                    if (cachedState === \"waiting\") {\r\n                        var expiry = new Date(new Date().getTime() + 86400000);\r\n                        persistDataCallback(\"state|\" + stateFromRequest, \"done\", expiry);\r\n                        var post_data = \"grant_type=authorization_code\" +\r\n                            \"&client_id=\" + encodeURIComponent(this.clientId) +\r\n                            \"&code=\" + encodeURIComponent(codeFromRequest) +\r\n                            \"&redirect_uri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n                            \"&resource=\" + encodeURIComponent(\"https://graph.microsoft.com\") +\r\n                            \"&client_secret=\" + encodeURIComponent(this.appSecret);\r\n                        var post_options = {\r\n                            host: 'login.microsoftonline.com',\r\n                            port: '443',\r\n                            path: '/common/oauth2/token',\r\n                            method: 'POST',\r\n                            headers: {\r\n                                'Content-Type': 'application/x-www-form-urlencoded',\r\n                                'Content-Length': post_data.length,\r\n                                accept: '*/*'\r\n                            }\r\n                        };\r\n                        var post_req = https.request(post_options, function (response) {\r\n                            response.setEncoding('utf8');\r\n                            response.on('data', function (chunk) {\r\n                                var chunkJson = JSON.parse(chunk);\r\n                                var decodedToken = JSON.parse(_this.base64Decode(chunkJson.access_token.substring(chunkJson.access_token.indexOf('.') + 1, chunkJson.access_token.lastIndexOf('.'))));\r\n                                var upn = decodedToken.upn;\r\n                                var sha = crypto.createHash('sha256');\r\n                                sha.update(Math.random().toString());\r\n                                var sessionID = sha.digest('hex');\r\n                                var expiry = new Date(new Date().getTime() + 30 * 60 * 1000);\r\n                                persistDataCallback(\"session|\" + sessionID, upn, expiry);\r\n                                persistDataCallback(\"code|\" + upn, codeFromRequest, expiry);\r\n                                res.writeHead(302, {\r\n                                    'Set-Cookie': 'kurveSession=' + sessionID,\r\n                                    'Location': '/'\r\n                                });\r\n                                res.end();\r\n                                d.resolve(false);\r\n                            });\r\n                        });\r\n                        post_req.write(post_data);\r\n                        post_req.end();\r\n                    }\r\n                    else {\r\n                        res.writeHead(500, \"Replay detected\", { 'content-type': 'text/plain' });\r\n                        res.end(\"Replay detected\");\r\n                        d.resolve(false);\r\n                    }\r\n                }\r\n                else {\r\n                    res.writeHead(500, \"State doesn't match\", { 'content-type': 'text/plain' });\r\n                    res.end(\"State doesn't match\");\r\n                    d.resolve(false);\r\n                }\r\n                return d.promise;\r\n            }\r\n            else {\r\n                if (cookies[\"kurveSession\"]) {\r\n                    var upn = retrieveDataCallback(\"session|\" + cookies[\"kurveSession\"]);\r\n                    if (upn) {\r\n                        d.resolve(true);\r\n                        return d.promise;\r\n                    }\r\n                }\r\n                var state = this.generateNonce();\r\n                var expiry = new Date(new Date().getTime() + 900000);\r\n                persistDataCallback(\"state|\" + state, \"waiting\", expiry);\r\n                var url = \"https://login.microsoftonline.com/common/oauth2/authorize?response_type=code&client_id=\" +\r\n                    encodeURIComponent(this.clientId) +\r\n                    \"&redirect_uri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n                    \"&state=\" + encodeURIComponent(state);\r\n                res.writeHead(302, { 'Location': url });\r\n                res.end();\r\n                d.resolve(false);\r\n                return d.promise;\r\n            }\r\n        }\r\n        else {\r\n            d.resolve(false);\r\n            return d.promise;\r\n        }\r\n    };\r\n    Identity.prototype.getAccessTokenForScopesAsync = function (scopes, promptForConsent) {\r\n        if (promptForConsent === void 0) { promptForConsent = false; }\r\n        var d = new promises_1.Deferred();\r\n        this.getAccessTokenForScopes(scopes, promptForConsent, function (token, error) {\r\n            if (error) {\r\n                d.reject(error);\r\n            }\r\n            else {\r\n                d.resolve(token);\r\n            }\r\n        });\r\n        return d.promise;\r\n    };\r\n    Identity.prototype.getAccessTokenForScopes = function (scopes, promptForConsent, callback) {\r\n        var _this = this;\r\n        if (promptForConsent === void 0) { promptForConsent = false; }\r\n        if (this.version !== EndPointVersion.v2) {\r\n            var e = new Error();\r\n            e.statusText = \"Dynamic scopes require v2 mode. Currently this identity class is using v1\";\r\n            callback(null, e);\r\n            return;\r\n        }\r\n        var token = this.tokenCache.getForScopes(scopes);\r\n        if (token) {\r\n            return callback(token.token, null);\r\n        }\r\n        this.getTokenCallback = (function (token, error) {\r\n            if (error) {\r\n                if (promptForConsent || !error.text) {\r\n                    callback(null, error);\r\n                }\r\n                else if (error.text.indexOf(\"AADSTS65001\") >= 0) {\r\n                    _this.getAccessTokenForScopes(scopes, true, _this.getTokenCallback);\r\n                }\r\n                else {\r\n                    callback(null, error);\r\n                }\r\n            }\r\n            else {\r\n                var t = _this.decodeAccessToken(token, null, scopes);\r\n                _this.tokenCache.add(t);\r\n                callback(token, null);\r\n            }\r\n        });\r\n        this.nonce = \"token\" + this.generateNonce();\r\n        this.state = \"token\" + this.generateNonce();\r\n        if (!promptForConsent) {\r\n            var iframe = document.createElement('iframe');\r\n            iframe.style.display = \"none\";\r\n            iframe.id = \"tokenIFrame\";\r\n            iframe.src = this.tokenProcessorUrl + \"?clientId=\" + encodeURIComponent(this.clientId) +\r\n                \"&scopes=\" + encodeURIComponent(scopes.join(\" \")) +\r\n                \"&redirectUri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n                \"&version=\" + encodeURIComponent(this.version.toString()) +\r\n                \"&state=\" + encodeURIComponent(this.state) +\r\n                \"&nonce=\" + encodeURIComponent(this.nonce) +\r\n                \"&login_hint=\" + encodeURIComponent(this.idToken.PreferredUsername) +\r\n                \"&domain_hint=\" + encodeURIComponent(this.idToken.TenantId === \"9188040d-6c67-4c5b-b112-36a304b66dad\" ? \"consumers\" : \"organizations\") +\r\n                \"&op=token\";\r\n            document.body.appendChild(iframe);\r\n        }\r\n        else {\r\n            window.open(this.tokenProcessorUrl + \"?clientId=\" + encodeURIComponent(this.clientId) +\r\n                \"&scopes=\" + encodeURIComponent(scopes.join(\" \")) +\r\n                \"&redirectUri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n                \"&version=\" + encodeURIComponent(this.version.toString()) +\r\n                \"&state=\" + encodeURIComponent(this.state) +\r\n                \"&nonce=\" + encodeURIComponent(this.nonce) +\r\n                \"&op=token\", \"_blank\");\r\n        }\r\n    };\r\n    Identity.prototype.loginAsync = function (loginSettings) {\r\n        var d = new promises_1.Deferred();\r\n        this.login(function (error) {\r\n            if (error) {\r\n                d.reject(error);\r\n            }\r\n            else {\r\n                d.resolve(null);\r\n            }\r\n        }, loginSettings);\r\n        return d.promise;\r\n    };\r\n    Identity.prototype.login = function (callback, loginSettings) {\r\n        this.loginCallback = callback;\r\n        if (!loginSettings)\r\n            loginSettings = {};\r\n        if (loginSettings.policy)\r\n            this.policy = loginSettings.policy;\r\n        if (loginSettings.scopes && this.version === EndPointVersion.v1) {\r\n            var e = new Error();\r\n            e.text = \"Scopes can only be used with endpoint v2.\";\r\n            callback(e);\r\n            return;\r\n        }\r\n        if (loginSettings.policy && !loginSettings.tenant) {\r\n            var e = new Error();\r\n            e.text = \"In order to use policy (AAD B2C) a tenant must be specified as well.\";\r\n            callback(e);\r\n            return;\r\n        }\r\n        this.state = \"login\" + this.generateNonce();\r\n        this.nonce = \"login\" + this.generateNonce();\r\n        var loginURL = this.tokenProcessorUrl + \"?clientId=\" + encodeURIComponent(this.clientId) +\r\n            \"&redirectUri=\" + encodeURIComponent(this.tokenProcessorUrl) +\r\n            \"&state=\" + encodeURIComponent(this.state) +\r\n            \"&nonce=\" + encodeURIComponent(this.nonce) +\r\n            \"&version=\" + encodeURIComponent(this.version.toString()) +\r\n            \"&op=login\" +\r\n            \"&p=\" + encodeURIComponent(this.policy);\r\n        if (loginSettings.tenant) {\r\n            loginURL += \"&tenant=\" + encodeURIComponent(loginSettings.tenant);\r\n        }\r\n        if (this.version === EndPointVersion.v2) {\r\n            if (!loginSettings.scopes)\r\n                loginSettings.scopes = [];\r\n            if (loginSettings.scopes.indexOf(\"profile\") < 0)\r\n                loginSettings.scopes.push(\"profile\");\r\n            if (loginSettings.scopes.indexOf(\"openid\") < 0)\r\n                loginSettings.scopes.push(\"openid\");\r\n            loginURL += \"&scopes=\" + encodeURIComponent(loginSettings.scopes.join(\" \"));\r\n        }\r\n        window.open(loginURL, \"_blank\");\r\n    };\r\n    Identity.prototype.loginNoWindowAsync = function (toUrl) {\r\n        var d = new promises_1.Deferred();\r\n        this.loginNoWindow(function (error) {\r\n            if (error) {\r\n                d.reject(error);\r\n            }\r\n            else {\r\n                d.resolve(null);\r\n            }\r\n        }, toUrl);\r\n        return d.promise;\r\n    };\r\n    Identity.prototype.loginNoWindow = function (callback, toUrl) {\r\n        this.loginCallback = callback;\r\n        this.state = \"clientId=\" + this.clientId + \"&\" + \"tokenProcessorUrl=\" + this.tokenProcessorUrl;\r\n        this.nonce = this.generateNonce();\r\n        var redirected = this.checkForIdentityRedirect();\r\n        if (!redirected) {\r\n            var redirectUri = (toUrl) ? toUrl : window.location.href.split(\"#\")[0];\r\n            var url = \"https://login.microsoftonline.com/common/oauth2/authorize?response_type=id_token\" +\r\n                \"&client_id=\" + encodeURIComponent(this.clientId) +\r\n                \"&redirect_uri=\" + encodeURIComponent(redirectUri) +\r\n                \"&state=\" + encodeURIComponent(this.state) +\r\n                \"&nonce=\" + encodeURIComponent(this.nonce);\r\n            window.location.href = url;\r\n        }\r\n    };\r\n    Identity.prototype.logOut = function () {\r\n        this.tokenCache.clear();\r\n        var url = \"https://login.microsoftonline.com/common/oauth2/logout?post_logout_redirect_uri=\" + encodeURI(window.location.href);\r\n        window.location.href = url;\r\n    };\r\n    Identity.prototype.base64Decode = function (encodedString) {\r\n        var e = {}, i, b = 0, c, x, l = 0, a, r = '', w = String.fromCharCode, L = encodedString.length;\r\n        var A = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\r\n        for (i = 0; i < 64; i++) {\r\n            e[A.charAt(i)] = i;\r\n        }\r\n        for (x = 0; x < L; x++) {\r\n            c = e[encodedString.charAt(x)];\r\n            b = (b << 6) + c;\r\n            l += 6;\r\n            while (l >= 8) {\r\n                ((a = (b >>> (l -= 8)) & 0xff) || (x < (L - 2))) && (r += w(a));\r\n            }\r\n        }\r\n        return r;\r\n    };\r\n    Identity.prototype.generateNonce = function () {\r\n        var text = \"\";\r\n        var chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n        for (var i = 0; i < 32; i++) {\r\n            text += chars.charAt(Math.floor(Math.random() * chars.length));\r\n        }\r\n        return text;\r\n    };\r\n    return Identity;\r\n}());\r\nexports.Identity = Identity;\r\n\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./src/identity.ts\n ** module id = 3\n ** module chunks = 0\n **/"],"sourceRoot":""}