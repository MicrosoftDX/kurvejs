{"version":3,"sources":["KurveIdentity.ts"],"names":["Kurve","Kurve.Identity","Kurve.Identity.constructor","Kurve.Identity.decodeIdToken","Kurve.Identity.decodeAccessToken","Kurve.Identity.getIdToken","Kurve.Identity.isLoggedIn","Kurve.Identity.renewIdToken","Kurve.Identity.getAccessTokenAsync","Kurve.Identity.getAccessToken","Kurve.Identity.loginAsync","Kurve.Identity.login","Kurve.Identity.logOut","Kurve.Identity.base64Decode","Kurve.Identity.generateNonce"],"mappings":"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AAqBA,aAAqBA;YACtCY,IAAIA,CAACA,GAAGA,EAAEA,EAAEA,CAACA,EAAEA,CAACA,GAAGA,CAACA,EAAEA,CAACA,EAAEA,CAACA,EAAEA,CAACA,GAAGA,CAACA,EAAEA,CAACA,EAAEA,CAACA,GAAGA,EAAEA,EAAEA,CAACA,GAAGA,MAAMA,CAACA,YAAYA,EAAEA,CAACA,GAAGA,aAAaA,CAACA,MAAMA,CAACA;YAChGA,IAAIA,CAACA,GAAGA,kEAAkEA,CAACA;YAC3EA,GAAGA,CAACA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,EAAEA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;gBAACA,CAACA,CAACA,CAACA,CAACA,MAAMA,CAACA,CAACA,CAACA,CAACA,GAAGA,CAACA,CAACA;YAACA,CAACA;YAChDA,GAAGA,CAACA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,CAACA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;gBACrBA,CAACA,GAAGA,CAACA,CAACA,aAAaA,CAACA,MAAMA,CAACA,CAACA,CAACA,CAACA,CAACA;gBAACA,CAACA,GAAGA,CAACA,CAACA,IAAIA,CAACA,CAACA,GAAGA,CAACA,CAACA;gBAACA,CAACA,IAAIA,CAACA,CAACA;gBACzDA,OAAOA,CAACA,IAAIA,CAACA,EAAEA,CAACA;oBAACA,CAACA,CAACA,CAACA,GAAGA,CAACA,CAACA,KAAKA,CAACA,CAACA,IAAIA,CAACA,CAACA,CAACA,GAAGA,IAAIA,CAACA,IAAIA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,CAACA,CAACA,IAAIA,CAACA,CAACA,IAAIA,CAACA,CAACA,CAACA,CAACA,CAACA,CAACA;gBAACA,CAACA;YACvFA,CAACA;YACDA,MAAMA,CAACA,CAACA,CAACA;QACbA,CAACA;QAEOZ,gCAAaA,GAArBA;YACIa,IAAIA,IAAIA,GAAGA,EAAEA,CAACA;YACdA,IAAIA,KAAKA,GAAGA,gEAAgEA,CAACA;YAC7EA,GAAGA,CAACA,CAACA,GAAGA,CAACA,CAACA,GAAGA,CAACA,EAAEA,CAACA,GAAGA,EAAEA,EAAEA,CAACA,EAAEA,EAAEA,CAACA;gBAC1BA,IAAIA,IAAIA,KAAKA,CAACA,MAAMA,CAACA,IAAIA,CAACA,KAAKA,CAACA,IAAIA,CAACA,MAAMA,EAAEA,GAAGA,KAAKA,CAACA,MAAMA,CAACA,CAACA,CAACA;YACnEA,CAACA;YACDA,MAAMA,CAACA,IAAIA,CAACA;QAChBA,CAACA;QACLb,eAACA;IAADA,CA7MCD,AA6MAC,IAAAD;IA7MaA,cAAQA,WA6MrBA,CAAAA;AACLA,CAACA,EA/MM,KAAK,KAAL,KAAK,QA+MX;AAGD,8DAA8D;AAC9D,KAAK;AACL,kDAAkD;AAClD,IAAI;AACJ,uCAAuC;AACvC,yBAAyB;AACzB,IAAI;AACJ,iBAAiB;AACjB,0EAA0E;AAC1E,oEAAoE;AACpE,0EAA0E;AAC1E,wEAAwE;AACxE,uEAAuE;AACvE,0EAA0E;AAC1E,8BAA8B;AAK9B,mEAAmE;AACnE,oEAAoE;AAKpE,sEAAsE;AACtE,uEAAuE;AACvE,0DAA0D;AAC1D,2EAA2E;AAC3E,2EAA2E;AAC3E,0EAA0E;AAC1E,oEAAoE;AACpE,KAAK;AACL,8DAA8D","file":"KurveIdentity-0.1.0.js","sourcesContent":["// Copyright (c) Microsoft. All rights reserved. Licensed under the MIT license. See full license at the bottom of this file.\r\nmodule Kurve {\r\n     export class Identity {\r\n        public authContext: any = null;\r\n        public config: any = null;\r\n        public isCallback: boolean = false;\r\n        public clientId: string;\r\n        public tenantId: string;\r\n        private req: XMLHttpRequest;\r\n        private state: string;\r\n        private nonce: string;\r\n        private idToken: any;\r\n        private loginCallback: (error: string) => void;\r\n        private getTokenCallback: (token: string, error: string) => void;\r\n        private redirectUri: string;\r\n        private tokenCache: any;\r\n        private logonUser: any;\r\n        private refreshTimer: any;\r\n    \r\n        constructor(tenantId = \"\", clientId = \"\", redirectUri = \"\") {\r\n            this.tenantId = tenantId;\r\n            this.clientId = clientId;\r\n            this.redirectUri = redirectUri;\r\n            this.req = new XMLHttpRequest();\r\n            this.tokenCache = {};\r\n\r\n            //Callback handler from other windows\r\n            window.addEventListener(\"message\", ((event: MessageEvent) => {\r\n                if (event.data.type === \"id_token\") {\r\n                    //Callback being called by the login window\r\n                    if (!event.data.token) {\r\n                        this.loginCallback(event.data);\r\n                    }\r\n                    else {\r\n                        //check for state\r\n                        if (this.state !== event.data.state) {\r\n                            throw \"Invalid state\";\r\n                        } else {\r\n                            this.decodeIdToken(event.data.token);\r\n                            this.loginCallback(null);\r\n                        }\r\n                    }\r\n                } else if (event.data.type === \"access_token\") {\r\n                    //Callback being called by the iframe with the token\r\n                    if (!event.data.token)\r\n                        this.getTokenCallback(null, event.data);\r\n                    else {\r\n                        var token:string = event.data.token;\r\n                        var iframe = document.getElementById(\"tokenIFrame\");\r\n                        iframe.parentNode.removeChild(iframe);\r\n\r\n                        if (event.data.state !== this.state) {\r\n                            throw \"Invalid state\";\r\n                        }\r\n                        else {\r\n                            this.getTokenCallback(token, null);\r\n                        }\r\n                    }\r\n                }\r\n            }));\r\n        }\r\n\r\n        private decodeIdToken(idToken: string): void {\r\n           \r\n            var decodedToken = this.base64Decode(idToken.substring(idToken.indexOf('.') + 1, idToken.lastIndexOf('.')));\r\n            var decodedTokenJSON = JSON.parse(decodedToken);\r\n            var expiryDate = new Date(new Date('01/01/1970 0:0 UTC').getTime() + parseInt(decodedTokenJSON.exp) * 1000);\r\n            this.idToken = {\r\n                token: idToken,\r\n                expiry: expiryDate,\r\n                upn: decodedTokenJSON.upn,\r\n                tenantId: decodedTokenJSON.tid,\r\n                family_name: decodedTokenJSON.family_name,\r\n                given_name: decodedTokenJSON.given_name,\r\n                name: decodedTokenJSON.name\r\n            }\r\n            this.refreshTimer = setTimeout((() => {\r\n                this.renewIdToken();\r\n            }), parseInt(decodedTokenJSON.exp) * 1000 - 300000); \r\n        }\r\n\r\n        private decodeAccessToken(accessToken: string, resource:string): void {\r\n            var decodedToken = this.base64Decode(accessToken.substring(accessToken.indexOf('.') + 1, accessToken.lastIndexOf('.')));\r\n            var decodedTokenJSON = JSON.parse(decodedToken);\r\n            var expiryDate = new Date(new Date('01/01/1970 0:0 UTC').getTime() + parseInt(decodedTokenJSON.exp) * 1000);\r\n            this.tokenCache[resource] = {\r\n                resource: resource,\r\n                token: accessToken,\r\n                expiry: expiryDate\r\n            }\r\n        }\r\n\r\n        public getIdToken(): any {\r\n            return this.idToken;\r\n        }\r\n        public isLoggedIn(): boolean {\r\n            if (!this.idToken) return false;\r\n            return (this.idToken.expiry > new Date());\r\n        }\r\n\r\n        private renewIdToken(): void {\r\n            clearTimeout(this.refreshTimer);\r\n            this.login((() => {\r\n\r\n            }));\r\n        }\r\n\r\n        public getAccessTokenAsync(resource: string): Promise {\r\n\r\n            var d = new Deferred();\r\n            this.getAccessToken(resource, ((token, error) => {\r\n                if (error) {\r\n                    d.reject(error);\r\n                } else {\r\n                    d.resolve(token);\r\n                }\r\n            }));\r\n            return d.promise;\r\n        }\r\n\r\n        public getAccessToken(resource: string, callback: (token: string, error: string) => void): void {\r\n            //Check for cache and see if we have a valid token\r\n            var cachedToken = this.tokenCache[resource];\r\n            if (cachedToken) {\r\n                //We have it cached, has it expired? (5 minutes error margin)\r\n                if (cachedToken.expiry > (new Date(new Date().getTime() + 60000))) {\r\n                    callback(<string>cachedToken.token, null);\r\n                    return;\r\n                }\r\n            }\r\n            //If we got this far, we need to go get this token\r\n\r\n            //Need to create the iFrame to invoke the acquire token\r\n            this.getTokenCallback = ((token: string, error: string) => {\r\n                if (error) {\r\n                    callback(null, error);\r\n                }\r\n                else {\r\n                    this.decodeAccessToken(token, resource);\r\n                    callback(token, null);\r\n\r\n                }\r\n            });\r\n\r\n            this.nonce = this.generateNonce();\r\n            this.state = this.generateNonce();\r\n\r\n            var iframe = document.createElement('iframe');\r\n            iframe.style.display = \"none\";\r\n            iframe.id = \"tokenIFrame\";\r\n            iframe.src = \"./login.html?tenantId=\" + encodeURIComponent(this.tenantId) +\r\n            \"&clientId=\" + encodeURIComponent(this.clientId) +\r\n            \"&resource=\" + encodeURIComponent(resource) +\r\n            \"&redirectUri=\" + encodeURIComponent(this.redirectUri) +\r\n            \"&state=\" + encodeURIComponent(this.state) +\r\n            \"&nonce=\" + encodeURIComponent(this.nonce);\r\n            document.body.appendChild(iframe);\r\n        }\r\n\r\n        public loginAsync(): Promise {\r\n            var d = new Deferred();\r\n            this.login(((error) => {\r\n                if (error) {\r\n                    d.reject(error);\r\n                }\r\n                else {\r\n                    d.resolve();\r\n                }\r\n            }));\r\n            return d.promise;\r\n        }\r\n\r\n        public login(callback: (error: string) => void): void {\r\n            this.loginCallback = callback;\r\n            this.state = this.generateNonce();\r\n            this.nonce = this.generateNonce();\r\n            window.open(\"./login.html?tenantId=\" + encodeURIComponent(this.tenantId) +\r\n                \"&clientId=\" + encodeURIComponent(this.clientId) +\r\n                \"&redirectUri=\" + encodeURIComponent(this.redirectUri) +\r\n                \"&state=\" + encodeURIComponent(this.state) +\r\n                \"&nonce=\" + encodeURIComponent(this.nonce), \"_blank\");\r\n        }\r\n\r\n        public logOut(): void {\r\n            var url = \"https://login.windows.net/\" + this.tenantId + \"/oauth2/logout?post_logout_redirect_uri=\" + encodeURI(window.location.href);\r\n            window.location.href = url;\r\n        }\r\n\r\n        private base64Decode(encodedString: string): string {\r\n            var e = {}, i, b = 0, c, x, l = 0, a, r = '', w = String.fromCharCode, L = encodedString.length;\r\n            var A = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\r\n            for (i = 0; i < 64; i++) { e[A.charAt(i)] = i; }\r\n            for (x = 0; x < L; x++) {\r\n                c = e[encodedString.charAt(x)]; b = (b << 6) + c; l += 6;\r\n                while (l >= 8) { ((a = (b >>> (l -= 8)) & 0xff) || (x < (L - 2))) && (r += w(a)); }\r\n            }\r\n            return r;\r\n        }\r\n\r\n        private generateNonce(): string {\r\n            var text = \"\";\r\n            var chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\r\n            for (var i = 0; i < 32; i++) {\r\n                text += chars.charAt(Math.floor(Math.random() * chars.length));\r\n            }\r\n            return text;\r\n        }\r\n    }\r\n}\r\n\r\n\r\n//*********************************************************   \r\n//   \r\n//Kurve js, https://github.com/microsoftdx/kurvejs\r\n//  \r\n//Copyright (c) Microsoft Corporation  \r\n//All rights reserved.   \r\n//  \r\n// MIT License:  \r\n// Permission is hereby granted, free of charge, to any person obtaining  \r\n// a copy of this software and associated documentation files (the  \r\n// \"\"Software\"\"), to deal in the Software without restriction, including  \r\n// without limitation the rights to use, copy, modify, merge, publish,  \r\n// distribute, sublicense, and/or sell copies of the Software, and to  \r\n// permit persons to whom the Software is furnished to do so, subject to  \r\n// the following conditions:  \r\n\r\n\r\n\r\n\r\n// The above copyright notice and this permission notice shall be  \r\n// included in all copies or substantial portions of the Software.  \r\n\r\n\r\n\r\n\r\n// THE SOFTWARE IS PROVIDED \"\"AS IS\"\", WITHOUT WARRANTY OF ANY KIND,  \r\n// EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF  \r\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND  \r\n// NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE  \r\n// LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION  \r\n// OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION  \r\n// WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.  \r\n//   \r\n//*********************************************************   \r\n"],"sourceRoot":"/source/"}