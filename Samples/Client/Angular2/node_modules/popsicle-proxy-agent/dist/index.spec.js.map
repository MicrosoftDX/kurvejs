{"version":3,"file":"index.spec.js","sourceRoot":"","sources":["../src/index.spec.ts"],"names":[],"mappings":";AAAA,yBAAwB,UACxB,CAAC,CADiC;AAClC,oBAAsB,KACtB,CAAC,CAD0B;AAC3B,IAAO,IAAI,WAAW,WAAW,CAAC,CAAA;AAClC,IAAO,aAAa,WAAW,gBAAgB,CAAC,CAAA;AAChD,IAAO,KAAK,WAAW,SAAS,CAAC,CAAA;AAEjC,IAAI,CAAC,gBAAgB,EAAE,UAAA,CAAC;IACtB,IAAI,MAAmC,CAAA;IACvC,IAAI,WAAwC,CAAA;IAE5C,CAAC,CAAC,IAAI,CAAC,QAAQ,EAAE,UAAA,CAAC;QAChB,WAAW,GAAG,aAAa,CAAC,UAAU,GAAG,EAAE,GAAG;YAC5C,GAAG,CAAC,GAAG,CAAC,QAAQ,GAAG,GAAG,CAAC,GAAG,CAAC,CAAA;QAC7B,CAAC,CAAC,CAAA;QAEF,MAAM,GAAG,aAAa,CAAC,UAAU,GAAG,EAAE,GAAG;YACvC,GAAG,CAAC,GAAG,CAAC,SAAS,GAAG,GAAG,CAAC,GAAG,CAAC,CAAA;QAC9B,CAAC,CAAC,CAAA;QAEF,MAAM,CAAC,MAAM,EAAE,CAAA;QACf,WAAW,CAAC,MAAM,EAAE,CAAA;QAEpB,CAAC,CAAC,GAAG,EAAE,CAAA;IACT,CAAC,CAAC,CAAA;IAEF,CAAC,CAAC,IAAI,CAAC,kBAAkB,EAAE,UAAA,CAAC;QAC1B,MAAM,CAAC,kBAAO,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;aACzB,GAAG,CAAC,KAAK,CAAC,EAAE,KAAK,EAAE,WAAW,CAAC,GAAG,EAAE,EAAE,CAAC,CAAC;aACxC,IAAI,CAAC,UAAU,GAAG;YACjB,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,CAAA;YACxB,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,QAAQ,GAAG,MAAM,CAAC,GAAG,EAAE,CAAC,CAAA;QAC5C,CAAC,CAAC,CAAA;IACN,CAAC,CAAC,CAAA;IAEF,CAAC,CAAC,IAAI,CAAC,kBAAkB,EAAE,UAAA,CAAC;QAC1B,MAAM,CAAC,kBAAO,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC;aACzB,GAAG,CAAC,KAAK,CAAC,EAAE,KAAK,EAAE,WAAW,CAAC,GAAG,EAAE,EAAE,OAAO,EAAE,WAAK,CAAC,MAAM,CAAC,GAAG,EAAE,CAAC,CAAC,QAAQ,EAAE,CAAC,CAAC;aAC/E,IAAI,CAAC,UAAU,GAAG;YACjB,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,CAAA;YACxB,CAAC,CAAC,KAAK,CAAC,GAAG,CAAC,IAAI,EAAE,UAAU,CAAC,CAAA;QAC/B,CAAC,CAAC,CAAA;IACN,CAAC,CAAC,CAAA;IAEF,CAAC,CAAC,IAAI,CAAC,OAAO,EAAE,UAAA,CAAC;QACf,MAAM,CAAC,KAAK,EAAE,CAAA;QACd,WAAW,CAAC,KAAK,EAAE,CAAA;QAEnB,CAAC,CAAC,GAAG,EAAE,CAAA;IACT,CAAC,CAAC,CAAA;AACJ,CAAC,CAAC,CAAA","sourcesContent":["import { request } from 'popsicle'\nimport { parse } from 'url'\nimport test = require('blue-tape')\nimport serverAddress = require('server-address')\nimport proxy = require('./index')\n\ntest('popsicle proxy', t => {\n  let server: serverAddress.ServerAddress\n  let proxyServer: serverAddress.ServerAddress\n\n  t.test('before', t => {\n    proxyServer = serverAddress(function (req, res) {\n      res.end('proxy ' + req.url)\n    })\n\n    server = serverAddress(function (req, res) {\n      res.end('server ' + req.url)\n    })\n\n    server.listen()\n    proxyServer.listen()\n\n    t.end()\n  })\n\n  t.test('use proxy option', t => {\n    return request(server.url())\n      .use(proxy({ proxy: proxyServer.url() }))\n      .then(function (res) {\n        t.equal(res.status, 200)\n        t.equal(res.body, 'proxy ' + server.url())\n      })\n  })\n\n  t.test('support no proxy', t => {\n    return request(server.url())\n      .use(proxy({ proxy: proxyServer.url(), noProxy: parse(server.url()).hostname }))\n      .then(function (res) {\n        t.equal(res.status, 200)\n        t.equal(res.body, 'server /')\n      })\n  })\n\n  t.test('after', t => {\n    server.close()\n    proxyServer.close()\n\n    t.end()\n  })\n})\n"]}