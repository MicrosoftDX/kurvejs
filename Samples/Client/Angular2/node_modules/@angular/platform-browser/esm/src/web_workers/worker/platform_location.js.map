{"version":3,"file":"platform_location.js","sourceRoot":"","sources":["../../../../../../../modules/@angular/platform-browser/src/web_workers/worker/platform_location.ts"],"names":[],"mappings":"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","sourcesContent":["import {PlatformLocation, UrlChangeListener} from '@angular/common';\nimport {Injectable} from '@angular/core';\n\nimport {EventEmitter, ObservableWrapper, PromiseWrapper} from '../../facade/async';\nimport {StringMapWrapper} from '../../facade/collection';\nimport {BaseException} from '../../facade/exceptions';\nimport {StringWrapper} from '../../facade/lang';\nimport {ClientMessageBroker, ClientMessageBrokerFactory, FnArg, UiArguments} from '../shared/client_message_broker';\nimport {MessageBus} from '../shared/message_bus';\nimport {ROUTER_CHANNEL} from '../shared/messaging_api';\nimport {LocationType} from '../shared/serialized_types';\nimport {PRIMITIVE, Serializer} from '../shared/serializer';\n\nimport {deserializeGenericEvent} from './event_deserializer';\nexport class WebWorkerPlatformLocation extends PlatformLocation {\n  private _broker: ClientMessageBroker;\n  private _popStateListeners: Array<Function> = [];\n  private _hashChangeListeners: Array<Function> = [];\n  private _location: LocationType = null;\n  private _channelSource: EventEmitter<Object>;\n\n  constructor(\n      brokerFactory: ClientMessageBrokerFactory, bus: MessageBus, private _serializer: Serializer) {\n    super();\n    this._broker = brokerFactory.createMessageBroker(ROUTER_CHANNEL);\n\n    this._channelSource = bus.from(ROUTER_CHANNEL);\n    ObservableWrapper.subscribe(this._channelSource, (msg: {[key: string]: any}) => {\n      var listeners: Array<Function> = null;\n      if (StringMapWrapper.contains(msg, 'event')) {\n        let type: string = msg['event']['type'];\n        if (StringWrapper.equals(type, 'popstate')) {\n          listeners = this._popStateListeners;\n        } else if (StringWrapper.equals(type, 'hashchange')) {\n          listeners = this._hashChangeListeners;\n        }\n\n        if (listeners !== null) {\n          let e = deserializeGenericEvent(msg['event']);\n          // There was a popState or hashChange event, so the location object thas been updated\n          this._location = this._serializer.deserialize(msg['location'], LocationType);\n          listeners.forEach((fn: Function) => fn(e));\n        }\n      }\n    });\n  }\n\n  /** @internal **/\n  init(): Promise<boolean> {\n    var args: UiArguments = new UiArguments('getLocation');\n\n    var locationPromise: Promise<LocationType> = this._broker.runOnService(args, LocationType);\n    return PromiseWrapper.then(\n        locationPromise, (val: LocationType):\n                             boolean => {\n                               this._location = val;\n                               return true;\n                             },\n        (err): boolean => { throw new BaseException(err); });\n  }\n\n  getBaseHrefFromDOM(): string {\n    throw new BaseException(\n        'Attempt to get base href from DOM from WebWorker. You must either provide a value for the APP_BASE_HREF token through DI or use the hash location strategy.');\n  }\n\n  onPopState(fn: UrlChangeListener): void { this._popStateListeners.push(fn); }\n\n  onHashChange(fn: UrlChangeListener): void { this._hashChangeListeners.push(fn); }\n\n  get pathname(): string {\n    if (this._location === null) {\n      return null;\n    }\n\n    return this._location.pathname;\n  }\n\n  get search(): string {\n    if (this._location === null) {\n      return null;\n    }\n\n    return this._location.search;\n  }\n\n  get hash(): string {\n    if (this._location === null) {\n      return null;\n    }\n\n    return this._location.hash;\n  }\n\n  set pathname(newPath: string) {\n    if (this._location === null) {\n      throw new BaseException('Attempt to set pathname before value is obtained from UI');\n    }\n\n    this._location.pathname = newPath;\n\n    var fnArgs = [new FnArg(newPath, PRIMITIVE)];\n    var args = new UiArguments('setPathname', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n\n  pushState(state: any, title: string, url: string): void {\n    var fnArgs =\n        [new FnArg(state, PRIMITIVE), new FnArg(title, PRIMITIVE), new FnArg(url, PRIMITIVE)];\n    var args = new UiArguments('pushState', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n\n  replaceState(state: any, title: string, url: string): void {\n    var fnArgs =\n        [new FnArg(state, PRIMITIVE), new FnArg(title, PRIMITIVE), new FnArg(url, PRIMITIVE)];\n    var args = new UiArguments('replaceState', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n\n  forward(): void {\n    var args = new UiArguments('forward');\n    this._broker.runOnService(args, null);\n  }\n\n  back(): void {\n    var args = new UiArguments('back');\n    this._broker.runOnService(args, null);\n  }\n/** @nocollapse */\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: {type: Function, decorators?: DecoratorInvocation[]}[] = [\n{type: ClientMessageBrokerFactory, },\n{type: MessageBus, },\n{type: Serializer, },\n];\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}