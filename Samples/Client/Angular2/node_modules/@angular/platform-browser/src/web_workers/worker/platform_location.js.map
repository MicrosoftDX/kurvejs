{"version":3,"file":"platform_location.js","sourceRoot":"","sources":["../../../../../../modules/@angular/platform-browser/src/web_workers/worker/platform_location.ts"],"names":[],"mappings":"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","sourcesContent":["import {PlatformLocation, UrlChangeListener} from '@angular/common';\nimport {Injectable} from '@angular/core';\n\nimport {EventEmitter, ObservableWrapper, PromiseWrapper} from '../../facade/async';\nimport {StringMapWrapper} from '../../facade/collection';\nimport {BaseException} from '../../facade/exceptions';\nimport {StringWrapper} from '../../facade/lang';\nimport {ClientMessageBroker, ClientMessageBrokerFactory, FnArg, UiArguments} from '../shared/client_message_broker';\nimport {MessageBus} from '../shared/message_bus';\nimport {ROUTER_CHANNEL} from '../shared/messaging_api';\nimport {LocationType} from '../shared/serialized_types';\nimport {PRIMITIVE, Serializer} from '../shared/serializer';\n\nimport {deserializeGenericEvent} from './event_deserializer';\nexport class WebWorkerPlatformLocation extends PlatformLocation {\n  private _broker: ClientMessageBroker;\n  private _popStateListeners: Array<Function> = [];\n  private _hashChangeListeners: Array<Function> = [];\n  private _location: LocationType = null;\n  private _channelSource: EventEmitter<Object>;\n\n  constructor(\n      brokerFactory: ClientMessageBrokerFactory, bus: MessageBus, private _serializer: Serializer) {\n    super();\n    this._broker = brokerFactory.createMessageBroker(ROUTER_CHANNEL);\n\n    this._channelSource = bus.from(ROUTER_CHANNEL);\n    ObservableWrapper.subscribe(this._channelSource, (msg: {[key: string]: any}) => {\n      var listeners: Array<Function> = null;\n      if (StringMapWrapper.contains(msg, 'event')) {\n        let type: string = msg['event']['type'];\n        if (StringWrapper.equals(type, 'popstate')) {\n          listeners = this._popStateListeners;\n        } else if (StringWrapper.equals(type, 'hashchange')) {\n          listeners = this._hashChangeListeners;\n        }\n\n        if (listeners !== null) {\n          let e = deserializeGenericEvent(msg['event']);\n          // There was a popState or hashChange event, so the location object thas been updated\n          this._location = this._serializer.deserialize(msg['location'], LocationType);\n          listeners.forEach((fn: Function) => fn(e));\n        }\n      }\n    });\n  }\n\n  /** @internal **/\n  init(): Promise<boolean> {\n    var args: UiArguments = new UiArguments('getLocation');\n\n    var locationPromise: Promise<LocationType> = this._broker.runOnService(args, LocationType);\n    return PromiseWrapper.then(\n        locationPromise, (val: LocationType):\n                             boolean => {\n                               this._location = val;\n                               return true;\n                             },\n        (err): boolean => { throw new BaseException(err); });\n  }\n\n  getBaseHrefFromDOM(): string {\n    throw new BaseException(\n        'Attempt to get base href from DOM from WebWorker. You must either provide a value for the APP_BASE_HREF token through DI or use the hash location strategy.');\n  }\n\n  onPopState(fn: UrlChangeListener): void { this._popStateListeners.push(fn); }\n\n  onHashChange(fn: UrlChangeListener): void { this._hashChangeListeners.push(fn); }\n\n  get pathname(): string {\n    if (this._location === null) {\n      return null;\n    }\n\n    return this._location.pathname;\n  }\n\n  get search(): string {\n    if (this._location === null) {\n      return null;\n    }\n\n    return this._location.search;\n  }\n\n  get hash(): string {\n    if (this._location === null) {\n      return null;\n    }\n\n    return this._location.hash;\n  }\n\n  set pathname(newPath: string) {\n    if (this._location === null) {\n      throw new BaseException('Attempt to set pathname before value is obtained from UI');\n    }\n\n    this._location.pathname = newPath;\n\n    var fnArgs = [new FnArg(newPath, PRIMITIVE)];\n    var args = new UiArguments('setPathname', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n\n  pushState(state: any, title: string, url: string): void {\n    var fnArgs =\n        [new FnArg(state, PRIMITIVE), new FnArg(title, PRIMITIVE), new FnArg(url, PRIMITIVE)];\n    var args = new UiArguments('pushState', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n\n  replaceState(state: any, title: string, url: string): void {\n    var fnArgs =\n        [new FnArg(state, PRIMITIVE), new FnArg(title, PRIMITIVE), new FnArg(url, PRIMITIVE)];\n    var args = new UiArguments('replaceState', fnArgs);\n    this._broker.runOnService(args, null);\n  }\n\n  forward(): void {\n    var args = new UiArguments('forward');\n    this._broker.runOnService(args, null);\n  }\n\n  back(): void {\n    var args = new UiArguments('back');\n    this._broker.runOnService(args, null);\n  }\n/** @nocollapse */\nstatic decorators: DecoratorInvocation[] = [\n{ type: Injectable },\n];\n/** @nocollapse */\nstatic ctorParameters: {type: Function, decorators?: DecoratorInvocation[]}[] = [\n{type: ClientMessageBrokerFactory, },\n{type: MessageBus, },\n{type: Serializer, },\n];\n}\n\ninterface DecoratorInvocation {\n  type: Function;\n  args?: any[];\n}\n"]}