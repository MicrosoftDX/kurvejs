var __extends=this&&this.__extends||function(e,t){function r(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);r.prototype=t.prototype,e.prototype=new r},Kurve;!function(e){var t=function(){function e(){this.doneCallbacks=[],this.failCallbacks=[],this.progressCallbacks=[],this._promise=new r(this),this._state="pending"}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"state",{get:function(){return this._state},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rejected",{get:function(){return"rejected"===this.state},set:function(e){this._state=e?"rejected":"pending"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"resolved",{get:function(){return"resolved"===this.state},set:function(e){this._state=e?"resolved":"pending"},enumerable:!0,configurable:!0}),e.prototype.resolve=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return e.unshift(this),this.resolveWith.apply(this,e)},e.prototype.resolveWith=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this._result=t,this.doneCallbacks.forEach(function(r){r.apply(e,t)}),this.doneCallbacks=[],this.resolved=!0,this},e.prototype.reject=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return e.unshift(this),this.rejectWith.apply(this,e)},e.prototype.rejectWith=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this.failCallbacks.forEach(function(r){r.apply(e,t)}),this.failCallbacks=[],this.rejected=!0,this},e.prototype.progress=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];var o=new e;return this.resolved||this.rejected?(r.forEach(function(e){e.apply(t._notifyContext,t._notifyArgs)}),o):(r.forEach(function(e){t.progressCallbacks.push(t.wrap(o,e,o.notify))}),this.checkStatus(),o)},e.prototype.notify=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return e.unshift(this),this.notifyWith.apply(this,e)},e.prototype.notifyWith=function(e){for(var t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];return this.resolved||this.rejected?this:(this._notifyContext=e,this._notifyArgs=t,this.progressCallbacks.forEach(function(r){r.apply(e,t)}),this)},e.prototype.checkStatus=function(){this.resolved?this.resolve.apply(this,this._result):this.rejected&&this.reject.apply(this,this._result)},e.prototype.then=function(t,r,n){var o=new e;return this.progressCallbacks.push(this.wrap(o,n,o.progress)),this.doneCallbacks.push(this.wrap(o,t,o.resolve)),this.failCallbacks.push(this.wrap(o,r,o.reject)),this.checkStatus(),this},e.prototype.wrap=function(e,t,n){return function(){for(var o=[],s=0;s<arguments.length;s++)o[s-0]=arguments[s];var i=t.apply(t,o);i&&i instanceof r?i.then(function(){e.resolve()},function(){e.reject()}):n.apply(e,[i])}},e.prototype.done=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];var o=new e;return r.forEach(function(e){t.doneCallbacks.push(t.wrap(o,e,o.resolve))}),this.checkStatus(),o},e.prototype.fail=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];var o=new e;return r.forEach(function(e){t.failCallbacks.push(t.wrap(o,e,o.reject))}),this.checkStatus(),o},e.prototype.always=function(){for(var t=this,r=[],n=0;n<arguments.length;n++)r[n-0]=arguments[n];var o=new e;return r.forEach(function(e){t.doneCallbacks.push(t.wrap(o,e,o.resolve)),t.failCallbacks.push(t.wrap(o,e,o.reject))}),this.checkStatus(),o},e}();e.Deferred=t;var r=function(){function e(e){this.deferred=e}return e.prototype.then=function(e,t,r){return this.deferred.then(e,t,r).promise},e.prototype.done=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.deferred.done.apply(this.deferred,e).promise},e.prototype.fail=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.deferred.fail.apply(this.deferred,e).promise},e.prototype.always=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];return this.deferred.always.apply(this.deferred,e).promise},Object.defineProperty(e.prototype,"resolved",{get:function(){return this.deferred.resolved},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"rejected",{get:function(){return this.deferred.rejected},enumerable:!0,configurable:!0}),e}();e.Promise=r,e.when=function(){for(var e=[],n=0;n<arguments.length;n++)e[n-0]=arguments[n];if(1===e.length){var o=e[0];if(o instanceof t)return o.promise;if(o instanceof r)return o}var s=new t;if(1===e.length)return s.resolve(e[0]),s.promise;var i=e.length,a=[],u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t-0]=arguments[t];a.push(e),0===--i&&s.resolve.apply(s,a)},c=function(){s.reject()};return e.forEach(function(e){e.then(u,c)}),s.promise}}(Kurve||(Kurve={}));var Kurve;!function(e){var t=function(){function e(){}return e}();e.Error=t;var r=function(){function r(e,r){var n=this;void 0===e&&(e=""),void 0===r&&(r=""),this.authContext=null,this.config=null,this.isCallback=!1,this.clientId=e,this.redirectUri=r,this.req=new XMLHttpRequest,this.tokenCache={},window.addEventListener("message",function(e){if("id_token"===e.data.type)if(e.data.token)if(n.state!==e.data.state){var r=new t;r.statusText="Invalid state",n.loginCallback(r)}else n.decodeIdToken(e.data.token),n.loginCallback(null);else n.loginCallback(e.data);else if("access_token"===e.data.type)if(e.data.token){var o=e.data.token,s=document.getElementById("tokenIFrame");if(s.parentNode.removeChild(s),e.data.state!==n.state){var r=new t;r.statusText="Invalid state",n.getTokenCallback(null,r)}else n.getTokenCallback(o,null)}else n.getTokenCallback(null,e.data)})}return r.prototype.decodeIdToken=function(e){var t=this,r=this.base64Decode(e.substring(e.indexOf(".")+1,e.lastIndexOf("."))),n=JSON.parse(r),o=new Date(new Date("01/01/1970 0:0 UTC").getTime()+1e3*parseInt(n.exp));this.idToken={token:e,expiry:o,upn:n.upn,tenantId:n.tid,family_name:n.family_name,given_name:n.given_name,name:n.name},this.refreshTimer=setTimeout(function(){t.renewIdToken()},1e3*parseInt(n.exp)-3e5)},r.prototype.decodeAccessToken=function(e,t){var r=this.base64Decode(e.substring(e.indexOf(".")+1,e.lastIndexOf("."))),n=JSON.parse(r),o=new Date(new Date("01/01/1970 0:0 UTC").getTime()+1e3*parseInt(n.exp));this.tokenCache[t]={resource:t,token:e,expiry:o}},r.prototype.getIdToken=function(){return this.idToken},r.prototype.isLoggedIn=function(){return this.idToken?this.idToken.expiry>new Date:!1},r.prototype.renewIdToken=function(){clearTimeout(this.refreshTimer),this.login(function(){})},r.prototype.getAccessTokenAsync=function(t){var r=new e.Deferred;return this.getAccessToken(t,function(e,t){t?r.reject(t):r.resolve(e)}),r.promise},r.prototype.getAccessToken=function(e,t){var r=this,n=this.tokenCache[e];if(n&&n.expiry>new Date((new Date).getTime()+6e4))return void t(n.token,null);this.getTokenCallback=function(n,o){o?t(null,o):(r.decodeAccessToken(n,e),t(n,null))},this.nonce=this.generateNonce(),this.state=this.generateNonce();var o=document.createElement("iframe");o.style.display="none",o.id="tokenIFrame",o.src="./login.html?clientId="+encodeURIComponent(this.clientId)+"&resource="+encodeURIComponent(e)+"&redirectUri="+encodeURIComponent(this.redirectUri)+"&state="+encodeURIComponent(this.state)+"&nonce="+encodeURIComponent(this.nonce),document.body.appendChild(o)},r.prototype.loginAsync=function(){var t=new e.Deferred;return this.login(function(e){e?t.reject(e):t.resolve()}),t.promise},r.prototype.login=function(e){this.loginCallback=e,this.state=this.generateNonce(),this.nonce=this.generateNonce(),window.open("./login.html?clientId="+encodeURIComponent(this.clientId)+"&redirectUri="+encodeURIComponent(this.redirectUri)+"&state="+encodeURIComponent(this.state)+"&nonce="+encodeURIComponent(this.nonce),"_blank")},r.prototype.logOut=function(){var e="https://login.microsoftonline.com/common/oauth2/logout?post_logout_redirect_uri="+encodeURI(window.location.href);window.location.href=e},r.prototype.base64Decode=function(e){var t,r,n,o,s={},i=0,a=0,u="",c=String.fromCharCode,l=e.length,p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(t=0;64>t;t++)s[p.charAt(t)]=t;for(n=0;l>n;n++)for(r=s[e.charAt(n)],i=(i<<6)+r,a+=6;a>=8;)((o=i>>>(a-=8)&255)||l-2>n)&&(u+=c(o));return u},r.prototype.generateNonce=function(){for(var e="",t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r=0;32>r;r++)e+=t.charAt(Math.floor(Math.random()*t.length));return e},r}();e.Identity=r}(Kurve||(Kurve={}));var Kurve;!function(e){var t=function(){function t(e){this.req=null,this.state=null,this.nonce=null,this.accessToken=null,this.KurveIdentity=null,this.defaultResourceID="https://graph.microsoft.com",this.baseUrl="https://graph.microsoft.com/v1.0/",e.defaultAccessToken?this.accessToken=e.defaultAccessToken:this.KurveIdentity=e.identity}return t.prototype.meAsync=function(t){var r=new e.Deferred;return this.me(function(e,t){t?r.reject(t):r.resolve(e)},t),r.promise},t.prototype.me=function(e,t){var r=this.buildMeUrl()+"/";t&&(r+="?"+t),this.getUser(r,e)},t.prototype.userAsync=function(t){var r=new e.Deferred;return this.user(t,function(e,t){t?r.reject(t):r.resolve(e)}),r.promise},t.prototype.user=function(e,t){var r=this.buildUsersUrl()+"/"+e;this.getUser(r,t)},t.prototype.usersAsync=function(t){var r=new e.Deferred;return this.users(function(e,t){t?r.reject(t):r.resolve(e)},t),r.promise},t.prototype.users=function(e,t){var r=this.buildUsersUrl()+"/";t&&(r+="?"+t),this.getUsers(r,e)},t.prototype.groupAsync=function(t){var r=new e.Deferred;return this.group(t,function(e,t){t?r.reject(t):r.resolve(e)}),r.promise},t.prototype.group=function(e,t){var r=this.buildGroupsUrl()+"/"+e;this.getGroup(r,t)},t.prototype.groups=function(e,t){var r=this.buildGroupsUrl()+"/";t&&(r+="?"+t),this.getGroups(r,e)},t.prototype.groupsAsync=function(t){var r=new e.Deferred;return this.groups(function(e,t){t?r.reject(t):r.resolve(e)},t),r.promise},t.prototype.getAsync=function(t){var r=new e.Deferred;return this.get(t,function(e,t){t?r.reject(t):r.resolve(e)}),r.promise},t.prototype.get=function(e,t,r){var n=this,o=new XMLHttpRequest;r&&(o.responseType=r),o.onreadystatechange=function(){4===o.readyState&&200===o.status?r?t(o.response,null):t(o.responseText,null):4===o.readyState&&200!==o.status&&t(null,n.generateError(o))},o.open("GET",e),this.addAccessTokenAndSend(o,function(e){e&&t(null,e)})},t.prototype.generateError=function(t){var r=new e.Error;return r.status=t.status,r.statusText=t.statusText,""===t.responseType||"text"===t.responseType?r.text=t.responseText:r.other=t.response,r},t.prototype.getUsers=function(t,r){var n=this;this.get(t,function(t,o){if(o)return void r(null,o);var s=JSON.parse(t);if(s.error){var i=new e.Error;return i.other=s.error,void r(null,i)}for(var a=s.value?s.value:[s],u=0;u<a.length;u++)n.decorateUserObject(a[u]);var c={resultsPage:a},l=s["@odata.nextLink"];l&&(c.nextLink=function(t){var r=new e.Deferred;return n.getUsers(l,function(e,n){t?t(e,n):n?r.reject(n):r.resolve(e)}),r.promise}),r(c,null)})},t.prototype.getUser=function(t,r){var n=this;this.get(t,function(t,o){if(o)return void r(null,o);var s=JSON.parse(t);if(s.error){var i=new e.Error;return i.other=s.error,void r(null,i)}n.decorateUserObject(s),r(s,null)})},t.prototype.addAccessTokenAndSend=function(e,t){this.accessToken?(e.setRequestHeader("Authorization","Bearer "+this.accessToken),e.send()):this.KurveIdentity.getAccessToken(this.defaultResourceID,function(r,n){n?t(n):(e.setRequestHeader("Authorization","Bearer "+r),e.send(),t(null))})},t.prototype.decorateUserObject=function(t){var r=this;t.messages=function(e,n){var o=r.buildUsersUrl()+"/"+t.userPrincipalName+"/messages";n&&(o+="?"+n),r.getMessages(o,function(t,r){e(t,r)},n)},t.messagesAsync=function(r){var n=new e.Deferred;return t.messages(function(e,t){t?n.reject(t):n.resolve(e)},r),n.promise},t.memberOf=function(e,n){var o=r.buildUsersUrl()+"/"+t.userPrincipalName+"/memberOf";n&&(o+="?"+n),r.getGroups(o,e,n)},t.memberOfAsync=function(r){var n=new e.Deferred;return t.memberOf(function(e,t){t?n.reject(t):n.resolve(e)},r),n.promise},t.manager=function(e){var n=r.buildUsersUrl()+"/"+t.userPrincipalName+"/manager";r.getUser(n,e)},t.managerAsync=function(r){var n=new e.Deferred;return t.manager(function(e,t){t?n.reject(t):n.resolve(e)},r),n.promise},t.directReports=function(e){var n=r.buildUsersUrl()+"/"+t.userPrincipalName+"/directReports";r.getUsers(n,e)},t.directReportsAsync=function(r){var n=new e.Deferred;return t.directReports(function(e,t){t?n.reject(t):n.resolve(e)},r),n.promise},t.photo=function(e){var n=r.buildUsersUrl()+"/"+t.userPrincipalName+"/photo";r.getPhoto(n,e)},t.photoAsync=function(){var r=new e.Deferred;return t.photo(function(e,t){t?r.reject(t):r.resolve(e)}),r.promise},t.photoValue=function(e){var n=r.buildUsersUrl()+"/"+t.userPrincipalName+"/photo/$value";r.getPhotoValue(n,e)},t.photoValueAsync=function(){var r=new e.Deferred;return t.photoValue(function(e,t){t?r.reject(t):r.resolve(e)}),r.promise}},t.prototype.decorateMessageObject=function(e){},t.prototype.decorateGroupObject=function(e){},t.prototype.decoratePhotoObject=function(e){},t.prototype.getMessages=function(t,r,n){var o=this,s=t;n&&(t+="?"+n),this.get(s,function(t,n){if(n)return void r(null,n);var s=JSON.parse(t);if(s.error){var i=new e.Error;return i.other=s.error,void r(null,i)}for(var a=s.value?s.value:[s],u=0;u<a.length;u++)o.decorateMessageObject(a[u]);var c={resultsPage:a},l=s["@odata.nextLink"];l&&(c.nextLink=function(t){var r=new e.Deferred;return o.getMessages(l,function(e,n){t?t(e,n):n?r.reject(n):r.resolve(e)}),r.promise}),r(c,null)})},t.prototype.getGroups=function(t,r,n){var o=this,s=t;n&&(t+="?"+n),this.get(s,function(t,n){if(n)return void r(null,n);var s=JSON.parse(t);if(s.error){var i=new e.Error;return i.other=s.error,void r(null,i)}for(var a=s.value?s.value:[s],u=0;u<a.length;u++)o.decorateGroupObject(a[u]);var c={resultsPage:a},l=s["@odata.nextLink"];l&&(c.nextLink=function(t){var r=new e.Deferred;return o.getGroups(l,function(e,n){t?t(e,n):n?r.reject(n):r.resolve(e)}),r.promise}),r(c,null)})},t.prototype.getGroup=function(t,r){var n=this;this.get(t,function(t,o){if(o)return void r(null,o);var s=JSON.parse(t);if(s.error){var i=new e.Error;return i.other=s.error,void r(null,i)}n.decorateGroupObject(s),r(s,null)})},t.prototype.getPhoto=function(t,r){var n=this;this.get(t,function(t,o){if(o)return void r(null,o);var s=JSON.parse(t);if(s.error){var i=new e.Error;return i.other=s.error,void r(null,i)}n.decoratePhotoObject(s),r(s,null)})},t.prototype.getPhotoValue=function(e,t){this.get(e,function(e,r){return r?void t(null,r):void t(e,null)},"blob")},t.prototype.buildMeUrl=function(){return this.baseUrl+"me"},t.prototype.buildUsersUrl=function(){return this.baseUrl+"/users"},t.prototype.buildGroupsUrl=function(){return this.baseUrl+"/groups"},t}();e.Graph=t}(Kurve||(Kurve={})),("undefined"!=typeof window&&window.module||"undefined"!=typeof module)&&"undefined"!=typeof module.exports&&(module.exports=Kurve);